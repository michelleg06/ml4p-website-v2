<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Prediction Policy Problems: Linear Models and Lasso Regression – Machine Learning for Public Policy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-45c9daaf6acd34b0420988892e8b8644.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-73ee73b83b1a433826722856a32939c3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./assets/ML4PP.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Machine Learning for Public Policy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="./introduction.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./r-intro.html">
 <span class="dropdown-text">An Introduction to R Programming</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./python-intro.html">
 <span class="dropdown-text">An introduction to Python programming</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="./predictionpolicy.html">
 <span class="dropdown-text">Prediction Policy Problems: Linear Models and Lasso Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./classification.html">
 <span class="dropdown-text">Classification with Logistic Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./treebasedmodels.html">
 <span class="dropdown-text">Tree-based models for classification problems</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./fairml.html">
 <span class="dropdown-text">Algorithmic Fairness</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./neuralNets.html">
 <span class="dropdown-text">An Introduction to Neural Networks</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./policyChallenge.html"> 
<span class="menu-text">Collaborative Policy Challenge</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/michelleg06/Machine-Learning-for-Public-Policy" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introducing-the-prediction-policy-framework" id="toc-introducing-the-prediction-policy-framework" class="nav-link active" data-scroll-target="#introducing-the-prediction-policy-framework">Introducing the Prediction Policy Framework</a>
  <ul class="collapse">
  <li><a href="#predicting-social-assistance-beneficiaries" id="toc-predicting-social-assistance-beneficiaries" class="nav-link" data-scroll-target="#predicting-social-assistance-beneficiaries">Predicting social assistance beneficiaries</a></li>
  </ul></li>
  <li><a href="#practical-example" id="toc-practical-example" class="nav-link" data-scroll-target="#practical-example">Practical Example</a>
  <ul class="collapse">
  <li><a href="#preliminaries-working-directory-libraries-data-upload" id="toc-preliminaries-working-directory-libraries-data-upload" class="nav-link" data-scroll-target="#preliminaries-working-directory-libraries-data-upload">1. Preliminaries: working directory, libraries, data upload</a></li>
  <li><a href="#get-to-know-your-data-visualisation-and-pre-processing" id="toc-get-to-know-your-data-visualisation-and-pre-processing" class="nav-link" data-scroll-target="#get-to-know-your-data-visualisation-and-pre-processing">2. Get to know your data: visualisation and pre-processing</a></li>
  <li><a href="#model-fit-data-partition-and-performance-evaluation-parameters" id="toc-model-fit-data-partition-and-performance-evaluation-parameters" class="nav-link" data-scroll-target="#model-fit-data-partition-and-performance-evaluation-parameters">3. Model fit: data partition and performance evaluation parameters</a></li>
  <li><a href="#feature-selection-with-lasso-linear-regression" id="toc-feature-selection-with-lasso-linear-regression" class="nav-link" data-scroll-target="#feature-selection-with-lasso-linear-regression">4. Feature selection with Lasso linear regression</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#practice-at-home" id="toc-practice-at-home" class="nav-link" data-scroll-target="#practice-at-home">Practice at home</a></li>
  <li><a href="#readings" id="toc-readings" class="nav-link" data-scroll-target="#readings">Readings</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Prediction Policy Problems: Linear Models and Lasso Regression</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>This section will cover:</strong></p>
<ul>
<li>Prediction Policy problems</li>
<li>Inference vs.&nbsp;prediction for policy analysis</li>
<li>Assessing accuracy: bias-variance tradeoff</li>
<li>Training error vs.&nbsp;test error</li>
<li>Feature selection: brief introduction to Lasso</li>
</ul>
<p><br></p>
<section id="introducing-the-prediction-policy-framework" class="level2">
<h2 class="anchored" data-anchor-id="introducing-the-prediction-policy-framework">Introducing the Prediction Policy Framework</h2>
<p>In the video-lecture below you’ll be given a brief introduction to the prediction policy framework, and a primer on machine learning. Please take a moment to watch the 20 minute video.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/sFbKe4O0tEQ" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>Are you still wondering what the difference is between Machine Learning and Econometrics? Take a few minutes to watch the video below.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/gx_MBxMu0m4" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<p>After watching the videos, we have a practical exercise.</p>
<section id="predicting-social-assistance-beneficiaries" class="level3">
<h3 class="anchored" data-anchor-id="predicting-social-assistance-beneficiaries">Predicting social assistance beneficiaries</h3>
<p>A key problem in the design of Social Policies is the identification of people in need of social assistance. Social policies usually work with tight budgets and limited fiscal space. To allocate resources efficiently, benefits need to be targeted to those who need them most. Yet, identifying needs isn’t easy and misclassifications can have severe and irreversible effects on people in need.</p>
<p>Think of a social protection programme that allocates food vouchers to families with children at risk of malnutrition, or a programme that establishes needs-based school grants. What happens when these limited and finite resources are given to people that could do without, and those who need them most are excluded from them?</p>
<p>In this block we’ll work with real-world data from the country of Malawi to predict cash-transfer programme beneficiaries: People who live in poverty and need government assistance to make ends meet. The data comes from McBride and Nichol’s (2018) paper <a href="https://elibrary.worldbank.org/doi/abs/10.1093/wber/lhw056">Retooling poverty targeting using out-of-sample validation and machine learning</a>.</p>
<p><strong>Discussion Points</strong></p>
<p>The points below are meant to help you think critically about why we’re about to embark on a machine learning - targeting exercise. <br></p>
<ul>
<li>
Why is this a prediction policy problem? What would be a causal inference problem in this setting? Is it a regression or a classification problem?
</li>
<li>
<p>Which variables and characteristics that we include in the prediction model can make a big difference?</p>
<ul>
<li>
Programmatically and conceptually, which type of characteristics do we want to consider for the prediction model?
</li>
<li>
Technically, how do we select which variables to include in a prediction model? How is this different from a causal inference problem?
</li>
</ul>
</li>
<li>
What are the practical implications of the bias-variance tradeoff in this application?
</li>
<li>
What are potential risks of such a data driven targeting approach?
</li>
</ul>
<p><br></p>
<p><strong>If you’d like to learn more about Social Protection Policies, take a look at this video Alex has made for us with a brilliant summary of the field</strong></p>
<p>(Yes, more videos!)</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/Pn9DntDejKU" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
</section>
</section>
<section id="practical-example" class="level2">
<h2 class="anchored" data-anchor-id="practical-example">Practical Example</h2>
<p>You can download the dataset by clicking on the button below.</p>
<p><a class="btn btn-primary" download="" href="data/malawi.csv"> Download Malawi.csv </a></p>
<p><br></p>
<p>The script below is a step by step on how to go about coding a predictive model using a <em>linear regression</em>. Despite its simplicity and transparency, i.e.&nbsp;the ease with which we can interpret its results, a linear model is not without challenges in machine learning.</p>
<section id="preliminaries-working-directory-libraries-data-upload" class="level3">
<h3 class="anchored" data-anchor-id="preliminaries-working-directory-libraries-data-upload">1. Preliminaries: working directory, libraries, data upload</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list =</span> <span class="fu">ls</span>()) <span class="co"># this line cleans your Global Environment.</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">"/Users/lucas/Documents/UNU-CDO/courses/ml4p/ml4p-website-v2"</span>) <span class="co"># set your working directory</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># If this is your first time using R, you need to install the libraries before loading them. </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># To do that, you can uncomment the line that starts with install.packages(...) by removing the # symbol.    </span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("dplyr", "tidyverse", "caret", "corrplot", "Hmisc", "modelsummary", "plyr", "gt", "stargazer", "elasticnet", "sandwich")</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr) <span class="co"># core package for dataframe manipulation. Usually installed and loaded with the tidyverse, but sometimes needs to be loaded in conjunction to avoid warnings.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># a large collection of packages for data manipulation and visualisation.  </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret) <span class="co"># a package with key functions that streamline the process for predictive modelling </span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot) <span class="co"># a package to plot correlation matrices</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc) <span class="co"># a package for general-purpose data analysis </span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary) <span class="co"># a package to describe model outputs</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr) <span class="co"># a package to describe dataframes</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr) <span class="co"># a package for data wrangling</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt) <span class="co"># a package to edit modelsummary (and other) tables</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer) <span class="co"># a package to visualise model output</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>data_malawi <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/malawi.csv"</span>) <span class="co"># the file is directly read from the working directory/folder previously set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np <span class="co"># can be used to perform a wide variety of mathematical operations on arrays.</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd <span class="co"># mainly used for data analysis and associated manipulation of tabular data in DataFrames</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib <span class="im">as</span> mpl <span class="co"># comprehensive library for creating static, animated, and interactive visualizations in Python</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sklearn <span class="im">as</span> sk <span class="co">#  implement machine learning models and statistical modelling.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns <span class="co"># for dataframe/vector visualisation</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt <span class="co"># only pyplots from the matplotlib library of visuals</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> mean_absolute_error, mean_squared_error <span class="co"># evaluation metrics for ML models. Setting mean_squared_error squared to False will return the RMSE.</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> statsmodels.api <span class="im">as</span> sm <span class="co"># to visualise linear models in a nice way...</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>malawi <span class="op">=</span> pd.read_csv(<span class="st">'/Users/lucas/Documents/UNU-CDO/courses/ml4p/ml4p-website-v2/data/malawi.csv'</span>) <span class="co"># import csv file and store as malawi</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="get-to-know-your-data-visualisation-and-pre-processing" class="level3">
<h3 class="anchored" data-anchor-id="get-to-know-your-data-visualisation-and-pre-processing">2. Get to know your data: visualisation and pre-processing</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(data_malawi) <span class="co"># describes the dataset in a nice format </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">data_malawi</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">11280</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">38</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">character</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">36</td>
</tr>
<tr class="even">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 19%">
<col style="width: 13%">
<col style="width: 19%">
<col style="width: 5%">
<col style="width: 5%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">min</th>
<th style="text-align: right;">max</th>
<th style="text-align: right;">empty</th>
<th style="text-align: right;">n_unique</th>
<th style="text-align: right;">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">region</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">eatype</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">17</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 11%">
<col style="width: 7%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">lnexp_pc_month</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7.360000e+00</td>
<td style="text-align: right;">6.800000e-01</td>
<td style="text-align: right;">4.7800e+00</td>
<td style="text-align: right;">6.890000e+00</td>
<td style="text-align: right;">7.310000e+00</td>
<td style="text-align: right;">7.760000e+00</td>
<td style="text-align: right;">1.106000e+01</td>
<td style="text-align: left;">▁▇▇▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">hhsize</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.550000e+00</td>
<td style="text-align: right;">2.340000e+00</td>
<td style="text-align: right;">1.0000e+00</td>
<td style="text-align: right;">3.000000e+00</td>
<td style="text-align: right;">4.000000e+00</td>
<td style="text-align: right;">6.000000e+00</td>
<td style="text-align: right;">2.700000e+01</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hhsize2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.613000e+01</td>
<td style="text-align: right;">2.799000e+01</td>
<td style="text-align: right;">1.0000e+00</td>
<td style="text-align: right;">9.000000e+00</td>
<td style="text-align: right;">1.600000e+01</td>
<td style="text-align: right;">3.600000e+01</td>
<td style="text-align: right;">7.290000e+02</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">agehead</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.246000e+01</td>
<td style="text-align: right;">1.636000e+01</td>
<td style="text-align: right;">1.0000e+01</td>
<td style="text-align: right;">2.900000e+01</td>
<td style="text-align: right;">3.900000e+01</td>
<td style="text-align: right;">5.400000e+01</td>
<td style="text-align: right;">1.040000e+02</td>
<td style="text-align: left;">▅▇▅▂▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">agehead2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.070610e+03</td>
<td style="text-align: right;">1.618600e+03</td>
<td style="text-align: right;">1.0000e+02</td>
<td style="text-align: right;">8.410000e+02</td>
<td style="text-align: right;">1.521000e+03</td>
<td style="text-align: right;">2.916000e+03</td>
<td style="text-align: right;">1.081600e+04</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">north</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.500000e-01</td>
<td style="text-align: right;">3.600000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">central</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.800000e-01</td>
<td style="text-align: right;">4.900000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▅</td>
</tr>
<tr class="even">
<td style="text-align: left;">rural</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.700000e-01</td>
<td style="text-align: right;">3.300000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▁▁▁▁▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">nevermarried</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.000000e-02</td>
<td style="text-align: right;">1.700000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">sharenoedu</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.700000e-01</td>
<td style="text-align: right;">2.600000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">2.500000e-01</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">shareread</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.100000e-01</td>
<td style="text-align: right;">3.800000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">3.300000e-01</td>
<td style="text-align: right;">6.700000e-01</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▅▁▅▂▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">nrooms</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.500000e+00</td>
<td style="text-align: right;">1.300000e+00</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">2.000000e+00</td>
<td style="text-align: right;">2.000000e+00</td>
<td style="text-align: right;">3.000000e+00</td>
<td style="text-align: right;">1.600000e+01</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">floor_cement</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.000000e-01</td>
<td style="text-align: right;">4.000000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">electricity</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.000000e-02</td>
<td style="text-align: right;">2.300000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">flushtoilet</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.000000e-02</td>
<td style="text-align: right;">1.700000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">soap</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.400000e-01</td>
<td style="text-align: right;">3.400000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">bed</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.200000e-01</td>
<td style="text-align: right;">4.700000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▃</td>
</tr>
<tr class="even">
<td style="text-align: left;">bike</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.600000e-01</td>
<td style="text-align: right;">4.800000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▅</td>
</tr>
<tr class="odd">
<td style="text-align: left;">musicplayer</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.600000e-01</td>
<td style="text-align: right;">3.700000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">coffeetable</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.200000e-01</td>
<td style="text-align: right;">3.200000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">iron</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.100000e-01</td>
<td style="text-align: right;">4.000000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">dimbagarden</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.200000e-01</td>
<td style="text-align: right;">4.700000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▃</td>
</tr>
<tr class="odd">
<td style="text-align: left;">goats</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.100000e-01</td>
<td style="text-align: right;">4.100000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">dependratio</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.120000e+00</td>
<td style="text-align: right;">9.500000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">5.000000e-01</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.500000e+00</td>
<td style="text-align: right;">9.000000e+00</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hfem</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.300000e-01</td>
<td style="text-align: right;">4.200000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">grassroof</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7.400000e-01</td>
<td style="text-align: right;">4.400000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▃▁▁▁▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">mortarpestle</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">5.000000e-01</td>
<td style="text-align: right;">5.000000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">table</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.600000e-01</td>
<td style="text-align: right;">4.800000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▅</td>
</tr>
<tr class="odd">
<td style="text-align: left;">clock</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.000000e-01</td>
<td style="text-align: right;">4.000000e-01</td>
<td style="text-align: right;">0.0000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">1.000000e+00</td>
<td style="text-align: left;">▇▁▁▁▂</td>
</tr>
<tr class="even">
<td style="text-align: left;">ea</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7.606000e+01</td>
<td style="text-align: right;">1.885500e+02</td>
<td style="text-align: right;">1.0000e+00</td>
<td style="text-align: right;">8.000000e+00</td>
<td style="text-align: right;">1.900000e+01</td>
<td style="text-align: right;">4.525000e+01</td>
<td style="text-align: right;">9.010000e+02</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EA</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.372322e+07</td>
<td style="text-align: right;">7.241514e+06</td>
<td style="text-align: right;">1.0101e+07</td>
<td style="text-align: right;">2.040204e+07</td>
<td style="text-align: right;">2.090352e+07</td>
<td style="text-align: right;">3.053301e+07</td>
<td style="text-align: right;">3.120209e+07</td>
<td style="text-align: left;">▂▁▆▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">hhwght</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.387900e+02</td>
<td style="text-align: right;">7.001000e+01</td>
<td style="text-align: right;">7.9000e+01</td>
<td style="text-align: right;">2.076000e+02</td>
<td style="text-align: right;">2.471000e+02</td>
<td style="text-align: right;">2.913000e+02</td>
<td style="text-align: right;">3.587000e+02</td>
<td style="text-align: left;">▂▁▇▇▂</td>
</tr>
<tr class="odd">
<td style="text-align: left;">psu</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.372322e+07</td>
<td style="text-align: right;">7.241514e+06</td>
<td style="text-align: right;">1.0101e+07</td>
<td style="text-align: right;">2.040204e+07</td>
<td style="text-align: right;">2.090352e+07</td>
<td style="text-align: right;">3.053301e+07</td>
<td style="text-align: right;">3.120209e+07</td>
<td style="text-align: left;">▂▁▆▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">strataid</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.560000e+01</td>
<td style="text-align: right;">8.090000e+00</td>
<td style="text-align: right;">1.0000e+00</td>
<td style="text-align: right;">9.000000e+00</td>
<td style="text-align: right;">1.500000e+01</td>
<td style="text-align: right;">2.200000e+01</td>
<td style="text-align: right;">3.000000e+01</td>
<td style="text-align: left;">▅▇▇▆▅</td>
</tr>
<tr class="odd">
<td style="text-align: left;">lnzline</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7.550000e+00</td>
<td style="text-align: right;">0.000000e+00</td>
<td style="text-align: right;">7.5500e+00</td>
<td style="text-align: right;">7.550000e+00</td>
<td style="text-align: right;">7.550000e+00</td>
<td style="text-align: right;">7.550000e+00</td>
<td style="text-align: right;">7.550000e+00</td>
<td style="text-align: left;">▁▁▇▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">case_id</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.372322e+10</td>
<td style="text-align: right;">7.241514e+09</td>
<td style="text-align: right;">1.0101e+10</td>
<td style="text-align: right;">2.040204e+10</td>
<td style="text-align: right;">2.090352e+10</td>
<td style="text-align: right;">3.053301e+10</td>
<td style="text-align: right;">3.120209e+10</td>
<td style="text-align: left;">▂▁▆▁▇</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<ul>
<li><p>The dataset contains 38 variables and 11,280 observations.</p></li>
<li><p>Not all of these variables are relevant for our prediction model.</p></li>
<li><p>To find the labels and description of the variables, you can refer to the <a href="https://academic.oup.com/wber/article-abstract/32/3/531/2447896">paper</a>. <br></p></li>
</ul>
<p>[hhsize, hhsize2, age_head, age_head2, regions, rural, never married, share_of_adults_without_education, share_of_adults_who_can_read, number of rooms, cement floor, electricity, flush toilet, soap, bed, bike, music player, coffee table, iron, garden, goats]</p>
<ul>
<li><p>Luckily for us, we have no missing values (n_missing in summary output)!</p>
<ol type="A">
<li><p>Many machine learning models cannot be trained when missing values are present (some exceptions exist).</p></li>
<li><p>Dealing with missingness is a non-trivial task:</p></li>
</ol></li>
</ul>
<p>First and foremost, we should assess whether there is a pattern to missingness and if so, what that means to what we can learn from our (sub)population. If there is no discernible pattern, we can proceed to delete the missing values or impute them. A more detailed explanation and course of action can be found <a href="https://stefvanbuuren.name/fimd/sec-MCAR.html">here</a>.</p>
<section id="feature-selection-subsetting-the-dataset" class="level4">
<h4 class="anchored" data-anchor-id="feature-selection-subsetting-the-dataset">Feature selection: subsetting the dataset</h4>
<p>As part of our data pre-processing we will subset the dataframe, such that only relevant variables are left. * Relevant: variables/features about a household that could help us determine whether they are in poverty. That way, we save some memory space; but also, we can call the full set of variables in a dataframe in one go!</p>
<pre><code>variables to delete (not included in the identified set above):
[ea, EA, hhwght, psu, strataid, lnzline, case_id, eatype] </code></pre>
<p><br></p>
<p><strong>N/B</strong>: Feature selection is a <em>critical process</em> (and we normally don’t have a paper to guide us through it): from a practical point of view, a model with less predictors may be easier to interpret. Also, some models may be negatively affected by non-informative predictors. This process is similar to traditional econometric modelling, but we should not conflate predictive and explanatory modelling. Importantly, please note that we are not interested in knowing why something happens, but rather in what is likely to happen given some known data. Hence:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># object:vector that contains the names of the variables that we want to get rid of</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"ea"</span>, <span class="st">"EA"</span>, <span class="st">"psu"</span>,<span class="st">"hhwght"</span>, <span class="st">"strataid"</span>, <span class="st">"lnzline"</span>, <span class="st">"case_id"</span>,<span class="st">"eatype"</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># subset of the data_malawi object:datframe</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>data_malawi <span class="ot">&lt;-</span> data_malawi[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(data_malawi) <span class="sc">%in%</span> cols)] <span class="co"># the minus sign indicates deletion of cols</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A few notes for you:</p>
<ul>
<li><p>a dataframe follows the form data[rows,colums]</p></li>
<li><p>colnames() is a function that identifies the column names of an object of class dataframe</p></li>
<li><p>which() is an R base function that gives you the position of some value</p></li>
<li><p>a minus sign will delete either the identified position in the row or the column space</p></li>
</ul>
</section>
<section id="data-visualisation" class="level4">
<h4 class="anchored" data-anchor-id="data-visualisation">Data visualisation</h4>
<p>A quick and effective way to take a first glance at our data is to plot histograms of relevant (numeric) features.</p>
<p>Recall (from the skim() dataframe summary output) that only two variables are non-numeric. However, we need to make a distinction between class factor and class numeric/numeric.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># identify categorical variables to transform from class numeric to factor</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># using a for-loop: print the number of unique values by variable</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(data_malawi)) { <span class="co"># iterate over the length of columns in the data_malawi df</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store the number of unique values in column.i </span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(data_malawi[[i]]))</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print the name of column.i</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(<span class="fu">colnames</span>(data_malawi[i]))</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># print the number of unique values in column.i</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(x)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "lnexp_pc_month"
[1] 11266
[1] "hhsize"
[1] 19
[1] "hhsize2"
[1] 19
[1] "agehead"
[1] 88
[1] "agehead2"
[1] 88
[1] "north"
[1] 2
[1] "central"
[1] 2
[1] "rural"
[1] 2
[1] "nevermarried"
[1] 2
[1] "sharenoedu"
[1] 47
[1] "shareread"
[1] 28
[1] "nrooms"
[1] 16
[1] "floor_cement"
[1] 2
[1] "electricity"
[1] 2
[1] "flushtoilet"
[1] 2
[1] "soap"
[1] 2
[1] "bed"
[1] 2
[1] "bike"
[1] 2
[1] "musicplayer"
[1] 2
[1] "coffeetable"
[1] 2
[1] "iron"
[1] 2
[1] "dimbagarden"
[1] 2
[1] "goats"
[1] 2
[1] "dependratio"
[1] 62
[1] "hfem"
[1] 2
[1] "grassroof"
[1] 2
[1] "mortarpestle"
[1] 2
[1] "table"
[1] 2
[1] "clock"
[1] 2
[1] "region"
[1] 3</code></pre>
</div>
</div>
<p>If you want to optimise your code, using for loops is not ideal. In R, there exists a family of functions called Apply whose purpose is to apply some function to all the elements in an object. For the time being, iterating over 38 columns is fast enough and we don’t need to think about optimising our code. We’ll also see an example later on on how to use one of the functions from the apply family. You can also refer to this blog (https://www.r-bloggers.com/2021/05/apply-family-in-r-apply-lapply-sapply-mapply-and-tapply/) if you want to learn more about it.</p>
<p>Notice that we have a few variables with 2 unique values and one variable with 3 unique values. We should transform these into factor() class. Recall from the introduction tab that in object-oriented programming correctly identifying the variable type (vector class) is crucial for data manipulation and arithmetic operations. We can do this one by one, or in one shot. I’ll give an example of both:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># == One by one == # </span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co"># transform a variable in df to factor, and pass it on to the df to keep the change</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># first, sneak peak at the first 5 observations (rows) of the vector</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_malawi<span class="sc">$</span>north) <span class="co"># returns 1 = North </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 1 1 1 1 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data_malawi<span class="sc">$</span>north <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_malawi<span class="sc">$</span>north, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"NotNorth"</span>, <span class="st">"North"</span>))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_malawi<span class="sc">$</span>north) <span class="co"># returns 2?</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 2 levels "NotNorth","North": 2 2 2 2 2 2 2 2 2 2 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_malawi<span class="sc">$</span>north) <span class="co"># returns north (which was = 1 before), hooray!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] North North North North North North
Levels: NotNorth North</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R stores factors as 1...n; but the label remains the initial numeric value assigned (1 for true, 0 false)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We have also explicityly told 0 is NotNorth and 1 is North (by the order that follows the line of code)</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># transform all binary/categorical data into factor class</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>min_count <span class="ot">&lt;-</span> <span class="dv">3</span> <span class="co"># vector: 3 categories is our max number of categories found</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"># == Apply family: function apply and lapply==#</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># apply a length(unique(x)) function to all the columns (rows = 1, columns = 2) of the data_malawi dataframe, then</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># store boolean (true/false) if the number of unique values is lower or equal to the min_count vector</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>n_distinct2 <span class="ot">&lt;-</span> <span class="fu">apply</span>(data_malawi, <span class="dv">2</span>, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x))) <span class="sc">&lt;=</span> min_count</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># print(n_distinct2) # prints boolean indicator object (so you know what object you have created)</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># select the identified categorical variables and transform them into factors</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>data_malawi[n_distinct2] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(data_malawi[n_distinct2], factor) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Visualise your data: histograms, bar plots, tables</strong></p>
<p>Let’s start with histograms of numeric (continuous) variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># == HISTOGRAMS == #</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Select all variables in the dataframe which are numeric, and can therefore be plotted as a histogram.</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>malawi_continuous <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(data_malawi <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(<span class="sc">~</span><span class="fu">is.numeric</span>(.))) </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># a quick glance at the summary statistics of our continuous variables</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="fu">datasummary_skim</span>(malawi_continuous) <span class="co"># from modelsummary pkg, output as plot in Plot Viewer</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<!-- preamble start -->

    <script>

      function styleCell_gst7xio6su3d97ou7blf(i, j, css_id) {
          var table = document.getElementById("tinytable_gst7xio6su3d97ou7blf");
          var cell = table.rows[i]?.cells[j];  // Safe navigation to avoid errors
          if (cell) {
              console.log(`Styling cell at (${i}, ${j}) with class ${css_id}`);
              cell.classList.add(css_id);
          } else {
              console.warn(`Cell at (${i}, ${j}) not found.`);
          }
      }
      function insertSpanRow(i, colspan, content) {
        var table = document.getElementById('tinytable_gst7xio6su3d97ou7blf');
        var newRow = table.insertRow(i);
        var newCell = newRow.insertCell(0);
        newCell.setAttribute("colspan", colspan);
        // newCell.innerText = content;
        // this may be unsafe, but innerText does not interpret <br>
        newCell.innerHTML = content;
      }
      function spanCell_gst7xio6su3d97ou7blf(i, j, rowspan, colspan) {
        var table = document.getElementById("tinytable_gst7xio6su3d97ou7blf");
        const targetRow = table.rows[i];
        const targetCell = targetRow.cells[j];
        for (let r = 0; r < rowspan; r++) {
          // Only start deleting cells to the right for the first row (r == 0)
          if (r === 0) {
            // Delete cells to the right of the target cell in the first row
            for (let c = colspan - 1; c > 0; c--) {
              if (table.rows[i + r].cells[j + c]) {
                table.rows[i + r].deleteCell(j + c);
              }
            }
          }
          // For rows below the first, delete starting from the target column
          if (r > 0) {
            for (let c = colspan - 1; c >= 0; c--) {
              if (table.rows[i + r] && table.rows[i + r].cells[j]) {
                table.rows[i + r].deleteCell(j);
              }
            }
          }
        }
        // Set rowspan and colspan of the target cell
        targetCell.rowSpan = rowspan;
        targetCell.colSpan = colspan;
      }
      // tinytable span after
      window.addEventListener('load', function () {
          var cellsToStyle = [
            // tinytable style arrays after
          { positions: [ { i: 9, j: 2 }, { i: 9, j: 3 }, { i: 9, j: 7 }, { i: 9, j: 1 }, { i: 9, j: 5 }, { i: 9, j: 6 }, { i: 9, j: 0 }, { i: 9, j: 4 }, { i: 9, j: 8 },  ], css_id: 'tinytable_css_k0dgkc2a87ilm9njm7he',}, 
          { positions: [ { i: 2, j: 2 }, { i: 6, j: 0 }, { i: 3, j: 0 }, { i: 2, j: 1 }, { i: 3, j: 1 }, { i: 1, j: 0 }, { i: 2, j: 0 }, { i: 6, j: 1 }, { i: 4, j: 0 }, { i: 5, j: 0 }, { i: 2, j: 3 }, { i: 7, j: 0 }, { i: 8, j: 0 }, { i: 5, j: 3 }, { i: 3, j: 2 }, { i: 1, j: 1 }, { i: 5, j: 2 }, { i: 6, j: 2 }, { i: 4, j: 1 }, { i: 5, j: 1 }, { i: 2, j: 4 }, { i: 7, j: 1 }, { i: 8, j: 1 }, { i: 5, j: 4 }, { i: 3, j: 3 }, { i: 1, j: 2 }, { i: 8, j: 4 }, { i: 6, j: 3 }, { i: 4, j: 2 }, { i: 8, j: 3 }, { i: 2, j: 5 }, { i: 7, j: 2 }, { i: 8, j: 2 }, { i: 5, j: 5 }, { i: 3, j: 4 }, { i: 1, j: 3 }, { i: 8, j: 5 }, { i: 6, j: 4 }, { i: 4, j: 3 }, { i: 1, j: 6 }, { i: 2, j: 6 }, { i: 7, j: 3 }, { i: 1, j: 5 }, { i: 5, j: 6 }, { i: 3, j: 5 }, { i: 1, j: 4 }, { i: 8, j: 6 }, { i: 6, j: 5 }, { i: 4, j: 4 }, { i: 1, j: 7 }, { i: 2, j: 7 }, { i: 7, j: 4 }, { i: 4, j: 7 }, { i: 5, j: 7 }, { i: 3, j: 6 }, { i: 4, j: 6 }, { i: 8, j: 7 }, { i: 6, j: 6 }, { i: 4, j: 5 }, { i: 1, j: 8 }, { i: 2, j: 8 }, { i: 7, j: 5 }, { i: 4, j: 8 }, { i: 5, j: 8 }, { i: 3, j: 7 }, { i: 7, j: 8 }, { i: 8, j: 8 }, { i: 6, j: 7 }, { i: 7, j: 7 }, { i: 6, j: 8 }, { i: 3, j: 8 }, { i: 7, j: 6 },  ], css_id: 'tinytable_css_gspmntnh7w4sfi3dnfhd',}, 
          { positions: [ { i: 0, j: 0 }, { i: 0, j: 4 }, { i: 0, j: 8 }, { i: 0, j: 2 }, { i: 0, j: 3 }, { i: 0, j: 7 }, { i: 0, j: 1 }, { i: 0, j: 5 }, { i: 0, j: 6 },  ], css_id: 'tinytable_css_cozue375bblmt7ic24m0',}, 
          ];

          // Loop over the arrays to style the cells
          cellsToStyle.forEach(function (group) {
              group.positions.forEach(function (cell) {
                  styleCell_gst7xio6su3d97ou7blf(cell.i, cell.j, group.css_id);
              });
          });
      });
    </script>

    <style>
      /* tinytable css entries after */
      .table td.tinytable_css_k0dgkc2a87ilm9njm7he, .table th.tinytable_css_k0dgkc2a87ilm9njm7he { text-align: left; border-bottom: solid #d3d8dc 0.1em; }
      .table td.tinytable_css_gspmntnh7w4sfi3dnfhd, .table th.tinytable_css_gspmntnh7w4sfi3dnfhd { text-align: left; }
      .table td.tinytable_css_cozue375bblmt7ic24m0, .table th.tinytable_css_cozue375bblmt7ic24m0 { text-align: left; border-top: solid #d3d8dc 0.1em; border-bottom: solid #d3d8dc 0.05em; }
    </style>
    <div class="container">
      <table class="table table-borderless" id="tinytable_gst7xio6su3d97ou7blf" style="width: auto; margin-left: auto; margin-right: auto;" data-quarto-disable-processing="true">
        <thead>
        
              <tr>
                <th scope="col"> </th>
                <th scope="col">Unique</th>
                <th scope="col">Missing Pct.</th>
                <th scope="col">Mean</th>
                <th scope="col">SD</th>
                <th scope="col">Min</th>
                <th scope="col">Median</th>
                <th scope="col">Max</th>
                <th scope="col">Histogram</th>
              </tr>
        </thead>
        
        <tbody>
                <tr>
                  <td>lnexp_pc_month</td>
                  <td>11266</td>
                  <td>0</td>
                  <td>7.4</td>
                  <td>0.7</td>
                  <td>4.8</td>
                  <td>7.3</td>
                  <td>11.1</td>
                  <td><img src="./tinytable_assets/idczvy4t2dowo9h6n7uhdz.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>hhsize</td>
                  <td>19</td>
                  <td>0</td>
                  <td>4.5</td>
                  <td>2.3</td>
                  <td>1.0</td>
                  <td>4.0</td>
                  <td>27.0</td>
                  <td><img src="./tinytable_assets/idrpfwl4y5dorobj4weu6l.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>hhsize2</td>
                  <td>19</td>
                  <td>0</td>
                  <td>26.1</td>
                  <td>28.0</td>
                  <td>1.0</td>
                  <td>16.0</td>
                  <td>729.0</td>
                  <td><img src="./tinytable_assets/idvf0tpyrkgag7hvh2cuj6.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>agehead</td>
                  <td>88</td>
                  <td>0</td>
                  <td>42.5</td>
                  <td>16.4</td>
                  <td>10.0</td>
                  <td>39.0</td>
                  <td>104.0</td>
                  <td><img src="./tinytable_assets/id6x0imbz5cdbb8pqcu34p.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>agehead2</td>
                  <td>88</td>
                  <td>0</td>
                  <td>2070.6</td>
                  <td>1618.6</td>
                  <td>100.0</td>
                  <td>1521.0</td>
                  <td>10816.0</td>
                  <td><img src="./tinytable_assets/idepxyo9pp0xzmj13mp66r.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>sharenoedu</td>
                  <td>47</td>
                  <td>0</td>
                  <td>0.2</td>
                  <td>0.3</td>
                  <td>0.0</td>
                  <td>0.0</td>
                  <td>1.0</td>
                  <td><img src="./tinytable_assets/ideczgkuhbiidexx618iul.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>shareread</td>
                  <td>28</td>
                  <td>0</td>
                  <td>0.6</td>
                  <td>0.4</td>
                  <td>0.0</td>
                  <td>0.7</td>
                  <td>1.0</td>
                  <td><img src="./tinytable_assets/idkq9obglrden3v85uagju.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>nrooms</td>
                  <td>16</td>
                  <td>0</td>
                  <td>2.5</td>
                  <td>1.3</td>
                  <td>0.0</td>
                  <td>2.0</td>
                  <td>16.0</td>
                  <td><img src="./tinytable_assets/iddr1nvk77tay47fw6jb1i.png" style="height: 1em;"></td>
                </tr>
                <tr>
                  <td>dependratio</td>
                  <td>62</td>
                  <td>0</td>
                  <td>1.1</td>
                  <td>0.9</td>
                  <td>0.0</td>
                  <td>1.0</td>
                  <td>9.0</td>
                  <td><img src="./tinytable_assets/idymu21wcr2x861xg95eo5.png" style="height: 1em;"></td>
                </tr>
        </tbody>
      </table>
    </div>
<!-- hack to avoid NA insertion in last line -->
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hmisc package, quick and painless hist.data.frame() function</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="co"># but first, make sure to adjust the number of rows and columns to be displayed on your Plot Viewer</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>)) <span class="co"># 3 rows * 3 columns (9 variables)</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">hist.data.frame</span>(malawi_continuous)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, let’s plot bar graphs and write tables of factor (categorical) variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># == BAR GRAPHS == #</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>malawi_factor <span class="ot">&lt;-</span> data_malawi <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(<span class="sc">~</span><span class="fu">is.factor</span>(.)) <span class="co"># subset of the data with all factor variables</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>)) <span class="co"># 7 rows, 3 columns (21 variables = length of df)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(malawi_factor)) { <span class="co"># Loop over all the columns in the factor df subset</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store data in column.i as x</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> malawi_factor[,i]</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># store name of column.i as x_name</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    x_name <span class="ot">&lt;-</span> <span class="fu">colnames</span>(malawi_factor[i])</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot bar graph of x using Rbase plotting tools</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">barplot</span>(<span class="fu">table</span>(x),</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>            <span class="at">main =</span> <span class="fu">paste</span>(x_name)</span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># == TABLES == #</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also show tables of all factor variables (to get precise frequencies not displayed in bar plots)</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">llply</span>(<span class="at">.data=</span>malawi_factor, <span class="at">.fun=</span>table) <span class="co"># create tables of all the variables in dataframe using the plyr package</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$north

NotNorth    North 
    9600     1680 

$central

   0    1 
6960 4320 

$rural

   0    1 
1440 9840 

$nevermarried

    0     1 
10930   350 

$floor_cement

   0    1 
9036 2244 

$electricity

    0     1 
10620   660 

$flushtoilet

    0     1 
10962   318 

$soap

   0    1 
9740 1540 

$bed

   0    1 
7653 3627 

$bike

   0    1 
7194 4086 

$musicplayer

   0    1 
9426 1854 

$coffeetable

   0    1 
9956 1324 

$iron

   0    1 
8962 2318 

$dimbagarden

   0    1 
7658 3622 

$goats

   0    1 
8856 2424 

$hfem

   0    1 
8697 2583 

$grassroof

   0    1 
2953 8327 

$mortarpestle

   0    1 
5635 5645 

$table

   0    1 
7249 4031 

$clock

   0    1 
9039 2241 

$region

Centre  North  South 
  4320   1680   5280 </code></pre>
</div>
</div>
<p><br></p>
<p>What have we learned from the data visualisation?</p>
<ol type="a">
<li><p>Nothing worrying about the data itself. McBride and Nichols did a good job of pre-processing the data for us. No pesky missing values, or unknown categories.</p></li>
<li><p>From the bar plots, we can see that for the most part, people tend not to own assets. Worryingly, there is a lack of soap, flush toilets and electricity, all of which are crucial for human capital (health and education).</p></li>
<li><p>From the histograms, we can see log per capita expenditure is normally distributed, but if we remove the log, it’s incredibly skewed. Poverty is endemic. Households tend not to have too many educated individuals, and their size is non-trivially large (with less rooms than people need).</p></li>
</ol>
</section>
<section id="relationships-between-features" class="level4">
<h4 class="anchored" data-anchor-id="relationships-between-features">Relationships between features</h4>
<p>To finalise our exploration of the dataset, we should define:</p>
<ul>
<li><p>the target variable (a.k.a. outcome of interest)</p></li>
<li><p>correlational insights</p></li>
</ul>
<p>Let’s visualise two distinct correlation matrices; for our numeric dataframe, which includes our target variable, we will plot a Pearson r correlation matrix. For our factor dataframe, to which we will add our continuous target, we will plot a Spearman rho correlation matrix. Both types of correlation coefficients are interpreted the same (0 = no correlation, 1 perfect positive correlation, -1 perfect negative correlation).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># = = PEARSON CORRELATION MATRIX = = #</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">cor</span>(malawi_continuous) <span class="co"># create a correlation matrix of the continuous dataset, cor() uses Pearson's correlation coefficient as default. This means we can only take the correlation between continuous variables</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(M, <span class="at">method=</span><span class="st">"circle"</span>, <span class="at">addCoef.col =</span><span class="st">"black"</span>, <span class="at">number.cex =</span> <span class="fl">0.8</span>) <span class="co"># visualise it in a nice way</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We can already tell that the size of the household and dependent ratio are highly negatively correlated to our target variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># = = SPEARMAN CORRELATION MATRIX = = #</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>malawi_factorC <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(malawi_factor,as.numeric)) <span class="co"># coerce dataframe to numeric, as the cor() command only takes in numeric types</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>malawi_factorC<span class="sc">$</span>lnexp_pc_month <span class="ot">&lt;-</span> malawi_continuous<span class="sc">$</span>lnexp_pc_month <span class="co"># include target variable in the dataframe</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>M2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(malawi_factorC, <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(M2, <span class="at">method=</span><span class="st">"circle"</span>, <span class="at">addCoef.col =</span><span class="st">"black"</span>, <span class="at">number.cex =</span> <span class="fl">0.3</span>) <span class="co"># visualise it in a nice way</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Ownership of some assets stands out: soap, a cement floor, electricity, a bed… ownership of these (and a couple of other) assets is positively correlated to per capita expenditure. Living in a rural area, on the other hand, is negtively correlated to our target variable.</p>
<p>We can also spot some correlation coefficients that equal zero. In some situations, the data generating mechanism can create predictors that only have a single unique value (i.e.&nbsp;a “zero-variance predictor”). For many ML models (excluding tree-based models), this may cause the model to crash or the fit to be unstable. Here, the only <span class="math inline">\(0\)</span> we’ve spotted is not in relation to our target variable.</p>
<p>But we do observe some near-zero-variance predictors. Besides uninformative, these can also create unstable model fits. There’s a few strategies to deal with these; the quickest solution is to remove them. A second option, which is especially interesting in scenarios with a large number of predictors/variables, is to work with penalised models. We’ll discuss this option below.</p>
</section>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>Pandas is a very complete package to manipulate DataFrames/datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># first observations of dataframe</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>malawi.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   lnexp_pc_month  hhsize  hhsize2  ...  strataid  lnzline      case_id
0        6.900896       7       49  ...         1    7.555  10101002025
1        7.064378       3        9  ...         1    7.555  10101002051
2        6.823851       6       36  ...         1    7.555  10101002072
3        6.894722       6       36  ...         1    7.555  10101002079
4        6.465989       6       36  ...         1    7.555  10101002095

[5 rows x 38 columns]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># descriptive statistics of variables</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>malawi.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       lnexp_pc_month        hhsize  ...       lnzline       case_id
count    11280.000000  11280.000000  ...  1.128000e+04  1.128000e+04
mean         7.358888      4.546809  ...  7.555000e+00  2.372322e+10
std          0.675346      2.335525  ...  1.776436e-15  7.241514e+09
min          4.776855      1.000000  ...  7.555000e+00  1.010100e+10
25%          6.892941      3.000000  ...  7.555000e+00  2.040204e+10
50%          7.305191      4.000000  ...  7.555000e+00  2.090352e+10
75%          7.757587      6.000000  ...  7.555000e+00  3.053301e+10
max         11.063562     27.000000  ...  7.555000e+00  3.120209e+10

[8 rows x 36 columns]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now let's summarise the dataframe in a general format</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>malawi.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 11280 entries, 0 to 11279
Data columns (total 38 columns):
 #   Column          Non-Null Count  Dtype  
---  ------          --------------  -----  
 0   lnexp_pc_month  11280 non-null  float64
 1   hhsize          11280 non-null  int64  
 2   hhsize2         11280 non-null  int64  
 3   agehead         11280 non-null  int64  
 4   agehead2        11280 non-null  int64  
 5   north           11280 non-null  int64  
 6   central         11280 non-null  int64  
 7   rural           11280 non-null  int64  
 8   nevermarried    11280 non-null  int64  
 9   sharenoedu      11280 non-null  float64
 10  shareread       11280 non-null  float64
 11  nrooms          11280 non-null  int64  
 12  floor_cement    11280 non-null  int64  
 13  electricity     11280 non-null  int64  
 14  flushtoilet     11280 non-null  int64  
 15  soap            11280 non-null  int64  
 16  bed             11280 non-null  int64  
 17  bike            11280 non-null  int64  
 18  musicplayer     11280 non-null  int64  
 19  coffeetable     11280 non-null  int64  
 20  iron            11280 non-null  int64  
 21  dimbagarden     11280 non-null  int64  
 22  goats           11280 non-null  int64  
 23  dependratio     11280 non-null  float64
 24  hfem            11280 non-null  int64  
 25  grassroof       11280 non-null  int64  
 26  mortarpestle    11280 non-null  int64  
 27  table           11280 non-null  int64  
 28  clock           11280 non-null  int64  
 29  ea              11280 non-null  int64  
 30  EA              11280 non-null  int64  
 31  hhwght          11280 non-null  float64
 32  region          11280 non-null  object 
 33  eatype          11280 non-null  object 
 34  psu             11280 non-null  int64  
 35  strataid        11280 non-null  int64  
 36  lnzline         11280 non-null  float64
 37  case_id         11280 non-null  int64  
dtypes: float64(6), int64(30), object(2)
memory usage: 3.3+ MB</code></pre>
</div>
</div>
<ul>
<li><p>The dataset contains 38 variables and 11,280 observations.</p></li>
<li><p>Not all of these variables are relevant for our prediction model.</p></li>
<li><p>To find the labels and description of the variables, you can refer to the <a href="https://academic.oup.com/wber/article-abstract/32/3/531/2447896">paper</a>. <br></p></li>
</ul>
<p>[hhsize, hhsize2, age_head, age_head2, regions, rural, never married, share_of_adults_without_education, share_of_adults_who_can_read, number of rooms, cement floor, electricity, flush toilet, soap, bed, bike, music player, coffee table, iron, garden, goats] <br></p>
<ul>
<li>Luckily for us, we have no missing values (Non-Null Count in info() output)!</li>
</ul>
<ol type="A">
<li><p>Many machine learning models cannot be trained when missing values are present (some exceptions exist).</p></li>
<li><p>Dealing with missingness is a non-trivial task: First and foremost, we should assess whether there is a pattern to missingness and if so, what that means to what we can learn from our (sub)population. If there is no discernible pattern, we can proceed to delete the missing values or impute them. A more detailed explanation and course of action can be found <a href="https://stefvanbuuren.name/fimd/sec-MCAR.html">here</a>.</p></li>
</ol>
<section id="feature-selection-subsetting-the-dataset-1" class="level3">
<h3 class="anchored" data-anchor-id="feature-selection-subsetting-the-dataset-1">Feature selection: subsetting the dataset</h3>
<p>As part of our data pre-processing we will subset the dataframe, such that only relevant variables are left. * Relevant: variables/features about a household/individual that could help us determine whether they are in poverty. That way, we save some memory space; but also, we can call the full set of variables in a dataframe in one go!</p>
<p>variables to delete (not included in the identified set above): [ea, EA, hhwght, psu, strataid, lnzline, case_id, eatype]</p>
<p><strong>N/B</strong>: Feature selection is a <em>critical process</em> (and we normally don’t have a paper to guide us through it): from a practical point of view, a model with less predictors may be easier to interpret. Also, some models may be negatively affected by non-informative predictors. This process is similar to traditional econometric modelling, but we should not conflate predictive and causal modelling. Importantly, please note that we are not interested in knowing why something happens, but rather in what is likely to happen given some known data. Hence:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># deleting variables from pandas dataframe </span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>cols2delete <span class="op">=</span> [<span class="st">'ea'</span>, <span class="st">'EA'</span>, <span class="st">'hhwght'</span>, <span class="st">'psu'</span>, <span class="st">'strataid'</span>, <span class="st">'lnzline'</span>, <span class="st">'case_id'</span>, <span class="st">'eatype'</span>, <span class="st">'region'</span>]</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>malawi <span class="op">=</span> malawi.drop(cols2delete,axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># axis=0 means delete rows and axis=1 means delete columns</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check if we have deleted the columns: </span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(malawi.shape)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(11280, 29)</code></pre>
</div>
</div>
<p>Same number of rows, but only 29 variables left. We have succesfully deleted those pesky unwanted vectors!</p>
</section>
<section id="data-visualisation-1" class="level3">
<h3 class="anchored" data-anchor-id="data-visualisation-1">Data visualisation</h3>
<p>A quick and effective way to take a first glance at our data is to plot histograms of relevant features. We can use the seaborn and matplotlib libraries to visualise our dataframe.</p>
<ul>
<li>The distribution of each variable matters for the type of plot</li>
<li>start by looking at the number of unique values</li>
<li>if unique values &lt;= 3 you are certain this is a categorical variable, and from our exploration using malawi.info() we had only integer/floats…</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print numbr of unique values by vector</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>malawi.nunique()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>lnexp_pc_month    11266
hhsize               19
hhsize2              19
agehead              88
agehead2             88
north                 2
central               2
rural                 2
nevermarried          2
sharenoedu           47
shareread            28
nrooms               16
floor_cement          2
electricity           2
flushtoilet           2
soap                  2
bed                   2
bike                  2
musicplayer           2
coffeetable           2
iron                  2
dimbagarden           2
goats                 2
dependratio          62
hfem                  2
grassroof             2
mortarpestle          2
table                 2
clock                 2
dtype: int64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">" There's a large number of variables with 2 unique values. We can plot numeric/continuous variables as histograms and binary variables as bar plots."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> There's a large number of variables with 2 unique values. We can plot numeric/continuous variables as histograms and binary variables as bar plots.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># for-loop that iterates over variables in dataframe, if they have 2 unique values, transform vector into categorical</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> malawi:</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> malawi[column].nunique() <span class="op">==</span> <span class="dv">2</span>:</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>        malawi[column] <span class="op">=</span> pd.Categorical(malawi[column])</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># check if it worked</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>malawi.info() <span class="co"># hooray! we've got integers, floats (numerics), and categorical variables now. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 11280 entries, 0 to 11279
Data columns (total 29 columns):
 #   Column          Non-Null Count  Dtype   
---  ------          --------------  -----   
 0   lnexp_pc_month  11280 non-null  float64 
 1   hhsize          11280 non-null  int64   
 2   hhsize2         11280 non-null  int64   
 3   agehead         11280 non-null  int64   
 4   agehead2        11280 non-null  int64   
 5   north           11280 non-null  category
 6   central         11280 non-null  category
 7   rural           11280 non-null  category
 8   nevermarried    11280 non-null  category
 9   sharenoedu      11280 non-null  float64 
 10  shareread       11280 non-null  float64 
 11  nrooms          11280 non-null  int64   
 12  floor_cement    11280 non-null  category
 13  electricity     11280 non-null  category
 14  flushtoilet     11280 non-null  category
 15  soap            11280 non-null  category
 16  bed             11280 non-null  category
 17  bike            11280 non-null  category
 18  musicplayer     11280 non-null  category
 19  coffeetable     11280 non-null  category
 20  iron            11280 non-null  category
 21  dimbagarden     11280 non-null  category
 22  goats           11280 non-null  category
 23  dependratio     11280 non-null  float64 
 24  hfem            11280 non-null  category
 25  grassroof       11280 non-null  category
 26  mortarpestle    11280 non-null  category
 27  table           11280 non-null  category
 28  clock           11280 non-null  category
dtypes: category(20), float64(4), int64(5)
memory usage: 1016.0 KB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot histograms or bar graphs for each of the columns in the dataframe, print them all in the same grid</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># subset of numeric/continuous</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>numeric_df <span class="op">=</span> malawi.select_dtypes(include<span class="op">=</span>[<span class="st">'float64'</span>, <span class="st">'int64'</span>])</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>numeric_df.shape <span class="co"># dataframe subset contains only 9 variables</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(11280, 9)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot histograms of all variables in numeric dataframe (df)</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> numeric_df.columns:</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">3</span>, <span class="dv">1</span>))  <span class="co"># Adjust figsize as needed</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    sns.histplot(numeric_df[column], bins<span class="op">=</span><span class="dv">20</span>, kde<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Histogram of </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(column)</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-14-3.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-14-4.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-14-5.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-14-6.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-14-7.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-14-8.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-14-9.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<p>We can apply a similar logic to plotting/visualising categorical data: bar graphs, but also tables work well.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subset of categorical data</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>cat_df <span class="op">=</span> malawi.select_dtypes(include<span class="op">=</span>[<span class="st">'category'</span>])</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>cat_df.shape <span class="co"># dataframe subset contains 20 variables </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(11280, 20)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let's start with printing tables of the 20 variables with category/count</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> cat_df.columns:</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>    table <span class="op">=</span> pd.crosstab(index<span class="op">=</span>cat_df[column], columns<span class="op">=</span><span class="st">'count'</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f'Table for </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="sc">{</span>table<span class="sc">}</span><span class="ch">\n</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Table for north:
col_0  count
north       
0       9600
1       1680

Table for central:
col_0    count
central       
0         6960
1         4320

Table for rural:
col_0  count
rural       
0       1440
1       9840

Table for nevermarried:
col_0         count
nevermarried       
0             10930
1               350

Table for floor_cement:
col_0         count
floor_cement       
0              9036
1              2244

Table for electricity:
col_0        count
electricity       
0            10620
1              660

Table for flushtoilet:
col_0        count
flushtoilet       
0            10962
1              318

Table for soap:
col_0  count
soap        
0       9740
1       1540

Table for bed:
col_0  count
bed         
0       7653
1       3627

Table for bike:
col_0  count
bike        
0       7194
1       4086

Table for musicplayer:
col_0        count
musicplayer       
0             9426
1             1854

Table for coffeetable:
col_0        count
coffeetable       
0             9956
1             1324

Table for iron:
col_0  count
iron        
0       8962
1       2318

Table for dimbagarden:
col_0        count
dimbagarden       
0             7658
1             3622

Table for goats:
col_0  count
goats       
0       8856
1       2424

Table for hfem:
col_0  count
hfem        
0       8697
1       2583

Table for grassroof:
col_0      count
grassroof       
0           2953
1           8327

Table for mortarpestle:
col_0         count
mortarpestle       
0              5635
1              5645

Table for table:
col_0  count
table       
0       7249
1       4031

Table for clock:
col_0  count
clock       
0       9039
1       2241</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># maybe bar graphs for a quick visual check of asset ownership scarcity?</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> cat_df.columns:</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>, <span class="dv">4</span>)) </span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    sns.countplot(x<span class="op">=</span>column, data<span class="op">=</span>cat_df)</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'Bar Plot of </span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(column)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Count'</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-19.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-20.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-21.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-22.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-23.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-24.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-25.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-26.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-27.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-28.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-29.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-30.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-31.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-32.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-33.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-34.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-35.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-36.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-37.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-15-38.png" class="img-fluid figure-img" width="576"></p>
</figure>
</div>
</div>
</div>
<p>What have we learned from the data visualisation?</p>
<ol type="a">
<li><p>Nothing worrying about the data itself. McBride and Nichols did a good job of pre-processing the data for us. No pesky missing values, or unknown categories.</p></li>
<li><p>From the bar plots, we can see that for the most part, people tend not to own assets. Worryingly, there is a lack of soap, flush toilets and electricity, all of which are crucial for human capital (health and education).</p></li>
<li><p>From the histograms, we can see log per capita expenditure is normally distributed, but if we remove the log, it’s incredibly skewed. Poverty is endemic. Furthermore, households tend not to have too many educated individuals, and household size is non-trivially large (with less rooms than people need).</p></li>
</ol>
</section>
<section id="relationships-between-features-1" class="level3">
<h3 class="anchored" data-anchor-id="relationships-between-features-1">Relationships between features</h3>
<p>To finalise our exploration of the dataset, we should define:</p>
<ul>
<li><p>the target variable (a.k.a. outcome of interest)</p></li>
<li><p>correlational insights</p></li>
</ul>
<p>Let’s visualise two distinct correlation matrices; for our numeric dataframe, which includes our target variable, we will plot a Pearson r correlation matrix. For our factor dataframe, to which we will add our continuous target, we will plot a Spearman rho correlation matrix. Both types of correlation coefficients are interpreted the same (0 = no correlation, 1 perfect positive correlation, -1 perfect negative correlation).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearson correlation matrix (seaborn and matplotlib libraries again :)) </span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>correlation_matrix <span class="op">=</span> numeric_df.corr() <span class="co"># Pearson correlation for continuously disributed variables (default method is pearson)</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot it to get a nice visual</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>sns.heatmap(correlation_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Pearson Correlation Matrix'</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-16-59.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spearman correlation matrix</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co"># unfortunately, only numeric values can be used in corr()</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># detour: transform categorical into numeric type...</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> cat_df.columns:</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pd.api.types.is_categorical_dtype(cat_df[column]):</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>        cat_df[column] <span class="op">=</span> cat_df[column].cat.codes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:6: DeprecationWarning: is_categorical_dtype is deprecated and will be removed in a future version. Use isinstance(dtype, pd.CategoricalDtype) instead</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>cat_df.info() <span class="co"># all integers now! hooray!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 11280 entries, 0 to 11279
Data columns (total 20 columns):
 #   Column        Non-Null Count  Dtype
---  ------        --------------  -----
 0   north         11280 non-null  int8 
 1   central       11280 non-null  int8 
 2   rural         11280 non-null  int8 
 3   nevermarried  11280 non-null  int8 
 4   floor_cement  11280 non-null  int8 
 5   electricity   11280 non-null  int8 
 6   flushtoilet   11280 non-null  int8 
 7   soap          11280 non-null  int8 
 8   bed           11280 non-null  int8 
 9   bike          11280 non-null  int8 
 10  musicplayer   11280 non-null  int8 
 11  coffeetable   11280 non-null  int8 
 12  iron          11280 non-null  int8 
 13  dimbagarden   11280 non-null  int8 
 14  goats         11280 non-null  int8 
 15  hfem          11280 non-null  int8 
 16  grassroof     11280 non-null  int8 
 17  mortarpestle  11280 non-null  int8 
 18  table         11280 non-null  int8 
 19  clock         11280 non-null  int8 
dtypes: int8(20)
memory usage: 220.4 KB</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># detour 2: concatenate target variable to our categorical dataframe</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>targetvar <span class="op">=</span> malawi[<span class="st">'lnexp_pc_month'</span>]</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>cat_df_new <span class="op">=</span> pd.concat([cat_df, targetvar], axis<span class="op">=</span><span class="dv">1</span>) <span class="co"># recall axis=1 tells python to concatenate the column</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>spearman_matrix <span class="op">=</span> cat_df_new.corr(method<span class="op">=</span><span class="st">'spearman'</span>) <span class="co"># specify method spearman</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise spearman correlation matrix</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>sns.heatmap(spearman_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>, annot_kws<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">6</span>})</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Spearman Correlation Matrix'</span>)</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-16-60.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<p>Ideally, we would print a correlation matrix with ALL the variables. For display purposes, we’ve separated them here. If we were interested in relationships between two variables that are not our target variable, we may want to think about a full correlation matrix.</p>
<p>From the Pearson Correlation Matrix, we can see that the size of the household and dependent ratio are highly negatively correlated to our target variable.</p>
<p>From the Spearman Correlation Matrix, we see that ownership of some assets stands out: soap, a cement floor, electricity, a bed… ownership of these (and a couple of other) assets is positively correlated to per capita expenditure. Living in a rural area, on the other hand, is negtively correlated to our target variable.</p>
<p>We can also spot some correlation coefficients that equal zero. In some situations, the data generating mechanism can create predictors that only have a single unique value (i.e.&nbsp;a “zero-variance predictor”). For many ML models (excluding tree-based models), this may cause the model to crash or the fit to be unstable. Here, the only <span class="math inline">\(0\)</span> we’ve spotted is not in relation to our target variable.</p>
<p>But we do observe some near-zero-variance predictors. Besides uninformative, these can also create unstable model fits. There’s a few strategies to deal with these; the quickest solution is to remove them. A second option, which is especially interesting in scenarios with a large number of predictors/variables, is to work with penalised models. We’ll discuss this option below.</p>
</section>
</div>
</div>
</div>
</section>
<section id="model-fit-data-partition-and-performance-evaluation-parameters" class="level3">
<h3 class="anchored" data-anchor-id="model-fit-data-partition-and-performance-evaluation-parameters">3. Model fit: data partition and performance evaluation parameters</h3>
<p>We now have a general idea of the structure of the data we are working with, and what we’re trying to predict: per capita expenditures, which we believe are a proxy for poverty prevalence. Measured by the log of per capita monthly expenditure in our dataset, the variable is named lnexp_pc_month.</p>
<p>The next step is create a simple linear model (OLS) to predict per capita expenditure using the variables in our dataset, and introduce the elements with which we will evaluate our model.</p>
<section id="data-partinioning" class="level4">
<h4 class="anchored" data-anchor-id="data-partinioning">Data Partinioning</h4>
<p>When we want to build predictive models for machine learning purposes, it is important to have (at least) two data sets. A training data set from which our model will learn, and a test data set containing the same features as our training data set; we use the second dataset to see how well our predictive model extrapolates to other samples (i.e.&nbsp;is it generalisable?). To split our main data set into two, we will work with an 80/20 split.</p>
<p>The 80/20 split has its origins in the Pareto Principle, which states that ‘in most cases, 80% of effects from from 20% of causes’. Though there are other test/train splitting options, this partitioning method is a good place to start, and indeed standard in the machine learning field.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First, set a seed to guarantee replicability of the process</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>) <span class="co"># you can use any number you want, but to replicate the results in this tutorial you need to use this number</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># We could split the data manually, but the caret package includes an useful function</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>train_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(data_malawi<span class="sc">$</span>lnexp_pc_month, <span class="at">p =</span> .<span class="dv">8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">1</span>)</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(train_idx) <span class="co"># notice that observation 5 corresponds to resame indicator 7 and so on. We're shuffling and picking!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Resample1
[1,]         1
[2,]         2
[3,]         4
[4,]         5
[5,]         7
[6,]         8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>Train_df <span class="ot">&lt;-</span> data_malawi[ train_idx,]</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>Test_df  <span class="ot">&lt;-</span> data_malawi[<span class="sc">-</span>train_idx,]</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that we have created training and testing dataframes as an 80/20 split of the original dataset.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># split train and test data using the sci-kit learn library (our go-to machine learning package for now!)</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a><span class="co"># We need to define a matrix X that contains all the features (variables) that we are interested in, and a vector Y that is the target variable</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co"># These two elements should be defined both fur the train and test subsets of our data</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> malawi.iloc[:, <span class="dv">1</span>:<span class="dv">28</span>] <span class="co"># x is a matrix containing all vectors/variables except the first one, which conveniently is our target variable</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co"># recall that python starts counting at 0, therefore vector in position 0 =  vector 1, vector in position 1 = vector 2, etc.</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> malawi.iloc[:, <span class="dv">0</span>] <span class="co"># y is a vector containing our target variable </span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test <span class="op">=</span> train_test_split(X, y, test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">12345</span>) <span class="co"># random_state is for reproducibility purposes, analogous to setting a seed in R. </span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>X_train.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      hhsize  hhsize2  agehead  agehead2  ... hfem grassroof mortarpestle table
9867       5       25       41      1681  ...    1         0            1     1
3782       5       25       41      1681  ...    0         1            1     0
5647       5       25       55      3025  ...    0         0            1     1

[3 rows x 27 columns]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>X_test.head(<span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      hhsize  hhsize2  agehead  agehead2  ... hfem grassroof mortarpestle table
3750       2        4       48      2304  ...    1         1            0     0
9030       3        9       42      1764  ...    0         1            1     1
3239       2        4       26       676  ...    0         1            0     0

[3 rows x 27 columns]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>9867    8.504023
3782    6.688002
5647    7.287024
7440    5.643893
7283    6.706208
          ...   
4478    8.266976
4094    8.688864
3492    7.312614
2177    7.538856
4578    6.676927
Name: lnexp_pc_month, Length: 9024, dtype: float64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(y_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3750     7.936020
9030     7.464896
3239     7.288868
1463     7.816436
11236    6.859672
           ...   
8570     7.232218
11080    7.318853
7124     9.199136
8818     7.928102
3167     7.507953
Name: lnexp_pc_month, Length: 2256, dtype: float64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># everything looks okay, let's proceed with modelling... </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="prediction-with-linear-models" class="level4">
<h4 class="anchored" data-anchor-id="prediction-with-linear-models">Prediction with Linear Models</h4>
<p>We will start by fitting a predictive model using the training dataset; that is, our target variable <em>log of monthly per capita expenditures</em> or <em>lnexp_pc_month</em> will be a <span class="math inline">\(Y\)</span> dependent variable in a linear model <span class="math inline">\(Y_i = \alpha + x'\beta_i + \epsilon_i\)</span>, and the remaining features in the data frame correspond to the row vectors <span class="math inline">\(x'\beta\)</span>.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(lnexp_pc_month <span class="sc">~</span> .,Train_df) <span class="co"># the dot after the squiggle ~ asks the lm() function tu use all other variables in the dataframe as predictors to the dependent variable lnexp_pc_month</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">stargazer</span>(model1, <span class="at">type =</span> <span class="st">"text"</span>) <span class="co"># printed in the console as text</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
===============================================
                        Dependent variable:    
                    ---------------------------
                          lnexp_pc_month       
-----------------------------------------------
hhsize                       -0.292***         
                              (0.006)          
                                               
hhsize2                      0.012***          
                             (0.0005)          
                                               
agehead                        0.003           
                              (0.002)          
                                               
agehead2                    -0.00004**         
                             (0.00002)         
                                               
northNorth                   0.080***          
                              (0.014)          
                                               
central1                     0.252***          
                              (0.010)          
                                               
rural1                       -0.055***         
                              (0.017)          
                                               
nevermarried1                0.271***          
                              (0.028)          
                                               
sharenoedu                   -0.105***         
                              (0.020)          
                                               
shareread                    0.075***          
                              (0.015)          
                                               
nrooms                       0.039***          
                              (0.004)          
                                               
floor_cement1                0.102***          
                              (0.017)          
                                               
electricity1                 0.372***          
                              (0.027)          
                                               
flushtoilet1                 0.329***          
                              (0.033)          
                                               
soap1                        0.215***          
                              (0.014)          
                                               
bed1                         0.104***          
                              (0.013)          
                                               
bike1                        0.094***          
                              (0.011)          
                                               
musicplayer1                 0.111***          
                              (0.015)          
                                               
coffeetable1                 0.137***          
                              (0.019)          
                                               
iron1                        0.130***          
                              (0.014)          
                                               
dimbagarden1                 0.102***          
                              (0.010)          
                                               
goats1                       0.080***          
                              (0.012)          
                                               
dependratio                  -0.045***         
                              (0.006)          
                                               
hfem1                        -0.066***         
                              (0.012)          
                                               
grassroof1                   -0.096***         
                              (0.016)          
                                               
mortarpestle1                0.033***          
                              (0.010)          
                                               
table1                       0.051***          
                              (0.011)          
                                               
clock1                       0.058***          
                              (0.014)          
                                               
regionNorth                                    
                                               
                                               
regionSouth                                    
                                               
                                               
Constant                     7.978***          
                              (0.044)          
                                               
-----------------------------------------------
Observations                   9,024           
R2                             0.599           
Adjusted R2                    0.597           
Residual Std. Error      0.428 (df = 8995)     
F Statistic         479.041*** (df = 28; 8995) 
===============================================
Note:               *p&lt;0.1; **p&lt;0.05; ***p&lt;0.01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also estimate iid and robust standard errors, using the model output package modelsummary()</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>ms <span class="ot">&lt;-</span> <span class="fu">modelsummary</span>(model1,</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">vcov =</span> <span class="fu">list</span>(<span class="st">"iid"</span>,<span class="st">"robust"</span>), <span class="co"># include iid and HC3 (robust) standard errors</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">statistic =</span> <span class="fu">c</span>(<span class="st">"p = {p.value}"</span>,<span class="st">"s.e. = {std.error}"</span>),</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">stars =</span> <span class="cn">TRUE</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">output =</span> <span class="st">"gt"</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>             ) <span class="co"># plotted as an image / object in "gt" format</span></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>ms <span class="sc">%&gt;%</span> <span class="fu">tab_header</span>(</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Linear Models with iid and robust s.e.**"</span>),</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">md</span>(<span class="st">"Target: (log) per capita monthly expenditure"</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fwpwqhkfgg" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#fwpwqhkfgg table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#fwpwqhkfgg thead, #fwpwqhkfgg tbody, #fwpwqhkfgg tfoot, #fwpwqhkfgg tr, #fwpwqhkfgg td, #fwpwqhkfgg th {
  border-style: none;
}

#fwpwqhkfgg p {
  margin: 0;
  padding: 0;
}

#fwpwqhkfgg .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fwpwqhkfgg .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fwpwqhkfgg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fwpwqhkfgg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fwpwqhkfgg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fwpwqhkfgg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fwpwqhkfgg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fwpwqhkfgg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fwpwqhkfgg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fwpwqhkfgg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fwpwqhkfgg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fwpwqhkfgg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fwpwqhkfgg .gt_spanner_row {
  border-bottom-style: hidden;
}

#fwpwqhkfgg .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fwpwqhkfgg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fwpwqhkfgg .gt_from_md > :first-child {
  margin-top: 0;
}

#fwpwqhkfgg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fwpwqhkfgg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fwpwqhkfgg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fwpwqhkfgg .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fwpwqhkfgg .gt_row_group_first td {
  border-top-width: 2px;
}

#fwpwqhkfgg .gt_row_group_first th {
  border-top-width: 2px;
}

#fwpwqhkfgg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fwpwqhkfgg .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fwpwqhkfgg .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fwpwqhkfgg .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fwpwqhkfgg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fwpwqhkfgg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fwpwqhkfgg .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#fwpwqhkfgg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fwpwqhkfgg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fwpwqhkfgg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fwpwqhkfgg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fwpwqhkfgg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fwpwqhkfgg .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fwpwqhkfgg .gt_left {
  text-align: left;
}

#fwpwqhkfgg .gt_center {
  text-align: center;
}

#fwpwqhkfgg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fwpwqhkfgg .gt_font_normal {
  font-weight: normal;
}

#fwpwqhkfgg .gt_font_bold {
  font-weight: bold;
}

#fwpwqhkfgg .gt_font_italic {
  font-style: italic;
}

#fwpwqhkfgg .gt_super {
  font-size: 65%;
}

#fwpwqhkfgg .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#fwpwqhkfgg .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fwpwqhkfgg .gt_indent_1 {
  text-indent: 5px;
}

#fwpwqhkfgg .gt_indent_2 {
  text-indent: 10px;
}

#fwpwqhkfgg .gt_indent_3 {
  text-indent: 15px;
}

#fwpwqhkfgg .gt_indent_4 {
  text-indent: 20px;
}

#fwpwqhkfgg .gt_indent_5 {
  text-indent: 25px;
}

#fwpwqhkfgg .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#fwpwqhkfgg div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="3" class="gt_heading gt_title gt_font_normal"><strong>Linear Models with iid and robust s.e.</strong></th>
</tr>
<tr class="gt_heading even">
<th colspan="3" class="gt_heading gt_subtitle gt_font_normal gt_bottom_border">Target: (log) per capita monthly expenditure</th>
</tr>
<tr class="gt_col_headings header">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="a(1)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(1)</th>
<th id="a(2)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(2)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">(Intercept)</td>
<td class="gt_row gt_center" headers="(1)">7.978***</td>
<td class="gt_row gt_center" headers="(2)">7.978***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.044</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.069</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">hhsize</td>
<td class="gt_row gt_center" headers="(1)">-0.292***</td>
<td class="gt_row gt_center" headers="(2)">-0.292***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.006</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.029</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hhsize2</td>
<td class="gt_row gt_center" headers="(1)">0.012***</td>
<td class="gt_row gt_center" headers="(2)">0.012***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.000</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.003</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">agehead</td>
<td class="gt_row gt_center" headers="(1)">0.003</td>
<td class="gt_row gt_center" headers="(2)">0.003</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = 0.108</td>
<td class="gt_row gt_center" headers="(2)">p = 0.137</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.002</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.002</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">agehead2</td>
<td class="gt_row gt_center" headers="(1)">-0.000*</td>
<td class="gt_row gt_center" headers="(2)">-0.000*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = 0.015</td>
<td class="gt_row gt_center" headers="(2)">p = 0.032</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.000</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.000</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">northNorth</td>
<td class="gt_row gt_center" headers="(1)">0.080***</td>
<td class="gt_row gt_center" headers="(2)">0.080***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.014</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.015</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">central1</td>
<td class="gt_row gt_center" headers="(1)">0.252***</td>
<td class="gt_row gt_center" headers="(2)">0.252***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.010</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.010</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">rural1</td>
<td class="gt_row gt_center" headers="(1)">-0.055**</td>
<td class="gt_row gt_center" headers="(2)">-0.055**</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = 0.001</td>
<td class="gt_row gt_center" headers="(2)">p = 0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.017</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.017</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">nevermarried1</td>
<td class="gt_row gt_center" headers="(1)">0.271***</td>
<td class="gt_row gt_center" headers="(2)">0.271***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.028</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.037</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">sharenoedu</td>
<td class="gt_row gt_center" headers="(1)">-0.105***</td>
<td class="gt_row gt_center" headers="(2)">-0.105***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.020</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.021</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">shareread</td>
<td class="gt_row gt_center" headers="(1)">0.075***</td>
<td class="gt_row gt_center" headers="(2)">0.075***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.015</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.015</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">nrooms</td>
<td class="gt_row gt_center" headers="(1)">0.039***</td>
<td class="gt_row gt_center" headers="(2)">0.039***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.004</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.004</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">floor_cement1</td>
<td class="gt_row gt_center" headers="(1)">0.102***</td>
<td class="gt_row gt_center" headers="(2)">0.102***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.017</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.018</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">electricity1</td>
<td class="gt_row gt_center" headers="(1)">0.372***</td>
<td class="gt_row gt_center" headers="(2)">0.372***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.027</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.029</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">flushtoilet1</td>
<td class="gt_row gt_center" headers="(1)">0.329***</td>
<td class="gt_row gt_center" headers="(2)">0.329***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.033</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.042</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">soap1</td>
<td class="gt_row gt_center" headers="(1)">0.215***</td>
<td class="gt_row gt_center" headers="(2)">0.215***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.014</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.014</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">bed1</td>
<td class="gt_row gt_center" headers="(1)">0.104***</td>
<td class="gt_row gt_center" headers="(2)">0.104***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.013</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.013</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">bike1</td>
<td class="gt_row gt_center" headers="(1)">0.094***</td>
<td class="gt_row gt_center" headers="(2)">0.094***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.011</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.011</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">musicplayer1</td>
<td class="gt_row gt_center" headers="(1)">0.111***</td>
<td class="gt_row gt_center" headers="(2)">0.111***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.015</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.015</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">coffeetable1</td>
<td class="gt_row gt_center" headers="(1)">0.137***</td>
<td class="gt_row gt_center" headers="(2)">0.137***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.019</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.019</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">iron1</td>
<td class="gt_row gt_center" headers="(1)">0.130***</td>
<td class="gt_row gt_center" headers="(2)">0.130***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.014</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.014</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">dimbagarden1</td>
<td class="gt_row gt_center" headers="(1)">0.102***</td>
<td class="gt_row gt_center" headers="(2)">0.102***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.010</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.010</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">goats1</td>
<td class="gt_row gt_center" headers="(1)">0.080***</td>
<td class="gt_row gt_center" headers="(2)">0.080***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.012</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.012</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">dependratio</td>
<td class="gt_row gt_center" headers="(1)">-0.045***</td>
<td class="gt_row gt_center" headers="(2)">-0.045***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.006</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.009</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hfem1</td>
<td class="gt_row gt_center" headers="(1)">-0.066***</td>
<td class="gt_row gt_center" headers="(2)">-0.066***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.012</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.013</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">grassroof1</td>
<td class="gt_row gt_center" headers="(1)">-0.096***</td>
<td class="gt_row gt_center" headers="(2)">-0.096***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.016</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.016</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">mortarpestle1</td>
<td class="gt_row gt_center" headers="(1)">0.033**</td>
<td class="gt_row gt_center" headers="(2)">0.033**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = 0.001</td>
<td class="gt_row gt_center" headers="(2)">p = 0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.010</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.010</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">table1</td>
<td class="gt_row gt_center" headers="(1)">0.051***</td>
<td class="gt_row gt_center" headers="(2)">0.051***</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">s.e. = 0.011</td>
<td class="gt_row gt_center" headers="(2)">s.e. = 0.012</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">clock1</td>
<td class="gt_row gt_center" headers="(1)">0.058***</td>
<td class="gt_row gt_center" headers="(2)">0.058***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">p = &lt;0.001</td>
<td class="gt_row gt_center" headers="(2)">p = &lt;0.001</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" " style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(1)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">s.e. = 0.014</td>
<td class="gt_row gt_center" headers="(2)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">s.e. = 0.014</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">Num.Obs.</td>
<td class="gt_row gt_center" headers="(1)">9024</td>
<td class="gt_row gt_center" headers="(2)">9024</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">R2</td>
<td class="gt_row gt_center" headers="(1)">0.599</td>
<td class="gt_row gt_center" headers="(2)">0.599</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">R2 Adj.</td>
<td class="gt_row gt_center" headers="(1)">0.597</td>
<td class="gt_row gt_center" headers="(2)">0.597</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">AIC</td>
<td class="gt_row gt_center" headers="(1)">10317.3</td>
<td class="gt_row gt_center" headers="(2)">10317.3</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">BIC</td>
<td class="gt_row gt_center" headers="(1)">10530.5</td>
<td class="gt_row gt_center" headers="(2)">10530.5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Log.Lik.</td>
<td class="gt_row gt_center" headers="(1)">-5128.658</td>
<td class="gt_row gt_center" headers="(2)">-5128.658</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">RMSE</td>
<td class="gt_row gt_center" headers="(1)">0.43</td>
<td class="gt_row gt_center" headers="(2)">0.43</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Std.Errors</td>
<td class="gt_row gt_center" headers="(1)">IID</td>
<td class="gt_row gt_center" headers="(2)">HC3</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="3" class="gt_sourcenote">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>You can see that the variable region was not included in the output (this is because we already have dummies of north (not north = south), and central region). We may need to clean our dataset un some further steps.</p>
<p>Recall that one of the assumptions of a linear model is that errors are independent and identically distributed. We could run some tests to determine this, but with the contrast of the iid and robust errors (HC3) in the modelsummary output table we can already tell that this is not an issue/something to worry about in our estimations.</p>
<p>Besides the regression output table, we can can also visualise the magnitude and significance of the coefficients with a plot. The further away the variable (dot) marker is from the <span class="math inline">\(0\)</span> line, the larger the magnitude.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">modelplot</span>(model1) <span class="sc">+</span> </span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">aes</span>(<span class="at">color =</span> <span class="fu">ifelse</span>(p.value <span class="sc">&lt;</span> <span class="fl">0.001</span>, <span class="st">"Significant"</span>, <span class="st">"Not significant"</span>)) <span class="sc">+</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>              <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"grey"</span>, <span class="st">"black"</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>                                 )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grey points indicate statistically insignificat (p&gt;0.001) coefficient estimates</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The scale of the plot is large due to the intercept estimate</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Not unlike what we saw in out correlation matrix, household size, electricity, having a flush toilet… the magnitude of the impact of these variables on monthly per capita expenditure is significantly larger than that of other assets/predictors.</p>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># Importing more features from the scikit-learn package </span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>model1 <span class="op">=</span> LinearRegression(fit_intercept<span class="op">=</span><span class="va">True</span>).fit(X_train, y_train)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise the output from the linear model</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Coefficients: </span><span class="sc">{</span>model1<span class="sc">.</span>coef_<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Coefficients: [-2.88803518e-01  1.16454588e-02  4.00549713e-03 -5.26522790e-05
  7.46404592e-02  2.59743764e-01 -5.70197786e-02  2.68613159e-01
 -1.10722935e-01  8.48179021e-02  3.97403945e-02  1.22016217e-01
  3.86242046e-01  3.64921504e-01  2.08221283e-01  1.15598316e-01
  9.77483503e-02  1.12175940e-01  1.35028702e-01  1.38280053e-01
  9.19268361e-02  8.76979599e-02 -4.31108804e-02 -7.06557671e-02
 -8.59920259e-02  2.97336875e-02  5.09616025e-02]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Intercept: </span><span class="sc">{</span>model1<span class="sc">.</span>intercept_<span class="sc">}</span><span class="ss">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Intercept: 7.928626868102188</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visualise in a nice way (using the statsmodel.api library)</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>X_train_with_constant <span class="op">=</span> sm.add_constant(X_train) <span class="co"># add a constant to the X feature matrix</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>ols_model <span class="op">=</span> sm.OLS(y_train, X_train_with_constant) <span class="co"># use the statsmodel OLS function to regress X features on Y vector</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the OLS model</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>lm_results <span class="op">=</span> ols_model.fit()</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lm_results.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:         lnexp_pc_month   R-squared:                       0.599
Model:                            OLS   Adj. R-squared:                  0.598
Method:                 Least Squares   F-statistic:                     498.3
Date:                Fri, 28 Mar 2025   Prob (F-statistic):               0.00
Time:                        14:52:57   Log-Likelihood:                -5189.2
No. Observations:                9024   AIC:                         1.043e+04
Df Residuals:                    8996   BIC:                         1.063e+04
Df Model:                          27                                         
Covariance Type:            nonrobust                                         
================================================================================
                   coef    std err          t      P&gt;|t|      [0.025      0.975]
--------------------------------------------------------------------------------
const            7.9286      0.044    179.409      0.000       7.842       8.015
hhsize          -0.2888      0.006    -44.577      0.000      -0.302      -0.276
hhsize2          0.0116      0.000     24.092      0.000       0.011       0.013
agehead          0.0040      0.002      2.327      0.020       0.001       0.007
agehead2     -5.265e-05   1.72e-05     -3.058      0.002   -8.64e-05   -1.89e-05
north            0.0746      0.014      5.156      0.000       0.046       0.103
central          0.2597      0.010     25.294      0.000       0.240       0.280
rural           -0.0570      0.017     -3.384      0.001      -0.090      -0.024
nevermarried     0.2686      0.028      9.519      0.000       0.213       0.324
sharenoedu      -0.1107      0.020     -5.450      0.000      -0.151      -0.071
shareread        0.0848      0.015      5.622      0.000       0.055       0.114
nrooms           0.0397      0.004      9.707      0.000       0.032       0.048
floor_cement     0.1220      0.017      7.012      0.000       0.088       0.156
electricity      0.3862      0.027     14.506      0.000       0.334       0.438
flushtoilet      0.3649      0.032     11.365      0.000       0.302       0.428
soap             0.2082      0.014     14.720      0.000       0.180       0.236
bed              0.1156      0.013      8.933      0.000       0.090       0.141
bike             0.0977      0.011      9.108      0.000       0.077       0.119
musicplayer      0.1122      0.014      7.787      0.000       0.084       0.140
coffeetable      0.1350      0.018      7.483      0.000       0.100       0.170
iron             0.1383      0.014     10.093      0.000       0.111       0.165
dimbagarden      0.0919      0.010      9.003      0.000       0.072       0.112
goats            0.0877      0.012      7.428      0.000       0.065       0.111
dependratio     -0.0431      0.006     -7.396      0.000      -0.055      -0.032
hfem            -0.0707      0.012     -5.687      0.000      -0.095      -0.046
grassroof       -0.0860      0.016     -5.498      0.000      -0.117      -0.055
mortarpestle     0.0297      0.010      2.867      0.004       0.009       0.050
table            0.0510      0.012      4.411      0.000       0.028       0.074
==============================================================================
Omnibus:                      204.679   Durbin-Watson:                   1.992
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              314.826
Skew:                           0.233   Prob(JB):                     4.33e-69
Kurtosis:                       3.787   Cond. No.                     2.68e+04
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 2.68e+04. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>Recall that one of the assumptions of a linear model is that errors are independent and identically distributed. We could run some tests to determine this, but with another quick way to check is to contrast the iid and robust errors (HC3) in the summary output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>lm_robust <span class="op">=</span> sm.OLS(y_train, X_train_with_constant).fit(cov_type<span class="op">=</span><span class="st">'HC3'</span>) <span class="co"># HC3 are also known as robust std errors</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(lm_robust.summary())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            OLS Regression Results                            
==============================================================================
Dep. Variable:         lnexp_pc_month   R-squared:                       0.599
Model:                            OLS   Adj. R-squared:                  0.598
Method:                 Least Squares   F-statistic:                     431.9
Date:                Fri, 28 Mar 2025   Prob (F-statistic):               0.00
Time:                        14:52:57   Log-Likelihood:                -5189.2
No. Observations:                9024   AIC:                         1.043e+04
Df Residuals:                    8996   BIC:                         1.063e+04
Df Model:                          27                                         
Covariance Type:                  HC3                                         
================================================================================
                   coef    std err          z      P&gt;|z|      [0.025      0.975]
--------------------------------------------------------------------------------
const            7.9286      0.066    120.963      0.000       7.800       8.057
hhsize          -0.2888      0.027    -10.502      0.000      -0.343      -0.235
hhsize2          0.0116      0.002      4.732      0.000       0.007       0.016
agehead          0.0040      0.002      2.181      0.029       0.000       0.008
agehead2     -5.265e-05   1.93e-05     -2.733      0.006   -9.04e-05   -1.49e-05
north            0.0746      0.016      4.727      0.000       0.044       0.106
central          0.2597      0.010     25.600      0.000       0.240       0.280
rural           -0.0570      0.017     -3.267      0.001      -0.091      -0.023
nevermarried     0.2686      0.036      7.507      0.000       0.198       0.339
sharenoedu      -0.1107      0.021     -5.338      0.000      -0.151      -0.070
shareread        0.0848      0.015      5.587      0.000       0.055       0.115
nrooms           0.0397      0.005      8.706      0.000       0.031       0.049
floor_cement     0.1220      0.018      6.733      0.000       0.086       0.158
electricity      0.3862      0.030     13.071      0.000       0.328       0.444
flushtoilet      0.3649      0.041      8.939      0.000       0.285       0.445
soap             0.2082      0.014     14.659      0.000       0.180       0.236
bed              0.1156      0.013      8.816      0.000       0.090       0.141
bike             0.0977      0.011      9.053      0.000       0.077       0.119
musicplayer      0.1122      0.015      7.607      0.000       0.083       0.141
coffeetable      0.1350      0.019      7.079      0.000       0.098       0.172
iron             0.1383      0.014     10.158      0.000       0.112       0.165
dimbagarden      0.0919      0.010      8.983      0.000       0.072       0.112
goats            0.0877      0.012      7.553      0.000       0.065       0.110
dependratio     -0.0431      0.008     -5.189      0.000      -0.059      -0.027
hfem            -0.0707      0.013     -5.408      0.000      -0.096      -0.045
grassroof       -0.0860      0.015     -5.648      0.000      -0.116      -0.056
mortarpestle     0.0297      0.010      2.856      0.004       0.009       0.050
table            0.0510      0.012      4.313      0.000       0.028       0.074
==============================================================================
Omnibus:                      204.679   Durbin-Watson:                   1.992
Prob(Omnibus):                  0.000   Jarque-Bera (JB):              314.826
Skew:                           0.233   Prob(JB):                     4.33e-69
Kurtosis:                       3.787   Cond. No.                     2.68e+04
==============================================================================

Notes:
[1] Standard Errors are heteroscedasticity robust (HC3)
[2] The condition number is large, 2.68e+04. This might indicate that there are
strong multicollinearity or other numerical problems.</code></pre>
</div>
</div>
<p>Our results are virtually the same. We’ll continue with the assumption that our simple linear model is homoskedastic.</p>
</div>
</div>
</div>
</section>
<section id="performance-indicators" class="level4">
<h4 class="anchored" data-anchor-id="performance-indicators">Performance Indicators</h4>
<p>In predictive modelling, we are interested in the following performance metrics:</p>
<ul>
<li><p>Model <em>residuals</em>: recall residuals are the observed value minus the predicted value. We can estimate a model’s Root Mean Squared Error (RMSE) or the Mean Absolute Error (MAE). Residuals allow us to quantify the extent to which the predicted response value (for a given observation) is close to the true response value. Small RMSE or MAE values indicate that the prediction is close to the true observed value.</p></li>
<li><p>The <em>p-values</em>: represented by stars *** (and a pre-defined critical threshold, e.g.&nbsp;0.05), they point to the predictive power of each feature in the model; i.e.&nbsp;that the event does not occur by chance. In the same vein, the magnitude of the coefficient is also important, especially given that we are interested in explanatory power and not causality.</p></li>
<li><p>The <em>R-squared</em>: arguably the go-to indicator for performance assessment. Low R^2 values are not uncommon, especially in the social sciences. However, when hoping to use a model for predictive purposes, a low R^2 is a bad sign, large number of statistically significant features notwithstanding. The drawback from relying solely on this measure is that it does not take into consideration the problem of model over-fitting; i.e.&nbsp;you can inflate the R-squared by adding as many variables as you want, even if those variables have little predicting power. This method will yield great results in the training data, but will under perform when extrapolating the model to the test (or indeed any other) data set.</p></li>
</ul>
<p><strong><em>Residuals</em></strong></p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># = = Model Residuals = = #</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(model1<span class="sc">$</span>residuals))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
-3.483927 -0.288657 -0.007872  0.000000  0.266950  1.887123 </code></pre>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># = = Model Residuals = = #</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># residuals of the train dataset </span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># First, predict values of y based on the fitted linear model</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> model1.predict(X_train)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Second, calculate residuals. Recall: observed - predicted</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>residuals_model1 <span class="op">=</span> y_train <span class="op">-</span> y_pred</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute summary statistics of residuals</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a>residual_mean <span class="op">=</span> np.mean(residuals_model1)</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>residual_std <span class="op">=</span> np.std(residuals_model1)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>residual_min <span class="op">=</span> np.<span class="bu">min</span>(residuals_model1)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>residual_25th_percentile <span class="op">=</span> np.percentile(residuals_model1, <span class="dv">25</span>)</span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>residual_median <span class="op">=</span> np.median(residuals_model1)</span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>residual_75th_percentile <span class="op">=</span> np.percentile(residuals_model1, <span class="dv">75</span>)</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>residual_max <span class="op">=</span> np.<span class="bu">max</span>(residuals_model1)</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Print summary statistics</span></span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean of residuals: </span><span class="sc">{</span>residual_mean<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean of residuals: 4.710573932496453e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Standard deviation of residuals: </span><span class="sc">{</span>residual_std<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Standard deviation of residuals: 0.4300319403006682</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Minimum residual: </span><span class="sc">{</span>residual_min<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Minimum residual: -3.277590076409238</code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"25th percentile of residuals: </span><span class="sc">{</span>residual_25th_percentile<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>25th percentile of residuals: -0.28957325945521095</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Median of residuals: </span><span class="sc">{</span>residual_median<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Median of residuals: -0.013638733126897229</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"75th percentile of residuals: </span><span class="sc">{</span>residual_75th_percentile<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>75th percentile of residuals: 0.26574012191749863</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Maximum residual: </span><span class="sc">{</span>residual_max<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Maximum residual: 1.8711412012693707</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Recall that the residual is estimated as the true (observed) value minus the predicted value. Thus: the max(imum) error of 1.88 suggests that the model under-predicted expenditure by circa (log) $2 (or $6.5) for at least one observation. Fifty percent of the predictions (between the first and third quartiles) lie between (log) $0.28 and (log) $0.26 over the true value. From the estimation of the prediction residuals we obtain the popular measure of performance evaluation known as the Root Mean Squared Error (RMSE, for short).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the RMSE for the training dataset, or the in-sample RMSE.</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Predict values on the training dataset</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fu">predict</span>(model1, Train_df)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Obtain the errors (predicted values minus observed values of target variable)</span></span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>error0 <span class="ot">&lt;-</span> p0 <span class="sc">-</span> Train_df[[<span class="st">"lnexp_pc_month"</span>]]</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. In-sample RMSE</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a>RMSE_insample <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(error0 <span class="sc">^</span> <span class="dv">2</span>))</span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(RMSE_insample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4271572</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TIP: Notice that the in-sample RMSE we have just estimated was also printed in the linear model (regression) output tables!</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The table printed with the stargazer package returns this value at the bottom, under the header Residual Std. Error (0.428)</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The table printed with the modelsummary package returns this value at the bottom, under the header RMSE (0.43), rounded up. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the RMSE for the training dataset, or the in-sample RMSE.</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>rmse_insample <span class="op">=</span> mean_squared_error(y_train, y_pred) <span class="op">**</span> <span class="fl">0.5</span>  <span class="co"># Manually taking the square root</span></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(rmse_insample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.43003194030066827</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The RMSE (0.4271) gives us an absolute number that indicates how much our predicted values deviate from the true (observed) number. This is all in reference to the target vector (a.k.a. our outcome variable). Think of the question, <em>how far, on average, are the residuals away from zero?</em> Generally speaking, the lower the value, the better the model fit. Besides being a good measure of goodness of fit, the RMSE is also useful for comparing the ability of our model to make predictions on different (e.g.&nbsp;test) data sets. The in-sample RMSE should be close or equal to the out-of-sample RMSE.</p>
<p>In this case, our RMSE is ~0.4 units away from zero. Given the range of the target variable (roughly 4 to 11), the number seems to be relatively small and close enough to zero.</p>
<p><strong><em>P-values</em></strong></p>
<p>Recall the large number of statistically significant features in our model. The coefficient plot, where we indicate that statistical significance is defined by a p-value threshold of 0.001, a strict rule (given the popularity of the more relaxed 0.05 critical value), shows that only 4 out of 29 features/variables do not meet this criterion. We can conclude that the features we have selected are relevant predictors.</p>
<p><strong><em>R-squared</em></strong></p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(model1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lnexp_pc_month ~ ., data = Train_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.4839 -0.2887 -0.0079  0.2669  1.8871 

Coefficients: (2 not defined because of singularities)
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    7.978e+00  4.409e-02 180.945  &lt; 2e-16 ***
hhsize        -2.919e-01  6.429e-03 -45.397  &lt; 2e-16 ***
hhsize2        1.206e-02  4.811e-04  25.067  &lt; 2e-16 ***
agehead        2.749e-03  1.712e-03   1.606  0.10835    
agehead2      -4.168e-05  1.717e-05  -2.428  0.01519 *  
northNorth     8.001e-02  1.439e-02   5.560 2.78e-08 ***
central1       2.521e-01  1.023e-02  24.639  &lt; 2e-16 ***
rural1        -5.483e-02  1.687e-02  -3.250  0.00116 ** 
nevermarried1  2.706e-01  2.839e-02   9.533  &lt; 2e-16 ***
sharenoedu    -1.045e-01  2.006e-02  -5.212 1.91e-07 ***
shareread      7.514e-02  1.502e-02   5.004 5.72e-07 ***
nrooms         3.898e-02  4.032e-03   9.670  &lt; 2e-16 ***
floor_cement1  1.016e-01  1.742e-02   5.835 5.58e-09 ***
electricity1   3.718e-01  2.696e-02  13.793  &lt; 2e-16 ***
flushtoilet1   3.295e-01  3.263e-02  10.099  &lt; 2e-16 ***
soap1          2.150e-01  1.413e-02  15.220  &lt; 2e-16 ***
bed1           1.040e-01  1.297e-02   8.019 1.20e-15 ***
bike1          9.395e-02  1.064e-02   8.831  &lt; 2e-16 ***
musicplayer1   1.111e-01  1.451e-02   7.658 2.08e-14 ***
coffeetable1   1.369e-01  1.866e-02   7.338 2.36e-13 ***
iron1          1.302e-01  1.378e-02   9.455  &lt; 2e-16 ***
dimbagarden1   1.018e-01  1.017e-02  10.017  &lt; 2e-16 ***
goats1         7.964e-02  1.168e-02   6.820 9.68e-12 ***
dependratio   -4.501e-02  5.848e-03  -7.697 1.55e-14 ***
hfem1         -6.570e-02  1.238e-02  -5.307 1.14e-07 ***
grassroof1    -9.590e-02  1.575e-02  -6.089 1.18e-09 ***
mortarpestle1  3.288e-02  1.027e-02   3.200  0.00138 ** 
table1         5.074e-02  1.149e-02   4.417 1.01e-05 ***
clock1         5.840e-02  1.423e-02   4.103 4.11e-05 ***
regionNorth           NA         NA      NA       NA    
regionSouth           NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4278 on 8995 degrees of freedom
Multiple R-squared:  0.5986,    Adjusted R-squared:  0.5973 
F-statistic:   479 on 28 and 8995 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>We have printed our model’s output once more, now using the r base command summary(). The other packages (stargazer and modelsummary) are great if you want to export your results in text, html, latex format, but not necessary if you just want to print your output.</p>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score <span class="co"># an evaluation metric (r-squared) that we didn't load at the beginning</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>r2_train <span class="op">=</span> r2_score(y_train, model1.predict(X_train))</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the R-squared on the training set</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R-squared on the training dataset: </span><span class="sc">{</span>r2_train<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared on the training dataset: 0.5992973775467875</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The estimated (Multiple) R-squared of 0.59 tells us that our model predicts around 60 per cent of the variation in the independent variable (our target, log of per capita monthly expenditures). Also note that when we have a large number of predictors, it’s best to look at the Adjusted R-squared (of 0.59), which corrects or adjusts for this by only increasing when a new feature improves the model more so than what would be expected by chance.</p>
</section>
<section id="out-of-sample-predictions" class="level4">
<h4 class="anchored" data-anchor-id="out-of-sample-predictions">Out of sample predictions</h4>
<p>Now that we have built and evaluated our model in the training dataset, we can proceed to make out-of-sample predictions. That is, see how our model performs in the test dataset.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">predict</span>(model1, Test_df)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="do">### Observed summary statistics of target variable in full dataset</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(data_malawi<span class="sc">$</span>lnexp_pc_month))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  4.777   6.893   7.305   7.359   7.758  11.064 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Predictions based on the training dataset</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(p0))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  6.011   6.980   7.308   7.357   7.661  10.143 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Predictions from the testing dataset</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(p))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
  6.052   6.999   7.323   7.375   7.670   9.774 </code></pre>
</div>
</div>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predict y(target) values based on the test data model, with model trained on </span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>y_test_pred <span class="op">=</span> model1.predict(X_test)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Root Mean Squared Error on the test set</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>rmse_test <span class="op">=</span> mean_squared_error(y_test, y_test_pred) <span class="op">**</span> <span class="fl">0.5</span>  <span class="co"># Manually taking the square root</span></span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate the R squared of the test model</span></span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a>r2_test <span class="op">=</span> r2_score(y_test, model1.predict(X_test))</span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the Mean Squared Error and R-squared on the test set</span></span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Root Mean Squared Error on the test set: </span><span class="sc">{</span>rmse_test<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error on the test set: 0.4194659226478787</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R-squared on the test dataset: </span><span class="sc">{</span>r2_test<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared on the test dataset: 0.5947626941805588</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The summary statistics for the predictions with the train and test datasets are very close to one another. This is an indication that our model extrapolates well to other datasets. Compared to the observed summary statistics of the target variable, they’re relatively close, with the largest deviations observed at the minimum and maximum values.</p>
</section>
<section id="the-bias-variance-tradeoff-in-practice" class="level4">
<h4 class="anchored" data-anchor-id="the-bias-variance-tradeoff-in-practice">The bias-variance tradeoff in practice</h4>
<p>We previously mentioned that the RMSE metric could also be used to compare between train and test model predictions. Let us estimate the out-of-sample RMSE:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>error <span class="ot">&lt;-</span> p <span class="sc">-</span> Test_df[[<span class="st">"lnexp_pc_month"</span>]] <span class="co"># predicted values minus actual values</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>RMSE_test <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(error<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(RMSE_test) <span class="co"># this is known as the out-of-sample RMSE</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4284404</code></pre>
</div>
</div>
<p>Notice that the <em>in-sample RMSE</em> [<span class="math inline">\(0.4271572\)</span>] is very close to the <em>out-of-sample RMSE</em> [<span class="math inline">\(0.4284404\)</span>]. This means that our model makes consistent predictions across different data sets. We also know by now that these predictions are relatively good. At least, we hit the mark around 60 per cent of the time. What we are observing here is a model that has found a balance between bias and variance. However, both measures can still improve. For one, McBride and Nichols (2018) report &gt; 80 per cent accuracy in their poverty predictions for Malawi. But please note that, at this point, we are not replicating their approach. They document using a classification model, which means that they previously used a poverty line score and divided the sample between individuals below and above the poverty line.</p>
<p><em>What do we mean by bias in a model?</em></p>
<p>The bias is the difference between the average prediction of our model and the true (observed) value. Minimising the bias is analogous to minimising the RMSE.</p>
<p><em>What do we mean by variance in a model?</em></p>
<p>It is the observed variability of our model prediction for a given data point (how much the model can adjust given the data set). A model with high variance would yield low error values in the training data but high errors in the test data.</p>
<p>Hence, consistent in and out of sample RMSE scores = bias/variance balance.</p>
</section>
<section id="fine-tuning-model-parameters" class="level4">
<h4 class="anchored" data-anchor-id="fine-tuning-model-parameters">Fine-tuning model parameters</h4>
<p>Can we fine-tune model parameters? The quick answer is yes! Every algorithm has a set of parameters that can be adjusted/fine-tuned to improve our estimations. Even in the case of a simple linear model, we can try our hand at fine-tuning with, for example, cross-validation.</p>
<p><em>What is cross-validation?</em></p>
<p>Broadly speaking, it is a technique that allows us to assess the performance of our machine learning model. How so? Well, it looks at the ‘stability’ of the model. It’s a measure of how well our model would work on new, unseen data (is this ringing a bell yet?); i.e.&nbsp;it has correctly observed and recorded the patterns in the data and has not captured too much noise (what we know as the error term, or what we are unable to explain with our model). K-fold cross-validation is a good place to start for such a thing. In the words of <a href="https://www.javatpoint.com/cross-validation-in-machine-learning">The Internet™</a>, what k-fold cross validation does is:</p>
<pre><code>Split the input dataset into K groups
    For each group:
        - Take one group as the reserve or test data set.
        - Use remaining groups as the training dataset.
        - Fit the model on the training set and evaluate the performance of the model using the test set.</code></pre>
<p>TL;DR We’re improving our splitting technique!</p>
<p>An Illustration by <a href="https://eugenia-anello.medium.com/">Eugenia Anello</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="assets/kfold_crossvalidation.png" class="img-fluid quarto-figure quarto-figure-center figure-img"></p>
</figure>
</div>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's rumble! </span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-5"><a href="#cb113-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create an object that defines the training method as cross-validation and number of folds (caret pkg)</span></span>
<span id="cb113-6"><a href="#cb113-6" aria-hidden="true" tabindex="-1"></a>cv_10fold <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb113-7"><a href="#cb113-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"cv"</span>, <span class="co">#cross-validation</span></span>
<span id="cb113-8"><a href="#cb113-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">10</span> <span class="co"># k-fold = 10-fold (split the data into 10 similar-sized samples)</span></span>
<span id="cb113-9"><a href="#cb113-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb113-10"><a href="#cb113-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-11"><a href="#cb113-11" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb113-12"><a href="#cb113-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-13"><a href="#cb113-13" aria-hidden="true" tabindex="-1"></a><span class="co"># train a model </span></span>
<span id="cb113-14"><a href="#cb113-14" aria-hidden="true" tabindex="-1"></a>ols_kfold <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb113-15"><a href="#cb113-15" aria-hidden="true" tabindex="-1"></a>    lnexp_pc_month <span class="sc">~</span> .,</span>
<span id="cb113-16"><a href="#cb113-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> Train_df,</span>
<span id="cb113-17"><a href="#cb113-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">'lm'</span>, <span class="co"># runs a linear regression model (or ols)</span></span>
<span id="cb113-18"><a href="#cb113-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> cv_10fold <span class="co"># use 10 folds to cross-validate</span></span>
<span id="cb113-19"><a href="#cb113-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb113-20"><a href="#cb113-20" aria-hidden="true" tabindex="-1"></a>ols_kfold2 <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb113-21"><a href="#cb113-21" aria-hidden="true" tabindex="-1"></a>    lnexp_pc_month <span class="sc">~</span> .,</span>
<span id="cb113-22"><a href="#cb113-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> Test_df,</span>
<span id="cb113-23"><a href="#cb113-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">'lm'</span>, <span class="co"># runs a linear regression model (or ols)</span></span>
<span id="cb113-24"><a href="#cb113-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> cv_10fold <span class="co"># use 10 folds to cross-validate</span></span>
<span id="cb113-25"><a href="#cb113-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb113-26"><a href="#cb113-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-27"><a href="#cb113-27" aria-hidden="true" tabindex="-1"></a>ols_kfold3 <span class="ot">&lt;-</span> <span class="fu">train</span>(</span>
<span id="cb113-28"><a href="#cb113-28" aria-hidden="true" tabindex="-1"></a>    lnexp_pc_month <span class="sc">~</span> .,</span>
<span id="cb113-29"><a href="#cb113-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_malawi,</span>
<span id="cb113-30"><a href="#cb113-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">'lm'</span>, <span class="co"># runs a linear regression model (or ols)</span></span>
<span id="cb113-31"><a href="#cb113-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> cv_10fold <span class="co"># use 10 folds to cross-validate</span></span>
<span id="cb113-32"><a href="#cb113-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb113-33"><a href="#cb113-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-34"><a href="#cb113-34" aria-hidden="true" tabindex="-1"></a><span class="do">### Linear model with train dataset</span></span>
<span id="cb113-35"><a href="#cb113-35" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ols_kfold)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

9024 samples
  29 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 8121, 8121, 8123, 8122, 8121, 8121, ... 
Resampling results:

  RMSE       Rsquared   MAE      
  0.4295064  0.5947776  0.3365398

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### Linear model with test dataset</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ols_kfold2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

2256 samples
  29 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 2030, 2030, 2030, 2030, 2031, 2031, ... 
Resampling results:

  RMSE       Rsquared   MAE      
  0.4312944  0.5991526  0.3379473

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Linear model with full dataset")</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(ols_kfold3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression 

11280 samples
   29 predictor

No pre-processing
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 10152, 10152, 10152, 10152, 10152, 10152, ... 
Resampling results:

  RMSE       Rsquared   MAE      
  0.4291473  0.5965825  0.3363802

Tuning parameter 'intercept' was held constant at a value of TRUE</code></pre>
</div>
</div>
<p>Having cross-validated our model with 10 folds, we can see that the results are virtually the same. We have a RMSE of around .43, an R^2 of .59, (and a MAE of .33). We ran the same model for the train, test and full datasets and find results are consistent. Recall the R^2 tells us the model’s predictive ability and the RMSE and MAE the model’s accuracy.</p>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> cross_val_score, KFold</span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Linear regression model with k-fold cross-validation</span></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This time around, we'll work with a) the full dataset (no need to split beforehand) and b) model objects instead of estimating the </span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a><span class="co"># model on-the-fly!</span></span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a><span class="co"># object that contains an empty linear regression model</span></span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a>model_kcrossval <span class="op">=</span> LinearRegression() </span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a><span class="co"># object that contains the number of folds (or partitions) that we want to have</span></span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a>k_folds <span class="op">=</span> <span class="dv">10</span> <span class="co"># 5 or 10 are standard numbers. Choosing the optimal number of folds is beyond the score of this tutorial. </span></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a><span class="co"># object that contains a k-fold cross-validation </span></span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>model_kf <span class="op">=</span> KFold(n_splits<span class="op">=</span>k_folds, shuffle<span class="op">=</span><span class="va">True</span>, random_state<span class="op">=</span><span class="dv">12345</span>) <span class="co">#recall we had used 12345 as our random state before as well... </span></span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate a k-fold cross-validated model!</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>kfold_mse_scores <span class="op">=</span> <span class="op">-</span>cross_val_score(model_kcrossval, X, y.ravel(), cv<span class="op">=</span>model_kf, scoring<span class="op">=</span><span class="st">'neg_mean_squared_error'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:3: FutureWarning: Series.ravel is deprecated. The underlying array is already 1D, so ravel is not necessary.  Use `to_numpy()` for conversion to a numpy array instead.</code></pre>
</div>
</div>
<p>What is happening in the line of code that estimates the k-fold cross-validated model? Let’s see if we can make sense of it: + The -cross_val_score (yes, with a minus sign) is a function that is used to estimate cross-validation models. + Inside the function, we specify the type of model (model_kcrossval = LinearRegression) + Inside the function, we specify which dataframe (matrix of features X, full dataset minus the target vriable) + Inside the function, we specify which target variable y (full dataset), the y.ravel() is to ensure that the function reads it as a one-dimensional array + Inside the function, we specify what type of cross-validation (cv) technique. Our model_kf object defines the cv technique as a k-fold cross-validation with 10 folds. + Inside the function, we select a ‘scoring’ = negative mean squared error. Why negate the mse? it’s to explicitly tell scikit-learn (the library we are using) to minimise the mean squared errors, it’s default is to maximise them. <br></p>
<p>The output that we get is the estimated mean squared error per fold, but we can also get the average of all folds and the root mean squared error that we’ve been using thus far.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the average mse from all 10 folds</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>average_kfold_mse <span class="op">=</span> np.mean(kfold_mse_scores) <span class="co"># finally, numpy library in action</span></span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Mean Squared Error for each fold:"</span>, kfold_mse_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Mean Squared Error for each fold: [0.1721741  0.17878181 0.19410003 0.17626526 0.19455392 0.18466671
 0.16980631 0.20032969 0.17379885 0.20905726]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Mean Squared Error: </span><span class="sc">{</span>average_kfold_mse<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Mean Squared Error: 0.18535339333850842</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the RMSE, so that we can compare the performance of our cross-validated model</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a>kfold_rmse_scores <span class="op">=</span> np.sqrt(kfold_mse_scores)</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>average_kfold_rmse <span class="op">=</span> np.sqrt(average_kfold_mse)</span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Root Mean Squared Error for each fold:"</span>, kfold_rmse_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error for each fold: [0.41493867 0.42282598 0.44056784 0.41983957 0.44108267 0.42972865
 0.41207561 0.44758204 0.4168919  0.4572278 ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average Root Mean Squared Error: </span><span class="sc">{</span>average_kfold_rmse<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average Root Mean Squared Error: 0.43052687876427465</code></pre>
</div>
</div>
<p>Having cross-validated our model with 10 folds, we can see that the residual results are virtually the same. We have a RMSE of around .43, but what about the R^2? We need to estimate it separately.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># loading (again!) another metric from scikit-learn</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> make_scorer</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a><span class="co"># creating an object for r^2 estimates</span></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a>r2_scorer <span class="op">=</span> make_scorer(r2_score)</span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-7"><a href="#cb129-7" aria-hidden="true" tabindex="-1"></a><span class="co"># export r squared as scoring output instead of mean squared errors</span></span>
<span id="cb129-8"><a href="#cb129-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" aria-hidden="true" tabindex="-1"></a>kfold_r2_scores <span class="op">=</span> cross_val_score(model_kcrossval, X, y.ravel(), cv<span class="op">=</span>model_kf, scoring<span class="op">=</span>r2_scorer) <span class="co"># note: this time, no negative sign at the beggining!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;string&gt;:4: FutureWarning: Series.ravel is deprecated. The underlying array is already 1D, so ravel is not necessary.  Use `to_numpy()` for conversion to a numpy array instead.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the average R^2 for all folds</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>average_r2_scores <span class="op">=</span> np.average(kfold_r2_scores)</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="co"># print results</span></span>
<span id="cb131-5"><a href="#cb131-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-6"><a href="#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R-squared for each fold:"</span>, kfold_r2_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R-squared for each fold: [0.60735695 0.58411959 0.57381508 0.62260601 0.60060855 0.61087529
 0.62923256 0.57307956 0.60035639 0.52943145]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Average R-squared:</span><span class="sc">{</span>average_r2_scores<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Average R-squared:0.5931481424710768</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>NOTE:</strong> k-fold cross-validation replaces our original 80/20 split (we don’t need to do that anymore!) Therefore, we use the full dataset in the train() function. Using the train, test and full datasets in the example above was just for pedagogical purposes but it is no longer necessary and we can use the reported estimates of R^2 (close to 1!), RMSE (close to 0!) and MAE (let’s go low!) for model assessment without comparing them to another set of predictions. These reported parameters are estimated as the average of the R^2, RMSE, and MAE for all the folds.</p>
</section>
</section>
<section id="feature-selection-with-lasso-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="feature-selection-with-lasso-linear-regression">4. Feature selection with Lasso linear regression</h3>
<p>An OLS regression is not the only model that can be written in the form of <span class="math inline">\(Y_i = \alpha + \beta_1X_{1i}, \beta_2X_{2i},..., \beta_pX_{pi}+ u_i\)</span>. In this section we will discuss ‘penalised’ models, which can also be expressed as a linear relationship between parameters. Penalised regression models are also known as regression shrinkage methods, and they take their name after the colloquial term for coefficient regularisation, ‘shrinkage’ of estimated coefficients. The goal of penalised models, as opposed to a traditional linear model, is not to minimise bias (least squares approach), but to reduce variance by adding a constraint to the equation and effectively pushing coefficient parameters towards 0. This results in the the worse model predictors having a coefficient of zero or close to zero.</p>
<p>Consider a scenario where you have hundreds of predictors. Which covariates are truly important for our known outcome? Including all of the predictors leads to <em>over-fitting</em>. We’ll find that the R^2 value is high, and conclude that our in-sample fit is good. However, this may lead to bad out-of-sample predictions. <em>Model selection</em> is a particularly challenging endeavour when we encounter high-dimensional data; i.e.&nbsp;when the number of variables is close to or larger than the number of observations. Some examples where you may encounter high-dimensional data include:</p>
<ol type="1">
<li><p>Cross-country analyses: we have a small and finite number of countries, but we may collect/observe as many variables as we want.</p></li>
<li><p>Cluster-population analyses: we wish to understand the outcome of some unique population <span class="math inline">\(n\)</span>, e.g.&nbsp;all students from classroom A. We collect plenty of information on these students, but the sample and the population are analogous <span class="math inline">\(n = N\)</span>, and thus the sample number of observations is small and finite.</p></li>
</ol>
<p>The LASSO - Least Absolute Shrinkage and Selection Operator imposes a shrinking penalty to those predictors that do not actually belong in the model, and reduces the size of the estimated <span class="math inline">\(\beta\)</span> coefficients towards and including zero (when the tuning parameter/ shrinkage penalty <span class="math inline">\(\lambda\)</span> is sufficiently large). Note that <span class="math inline">\(lambda\)</span> is the penalty term called <em>L1-norm</em>, and corresponds to the sum of the absolute coefficients.</p>
<p>What does this mean for our case? Well, McBride and Nichols (2018) used two sources to compile their final dataset (which we are using). One of those sources is the Living Standards Measurement Study (<a href="https://www.worldbank.org/en/programs/lsms">LSMS</a>) from the World Bank Group. These surveys collect more than 500 variables/ features per country case. You can subset the dataset with critical reasoning: using your knowledge of the phenomenon, which features might best describe it? But even then, we might still end up with a large number of features. Perhaps a LASSO approach could work here.</p>
<p>Our own data is not ideal for the approach, because it has a small number of features (<span class="math inline">\(29\)</span>), compared to the large number of observations (<span class="math inline">\(11,280\)</span>). But let’s run a lasso regression and see if my statement holds. How would I know if it holds? If the Lasso regression returns the same values for the performance assessment parameters as the OLS regression; this means that the penalisation parameter was either zero (leading back to an OLS) or too small to make a difference.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="do">### small detour ... </span></span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lnexp_pc_month ~ ., data = Train_df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.4839 -0.2887 -0.0079  0.2669  1.8871 

Coefficients: (2 not defined because of singularities)
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    7.978e+00  4.409e-02 180.945  &lt; 2e-16 ***
hhsize        -2.919e-01  6.429e-03 -45.397  &lt; 2e-16 ***
hhsize2        1.206e-02  4.811e-04  25.067  &lt; 2e-16 ***
agehead        2.749e-03  1.712e-03   1.606  0.10835    
agehead2      -4.168e-05  1.717e-05  -2.428  0.01519 *  
northNorth     8.001e-02  1.439e-02   5.560 2.78e-08 ***
central1       2.521e-01  1.023e-02  24.639  &lt; 2e-16 ***
rural1        -5.483e-02  1.687e-02  -3.250  0.00116 ** 
nevermarried1  2.706e-01  2.839e-02   9.533  &lt; 2e-16 ***
sharenoedu    -1.045e-01  2.006e-02  -5.212 1.91e-07 ***
shareread      7.514e-02  1.502e-02   5.004 5.72e-07 ***
nrooms         3.898e-02  4.032e-03   9.670  &lt; 2e-16 ***
floor_cement1  1.016e-01  1.742e-02   5.835 5.58e-09 ***
electricity1   3.718e-01  2.696e-02  13.793  &lt; 2e-16 ***
flushtoilet1   3.295e-01  3.263e-02  10.099  &lt; 2e-16 ***
soap1          2.150e-01  1.413e-02  15.220  &lt; 2e-16 ***
bed1           1.040e-01  1.297e-02   8.019 1.20e-15 ***
bike1          9.395e-02  1.064e-02   8.831  &lt; 2e-16 ***
musicplayer1   1.111e-01  1.451e-02   7.658 2.08e-14 ***
coffeetable1   1.369e-01  1.866e-02   7.338 2.36e-13 ***
iron1          1.302e-01  1.378e-02   9.455  &lt; 2e-16 ***
dimbagarden1   1.018e-01  1.017e-02  10.017  &lt; 2e-16 ***
goats1         7.964e-02  1.168e-02   6.820 9.68e-12 ***
dependratio   -4.501e-02  5.848e-03  -7.697 1.55e-14 ***
hfem1         -6.570e-02  1.238e-02  -5.307 1.14e-07 ***
grassroof1    -9.590e-02  1.575e-02  -6.089 1.18e-09 ***
mortarpestle1  3.288e-02  1.027e-02   3.200  0.00138 ** 
table1         5.074e-02  1.149e-02   4.417 1.01e-05 ***
clock1         5.840e-02  1.423e-02   4.103 4.11e-05 ***
regionNorth           NA         NA      NA       NA    
regionSouth           NA         NA      NA       NA    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4278 on 8995 degrees of freedom
Multiple R-squared:  0.5986,    Adjusted R-squared:  0.5973 
F-statistic:   479 on 28 and 8995 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># notice that region dummies are repeated and therefore return NA in the output. We should clean this before proceeding.</span></span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="co"># these guys are troublesome (recall our conversation about zero-variance predictors?)</span></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a>data_malawi2 <span class="ot">&lt;-</span> data_malawi[,<span class="sc">-</span><span class="fu">which</span>(<span class="fu">colnames</span>(data_malawi)<span class="sc">==</span><span class="st">"region"</span>)]</span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(lnexp_pc_month<span class="sc">~</span>., <span class="at">data =</span> data_malawi2)) <span class="co"># no more excluded categorical variables (recall this happened in our original linear model due to repeated measures?)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = lnexp_pc_month ~ ., data = data_malawi2)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.6626 -0.2906 -0.0096  0.2665  1.8788 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    7.965e+00  3.947e-02 201.781  &lt; 2e-16 ***
hhsize        -2.979e-01  5.854e-03 -50.893  &lt; 2e-16 ***
hhsize2        1.246e-02  4.401e-04  28.307  &lt; 2e-16 ***
agehead        3.545e-03  1.529e-03   2.319 0.020433 *  
agehead2      -5.079e-05  1.532e-05  -3.315 0.000918 ***
northNorth     7.452e-02  1.292e-02   5.766 8.32e-09 ***
central1       2.552e-01  9.119e-03  27.979  &lt; 2e-16 ***
rural1        -5.488e-02  1.507e-02  -3.642 0.000272 ***
nevermarried1  2.416e-01  2.507e-02   9.638  &lt; 2e-16 ***
sharenoedu    -1.053e-01  1.802e-02  -5.845 5.21e-09 ***
shareread      7.838e-02  1.344e-02   5.832 5.63e-09 ***
nrooms         4.182e-02  3.609e-03  11.587  &lt; 2e-16 ***
floor_cement1  9.460e-02  1.546e-02   6.119 9.73e-10 ***
electricity1   3.719e-01  2.387e-02  15.579  &lt; 2e-16 ***
flushtoilet1   3.471e-01  2.886e-02  12.027  &lt; 2e-16 ***
soap1          2.163e-01  1.261e-02  17.154  &lt; 2e-16 ***
bed1           1.051e-01  1.156e-02   9.099  &lt; 2e-16 ***
bike1          9.405e-02  9.516e-03   9.883  &lt; 2e-16 ***
musicplayer1   1.090e-01  1.287e-02   8.466  &lt; 2e-16 ***
coffeetable1   1.311e-01  1.641e-02   7.991 1.47e-15 ***
iron1          1.325e-01  1.231e-02  10.761  &lt; 2e-16 ***
dimbagarden1   9.140e-02  9.095e-03  10.049  &lt; 2e-16 ***
goats1         8.671e-02  1.049e-02   8.269  &lt; 2e-16 ***
dependratio   -4.086e-02  5.225e-03  -7.820 5.74e-15 ***
hfem1         -6.761e-02  1.102e-02  -6.135 8.80e-10 ***
grassroof1    -9.138e-02  1.394e-02  -6.556 5.77e-11 ***
mortarpestle1  3.207e-02  9.193e-03   3.489 0.000487 ***
table1         5.132e-02  1.029e-02   4.987 6.23e-07 ***
clock1         6.254e-02  1.273e-02   4.912 9.16e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.4278 on 11251 degrees of freedom
Multiple R-squared:  0.5997,    Adjusted R-squared:  0.5987 
F-statistic: 601.9 on 28 and 11251 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>cv_10fold <span class="ot">&lt;-</span> <span class="fu">trainControl</span>(</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"cv"</span>, </span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">number =</span> <span class="dv">10</span> </span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">12345</span>)</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>model_lasso <span class="ot">&lt;-</span> caret<span class="sc">::</span><span class="fu">train</span>(</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>    lnexp_pc_month <span class="sc">~</span> .,</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data_malawi,</span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">'lasso'</span>,</span>
<span id="cb139-11"><a href="#cb139-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">preProcess =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>), <span class="co">#This will first center and then scale all relevant variables in the model</span></span>
<span id="cb139-12"><a href="#cb139-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">trControl =</span> cv_10fold <span class="co"># use 10 folds to cross-validate // we already know this fine-tuning may not be needed!</span></span>
<span id="cb139-13"><a href="#cb139-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb139-14"><a href="#cb139-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-15"><a href="#cb139-15" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(model_lasso) <span class="co"># best R^2 and RMSE is similar to the one using a linear regression...( and so is the MAE!)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The lasso 

11280 samples
   29 predictor

Pre-processing: centered (30), scaled (30) 
Resampling: Cross-Validated (10 fold) 
Summary of sample sizes: 10152, 10152, 10152, 10152, 10152, 10152, ... 
Resampling results across tuning parameters:

  fraction  RMSE       Rsquared   MAE      
  0.1       0.5953796  0.4234291  0.4653872
  0.5       0.4485973  0.5660193  0.3533998
  0.9       0.4295497  0.5957600  0.3368464

RMSE was used to select the optimal model using the smallest value.
The final value used for the model was fraction = 0.9.</code></pre>
</div>
</div>
<section id="parameter-tuning-in-our-lasso-regression" class="level4">
<h4 class="anchored" data-anchor-id="parameter-tuning-in-our-lasso-regression">Parameter-tuning in our Lasso regression</h4>
<p>Let’s start with centering and scaling variables; why do we do that?</p>
<p><em>Centering and Scaling in Lasso</em>: Recall that the L1-norm puts constraints on the size of the coefficients of the Lasso regression. The size, of course, differs based on the different scales the variables are measured. Having <span class="math inline">\(1\)</span> and up to <span class="math inline">\(55\)</span> electric gadgets at home is not the same as earning between <span class="math inline">\(1000\)</span> and <span class="math inline">\(100,000\)</span> monthly (of whichever currency you want to imagine here). There are two immediate consequences of centering and scaling (or normalising). 1) There is no longer an intercept. 2) It is easier to rank the relative magnitude of the coefficients post-shrinkage.</p>
<p><em>Cross-validation in Lasso:</em> Beyond training and testing dataframes, what a k-fold (commonly 10-fold) cross validation does is resample the data to find an optimal (λ) lambda/penalisation for the lasso model and assess its predictive error. Recall: The optimal λ (lambda)/penalisation minimizes the out-of-sample (or test) mean prediction error.</p>
<p>This tuning is already included in the chunk of code above.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's visualise our lasso model:</span></span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_lasso)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"The x-axis is the fraction of the full solution (i.e., ordinary least squares with no penalty)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>The x-axis is the fraction of the full solution (i.e., ordinary least squares with no penalty)</code></pre>
</div>
</div>
<p>It seems that the fraction used (0.9) is close to the non-penalised model (or OLS/linear). Our original claim that this particular set-up does not call for a Lasso approach was correct. We may want to try other machine learning algorithms to see if we can improve our initial predictions!</p>
</section>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># (linear) Lasso with scikit-learn</span></span>
<span id="cb144-2"><a href="#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> Lasso</span>
<span id="cb144-3"><a href="#cb144-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb144-4"><a href="#cb144-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-5"><a href="#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="co"># before we proceed, we must center and scale (normalise) our features</span></span>
<span id="cb144-6"><a href="#cb144-6" aria-hidden="true" tabindex="-1"></a>normalise_obj <span class="op">=</span> StandardScaler()</span>
<span id="cb144-7"><a href="#cb144-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-8"><a href="#cb144-8" aria-hidden="true" tabindex="-1"></a><span class="co"># normalise both train and test data (we don't need to cross-validate, remember? back to our 20/80 split df!)</span></span>
<span id="cb144-9"><a href="#cb144-9" aria-hidden="true" tabindex="-1"></a>X_train_scaled <span class="op">=</span> normalise_obj.fit_transform(X_train) <span class="co"># fit on train dataset and then normalise train dataset</span></span>
<span id="cb144-10"><a href="#cb144-10" aria-hidden="true" tabindex="-1"></a>X_test_scaled <span class="op">=</span> normalise_obj.transform(X_test) <span class="co"># no  need to re-fit, just normalise test dataset</span></span>
<span id="cb144-11"><a href="#cb144-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-12"><a href="#cb144-12" aria-hidden="true" tabindex="-1"></a><span class="co"># create lasso model</span></span>
<span id="cb144-13"><a href="#cb144-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-14"><a href="#cb144-14" aria-hidden="true" tabindex="-1"></a>lasso_model <span class="op">=</span> Lasso(alpha<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb144-15"><a href="#cb144-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-16"><a href="#cb144-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"alpha is the regularisation parameter. The closer the alpha value is to zero, the more the model is close to a simple linear regression. Let's start with the smallest value of alpha, and increase if needed."</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>alpha is the regularisation parameter. The closer the alpha value is to zero, the more the model is close to a simple linear regression. Let's start with the smallest value of alpha, and increase if needed.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the lasso model on the training data</span></span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a>lasso_model.fit(X_train_scaled, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Lasso(alpha=0.1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>Lasso</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.Lasso.html">?<span>Documentation for Lasso</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Lasso(alpha=0.1)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make predictions on the test dataset</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>y_lasso_pred <span class="op">=</span> lasso_model.predict(X_test_scaled)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate Root Mean Squared Error on the test set</span></span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>mse_lasso <span class="op">=</span> mean_squared_error(y_test, y_lasso_pred)</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>rmse_lasso <span class="op">=</span> np.sqrt(mse_lasso)</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the Mean Squared Error</span></span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Root Mean Squared Error on the scaled test set: </span><span class="sc">{</span>rmse_lasso<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error on the scaled test set: 0.5049684278065933</code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE on train data</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>y_lasso_pred_train <span class="op">=</span> lasso_model.predict(X_train_scaled)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>mse_lasso_train <span class="op">=</span> mean_squared_error(y_train, y_lasso_pred_train)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a>rmse_lasso_train <span class="op">=</span> np.sqrt(mse_lasso_train)</span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Root Mean Squared Error on the scaled train set: </span><span class="sc">{</span>rmse_lasso_train<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error on the scaled train set: 0.5172317065909608</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># R squared</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>r2_train <span class="op">=</span> r2_score(y_train, y_lasso_pred_train)</span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>r2_test <span class="op">=</span> r2_score(y_test, y_lasso_pred)</span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"R squared on train: </span><span class="sc">{</span>r2_train<span class="sc">}</span><span class="ss"> and test: </span><span class="sc">{</span>r2_test<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R squared on train: 0.4203163697877488 and test: 0.41272095987451374</code></pre>
</div>
</div>
<p>With an in-sample RMSE of <span class="math inline">\(0.51\)</span> and an out-of-sample RMSE of <span class="math inline">\(0.5\)</span> a Lasso with a small penalisation parameter performs worse than a simple linear regression. Similarly, our R^2 estimates which were at <span class="math inline">\(0.59\)</span> before, have now decreased to <span class="math inline">\(0.42\)</span>. Do we increase or decrease the regularization parameter <span class="math inline">\(\alpha\)</span> ? Let’s try decreasing it first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># decrease the size of alpha (getting closer to a simple linear regression)</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>lasso_model2 <span class="op">=</span> Lasso(alpha<span class="op">=</span><span class="fl">0.01</span>)</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model on the train</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>lasso_model2.fit(X_train_scaled, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-2 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-2 {
  color: var(--sklearn-color-text);
}

#sk-container-id-2 pre {
  padding: 0;
}

#sk-container-id-2 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-2 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-2 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-2 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-2 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-2 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-2 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-2 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-2 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-2 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-2 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-2 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-2 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-2 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-2 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-2 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-2 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-2 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-2 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-2 div.sk-label label.sk-toggleable__label,
#sk-container-id-2 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-2 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-2 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-2 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-2 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-2 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-2 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-2 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-2 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-2 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-2 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-2 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-2 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-2" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>Lasso(alpha=0.01)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-2" type="checkbox" checked=""><label for="sk-estimator-id-2" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>Lasso</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.Lasso.html">?<span>Documentation for Lasso</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>Lasso(alpha=0.01)</pre></div> </div></div></div></div>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make predictions on the test dataset</span></span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>y_lasso2_pred <span class="op">=</span> lasso_model2.predict(X_test_scaled)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-4"><a href="#cb154-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-5"><a href="#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate Root Mean Squared Error on the test set</span></span>
<span id="cb154-6"><a href="#cb154-6" aria-hidden="true" tabindex="-1"></a>mse_lasso2 <span class="op">=</span> mean_squared_error(y_test, y_lasso2_pred)</span>
<span id="cb154-7"><a href="#cb154-7" aria-hidden="true" tabindex="-1"></a>rmse_lasso2 <span class="op">=</span> np.sqrt(mse_lasso2)</span>
<span id="cb154-8"><a href="#cb154-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb154-9"><a href="#cb154-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the Mean Squared Error</span></span>
<span id="cb154-10"><a href="#cb154-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Root Mean Squared Error of Lasso with 0.01 alpha: </span><span class="sc">{</span>rmse_lasso2<span class="sc">}</span><span class="ss"> vs 0.1 alpha: </span><span class="sc">{</span>rmse_lasso<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root Mean Squared Error of Lasso with 0.01 alpha: 0.42888481934365835 vs 0.1 alpha: 0.5049684278065933</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># optional: plot variable relevance!</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a><span class="co"># store coefficients in a dataframe first</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>coefficients <span class="op">=</span> lasso_model2.coef_</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>df_coef <span class="op">=</span> pd.DataFrame({<span class="st">"Att"</span>: X.columns, <span class="st">"Coefs"</span>: coefficients})</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>plt.barh(df_coef[<span class="st">'Att'</span>], df_coef[<span class="st">'Coefs'</span>], color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Variable Importance - Lasso Regression with 0.01 alpha'</span>)</span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Coefficient Magnitude'</span>)</span>
<span id="cb156-11"><a href="#cb156-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Feature'</span>)</span>
<span id="cb156-12"><a href="#cb156-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="predictionpolicy_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p>The performance of our model with a smaller alpha (closer to <span class="math inline">\(0\)</span>, or NO penalisation = simple linear regression) based on the RMSE indicates that the best performing machine learning model is still a simple linear regression, like we had initially suggested (given what we know about the structure of our data). Our dataset is not a candidate for feature selection with LASSO modelling. Also, you should know that you don’t have to manually search for the best value of alpha. You can import a search algorithm, also from the scikit-learn library, called GridSearchCV. The search algorithm will search for the optimal value of alpha for you, from a pre-defined range (you do have to manually set the range yourself).</p>
</div>
</div>
</div>
<p>A final note: there is some discussion over whether k-fold or really any cross-validation technique is optimal for choosing the lambda parameter in Lasso models (see for example, this Coursera <a href="https://www.coursera.org/lecture/ml-regression/choosing-the-penalty-strength-and-other-practical-issues-with-lasso-SPr8p">video</a>). It is true that cross-validation is something that we want to do for ALL our machine learning models. Just make sure to make an informed choice of which cv technique you’ll implement in your model.</p>
<p><strong>A setup with multiple categorical variables is problematic with Lasso!</strong></p>
<p>Lasso models do not perform well with multiple categorical variables. As is our case. Primarily because, in order to work with categorical data in lasso models we encode them as dummies (for example, north = <span class="math inline">\(1\)</span> and <span class="math inline">\(0\)</span> otherwise, center = <span class="math inline">\(1\)</span> and <span class="math inline">\(0\)</span> otherwise). Lasso will thus only consider the dummy, and not the concept of the ‘region’). An alternative to that is a Group Lasso. If you’d like to read more on that, you can have a look at this <a href="https://towardsdatascience.com/beyond-linear-regression-467a7fc3bafb#:~:text=Lasso%20feature%20selection%20works%20well,with%20few%20non%2Dzero%20coefficients.">Towards Data Science Post</a>.</p>
</section>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
<p>At this point, our best predictions are made with a linear regression algorithm, which bested a lasso model. As we progress, we will explore other common machine learning algorithms to see whether our prediction capabilities improve!.</p>
</section>
<section id="practice-at-home" class="level2">
<h2 class="anchored" data-anchor-id="practice-at-home">Practice at home</h2>
<p>You can replicate the exercises in Python or R using the Malawi dataset. However, if you’d like a challenge, you can also try running a Linear and a Lasso Linear model using a similar dataset for the country of Bolivia. The dataset was put together by McBride and Nichols for the same paper for which they used the Malawi dataset.</p>
<p><a class="btn btn-primary" download="" href="data/bolivia.csv"> Download Bolivia df CSV </a></p>
</section>
<section id="readings" class="level2">
<h2 class="anchored" data-anchor-id="readings">Readings</h2>
<p><em>Mandatory</em></p>
<ul>
<li><p>An introduction to Statistical learning, Chapter 2, 3 (Regression), 5 (Cross-validation) and 6 (for more about Lasso).</p></li>
<li><p>Athey, S. (2017). <a href="https://www.science.org/doi/10.1126/science.aal4321">Beyond prediction: Using big data for policy problems</a>. Science, 355(6324), 483-485.</p></li>
<li><p>Kleinberg, J., Ludwig, J., Mullainathan, S. and Obermeyer, Z., 2015. <a href="https://www.aeaweb.org/articles?id=10.1257/aer.p20151023">Prediction policy problems. American Economic Review</a>, 105(5), pp.491-95.</p></li>
</ul>
<p><em>Optional readings</em></p>
<ul>
<li><p>Kleinberg, J., Lakkaraju, H., Leskovec, J., Ludwig, J. and Mullainathan, S., 2017. <a href="https://academic.oup.com/qje/article-abstract/133/1/237/4095198?redirectedFrom=fulltext">Human decisions and machine predictions.</a> The Quarterly Journal of Economics, 133(1), pp.237-293.</p></li>
<li><p>Hanna, R., &amp; Olken, B. A. (2018). <a href="https://www.aeaweb.org/articles?id=10.1257/jep.32.4.201">Universal basic incomes versus targeted transfers: Anti-poverty programs in developing countries.</a> Journal of Economic Perspectives, 32(4), 201-26. (exercise application)</p></li>
<li><p>McBride, L., &amp; Nichols, A. (2018). <a href="https://academic.oup.com/wber/article-abstract/32/3/531/2447896?redirectedFrom=fulltext">Retooling poverty targeting using out-of-sample validation and machine learning.</a> The World Bank Economic Review, 32(3), 531-550.pter 5.1</p></li>
</ul>
<!--DISQUS COMMENTS SCRIPT-->
<div id="disqus_thread">

</div>
<script>
    var disqus_config = function () {
    this.page.identifier = "predictionpolicy.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://unu-merit.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>
Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


</section>

<div class="footer">
Copyright © 2025 Michelle González Amador &amp; Stephan Dietrich. All rights reserved.<br> <a href="https://github.com/michelleg06/Machine-Learning-for-Public-Policy"><img src="https://img.shields.io/badge/GitHub-Repository-blue?logo=github.png" class="img-fluid" alt="GitHub"></a>
</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>