<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.41">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Prediction Policy Problems – Machine Learning for Public Policy</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-45c9daaf6acd34b0420988892e8b8644.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-73ee73b83b1a433826722856a32939c3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="./assets/ML4PP.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Machine Learning for Public Policy</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-introduction" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Introduction</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-introduction">    
        <li>
    <a class="dropdown-item" href="./introduction.html">
 <span class="dropdown-text">Introduction</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./r-intro.html">
 <span class="dropdown-text">An Introduction to R Programming</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./python-intro.html">
 <span class="dropdown-text">An introduction to Python programming</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-content" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Content</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-content">    
        <li>
    <a class="dropdown-item" href="./session_1.html">
 <span class="dropdown-text">Prediction Policy Problems</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./classification.html">
 <span class="dropdown-text">Classification with Logistic Regression</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./treebasedmodels.html">
 <span class="dropdown-text">Tree-based models for classification problems</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./fairml.html">
 <span class="dropdown-text">Algorithmic Fairness</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./neuralNets.html">
 <span class="dropdown-text">An Introduction to Neural Networks</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-collaborative-policy-challenge" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Collaborative Policy Challenge</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-collaborative-policy-challenge">    
        <li>
    <a class="dropdown-item" href="./policy-challenge-2024.html">
 <span class="dropdown-text">2024</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./policy-challenge-2025.html">
 <span class="dropdown-text">2025</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/lucasboh/ml4p-website-v2" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introducing-the-prediction-policy-framework" id="toc-introducing-the-prediction-policy-framework" class="nav-link active" data-scroll-target="#introducing-the-prediction-policy-framework">Introducing the Prediction Policy Framework</a>
  <ul class="collapse">
  <li><a href="#predicting-social-assistance-beneficiaries" id="toc-predicting-social-assistance-beneficiaries" class="nav-link" data-scroll-target="#predicting-social-assistance-beneficiaries">Predicting social assistance beneficiaries</a></li>
  </ul></li>
  <li><a href="#practical-example" id="toc-practical-example" class="nav-link" data-scroll-target="#practical-example">Practical Example</a>
  <ul class="collapse">
  <li><a href="#preliminaries-working-directory-libraries-data-upload." id="toc-preliminaries-working-directory-libraries-data-upload." class="nav-link" data-scroll-target="#preliminaries-working-directory-libraries-data-upload.">1. Preliminaries: working directory, libraries, data upload.</a></li>
  <li><a href="#get-to-know-your-data-pre-processing-and-data-familiarization." id="toc-get-to-know-your-data-pre-processing-and-data-familiarization." class="nav-link" data-scroll-target="#get-to-know-your-data-pre-processing-and-data-familiarization.">2. Get to know your data: pre-processing and data familiarization.</a></li>
  <li><a href="#a-primer-on-ml-prediction" id="toc-a-primer-on-ml-prediction" class="nav-link" data-scroll-target="#a-primer-on-ml-prediction">3. A primer on ML prediction</a></li>
  </ul></li>
  <li><a href="#readings" id="toc-readings" class="nav-link" data-scroll-target="#readings">Readings</a></li>
  <li><a href="#assignment" id="toc-assignment" class="nav-link" data-scroll-target="#assignment">Assignment:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Prediction Policy Problems</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><strong>This section will cover:</strong></p>
<ul>
<li><p>Prediction Policy problems</p></li>
<li><p>Inference vs.&nbsp;prediction for policy analysis</p></li>
<li><p>Prediction framework: training - test data</p></li>
<li><p>Training error vs.&nbsp;test error</p></li>
<li><p>Assessing accuracy: bias-variance trade-off</p></li>
</ul>
<p><br></p>
<section id="introducing-the-prediction-policy-framework" class="level2">
<h2 class="anchored" data-anchor-id="introducing-the-prediction-policy-framework">Introducing the Prediction Policy Framework</h2>
<p>In the video-lecture below you’ll be given a brief introduction to the prediction policy framework, and a primer on machine learning. Please take a moment to watch the 20 minute video.</p>
<div class="quarto-video ratio ratio-16x9"><iframe data-external="1" src="https://www.youtube.com/embed/sFbKe4O0tEQ" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div>
<section id="predicting-social-assistance-beneficiaries" class="level3">
<h3 class="anchored" data-anchor-id="predicting-social-assistance-beneficiaries">Predicting social assistance beneficiaries</h3>
<p>A key challenge in designing social policies is identifying individuals in need of social assistance. With tight budgets, it’s crucial to allocate resources efficiently, targeting benefits to those who need them most. However, identifying needs can be difficult, and misclassifications can have severe and irreversible effects on people in need.</p>
<p>Consider a social protection program that allocates food vouchers to families with children at risk of malnutrition, or a program that provides needs-based school grants. What happens when limited resources are given to those who don’t need them, while those who need them most are excluded? Case Study: Predicting Cash-Transfer Programme Beneficiaries in Malawi</p>
<p>In this section, we’ll work with real-world data from Malawi to predict beneficiaries of a cash-transfer program: individuals living in poverty who need government assistance to make ends meet. The data comes from Malawi’s Living Standards Measurement Study 2019/2020, publicly available at the <a href="https://www.google.com/url?q=https%3A%2F%2Fmicrodata.worldbank.org%2Findex.php%2Fcatalog%2F3818">World Bank data catalogue</a>. The dataset comprises responses from 11,434 households to a comprehensive list of questions regarding household composition, economic activities, assets, savings, education, and more. Note that the data set is a <em>.dta</em> STATA file.</p>
<p>Each row in the tabular<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> data represents a household, while each column represents a question. The values show the household’s response, and the column headers carry the name and number of the question in the questionnaire. For example, the variable <code>hh_f10</code> refers to the household questionnaire <strong>(hh)</strong>, the housing module <strong>(module F)</strong>, and question number <strong>10</strong>. By looking up this question in the questionnaire, we find that the values in the column <code>hh_f10</code> refer to the question <strong>“How many separate rooms do the members of your household occupy?”</strong></p>
<section id="discussion-points" class="level4">
<h4 class="anchored" data-anchor-id="discussion-points">Discussion Points</h4>
<p>In the next sessions, we’ll discuss the following key points:</p>
<ul>
<li><p>Why is this a prediction policy problem?</p>
<ul>
<li>Is it a regression or a classification problem?</li>
</ul></li>
<li><p>Which variables and characteristics should we include in the prediction model to make a significant difference?</p></li>
<li><p>Programmatically, what type of characteristics do we want to consider for the prediction model?</p></li>
<li><p>Technically, how do we select which variables to include in a prediction model?</p></li>
<li><p>What are the practical implications of the bias-variance trade-off in this application?</p></li>
<li><p>What are the potential risks of a data-driven targeting approach?</p></li>
</ul>
<p>These points will serve as our starting point for critically thinking about the use of machine learning in public policies.</p>
<p>Please share your questions and feedback with the community in the discussion box at the bottom of this page!</p>
</section>
</section>
</section>
<section id="practical-example" class="level2">
<h2 class="anchored" data-anchor-id="practical-example">Practical Example</h2>
<p>You can download the dataset by clicking on the button below.</p>
<p><a class="btn btn-primary" download="" href="data/malawi.dta"> Download Malawi.dta </a></p>
<p><br></p>
<p>The script below is a step by step on how to go about coding a predictive model using a <em>linear regression</em>. Despite its simplicity and transparency, i.e.&nbsp;the ease with which we can interpret its results, a linear model is not without challenges in machine learning.</p>
<section id="preliminaries-working-directory-libraries-data-upload." class="level3">
<h3 class="anchored" data-anchor-id="preliminaries-working-directory-libraries-data-upload.">1. Preliminaries: working directory, libraries, data upload.</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries for data-wrangling</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)   <span class="co"># Collection of packages for data manipulation and visualization</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skimr)       <span class="co"># Quick data profiling and summary statistics</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(haven)       <span class="co"># Import foreign statistical formats into R</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fastDummies) <span class="co"># Convert variables into binary (dummy variables) fastly</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries for data analysis and visualization</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrplot)     <span class="co"># Correlation matrix visualization</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelsummary) <span class="co"># Model output summarization and tables</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gt)           <span class="co"># Table formatting and presentation</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stargazer)    <span class="co"># Statistical model output visualization</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Machine Learning library</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)        <span class="co"># Machine learning functions and model training</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries for data-wrangling</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd <span class="co"># Data manipulation and analysis with DataFrames</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># Numerical computing and array operations</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os           <span class="co"># Operating system interface for file/directory operations</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> skimpy       <span class="co"># Quick data profiling and summary statistics </span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries for data analysis and visualization</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt                       <span class="co"># Basic plotting and visualization</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns                                 <span class="co"># Statistical data visualization built on matplotlib</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pickle                                         <span class="co"># Object serialization for saving/loading Python objects</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Machine Learning Library</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> train_test_split  <span class="co"># Split datasets into train/test sets</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.linear_model <span class="im">import</span> LinearRegression     <span class="co"># OLS regression</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> root_mean_squared_error   <span class="co"># Estimate RMSE</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> r2_score                  <span class="co"># Estimate R^2</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler      <span class="co"># Feature scaling and normalization</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><strong>Loading the dataset</strong> The data set comes as .dta file (STATA file) and not as a standard comma separated file (.csv). While the file has the same tabular structure, STATA files have variable labels, i.e.&nbsp;short texts that describe the variables with rather cryptic variable names. We can preserve these variable lables and store them as a separate object that we can use for quick variable look-ups.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(<span class="st">'/Users/lucas/Documents/UNU-CDO/courses/ml4p/ml4p-website-v2'</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the Stata file with labels preserved</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>malawi <span class="ot">&lt;-</span> <span class="fu">read_dta</span>(<span class="st">"data/malawi.dta"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Get variable labels</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>variable_labels <span class="ot">&lt;-</span> <span class="fu">sapply</span>(malawi, <span class="cf">function</span>(x) <span class="fu">attr</span>(x, <span class="st">"label"</span>))</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># List all variables and their corresponding labels. For more details, check the questionnaire. Variable names correspond to the question numbers (hh=household module; com=community module)</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(variable_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                           case_id 
                                                     "Unique Household Identifier" 
                                                                              HHID 
                                           "Survey Solutions Unique HH Identifier" 
                                                                             ea_id 
                                                    "Unique Enumeration Area Code" 
                                                                            region 
                                                       "IHS5 2019 Region location" 
                                                                          district 
                                                     "IHS5 2019 District Location" 
                                                                            reside 
                                                       "IHS5 2019 Rural Residence" 
                                                                     interviewDate 
                                                                  "Interview Date" 
                                                                            hh_wgt 
                                                       "Household Sampling Weight" 
                                                                            hh_a22 
                                                                      "SUPERVISOR" 
                                                                            hh_a23 
                                                                      "ENUMERATOR" 
                                                                            hh_g09 
"Over the past one week (7 days), did any people that you did nonlist as househol" 
                                                                            hh_o0a 
                        "..Any children who are 15 years..do not live in this HH?" 
                                                                            hh_w01 
                 "Over the past two years, did any member of the household die..." 
                                                                            hhsize 
                                                                  "Household size" 
                                                                            hh_f01 
     "Do you own or are purchasing this property, is it provided to you by an emp" 
                                                                          hh_f01_2 
                    "Type of ownership doc.... on which this property is located?" 
                                                                          hh_f01_3 
                       "ENUMERATOR: WAS RESPONDENT ABLE TO PROVIDE DOCUMENTATION?" 
                                                                            hh_f05 
        "How many years ago was this dwelling built? How old is it?&lt;br&gt;&lt;br&gt; YEARS" 
                                                                            hh_f06 
          "WHAT GENERAL TYPE OF CONSTRUCTION MATERIALS ARE USED FOR THE DWELLING?" 
                                                                            hh_f07 
"OUTER WALLS OF THE MAIN DWELLING OF THE HH ARE PREDOMINANTLY MADE OF WHAT MATERI" 
                                                                        hh_f07_oth 
"SPECIFY MATERIAL THE OUTER WALLS OF THE MAIN DWELLING OF THE HH ARE PREDOMINANTL" 
                                                                            hh_f08 
           "The roof of the main dwelling is predominantly made of what material?" 
                                                                        hh_f08_oth 
    "SPECIFY WHAT MATERIAL THE ROOF OF THE MAIN DWELLING IS PREDOMINANTLY MADE OF" 
                                                                            hh_f09 
          "THE FLOOR OF THE MAIN DWELLING IS PREDOMINANTLY MADE OF WHAT MATERIAL?" 
                                                                        hh_f09_oth 
   "SPECIFY WHAT MATERIAL THE FLOOR OF THE MAIN DWELLING IS PREDOMINANTLY MADE OF" 
                                                                            hh_f10 
                   "How many separate rooms do the members of your household upy?" 
                                                                            hh_f11 
                                      "What is your main source of lighting fuel?" 
                                                                        hh_f11_oth 
                                       "Specify your main source of lighting fuel" 
                                                                            hh_f12 
                                       "What is your main source of cooking fuel?" 
                                                                        hh_f12_oth 
                                       "Specify your main source of cooking fuel." 
                                                                            hh_f19 
                              "Do you have  electricity working in your dwelling?" 
                                                                            hh_f21 
                                          "Do you get your electricity via ESCOM?" 
                                                                            hh_f25 
                                      "How much did you last pay for electricity?" 
                                                                           hh_f26a 
                    "To what length of time does this cost for electricity refer?" 
                                                                            hh_f31 
             "Is there a MTL telephone in working condition in the dwelling unit?" 
                                                                            hh_f34 
                  "How many working cell phones in total does your household own?" 
                                                                            hh_f36 
                                     "What is your main source of drinking water?" 
                                                                          hh_f36_1 
"What is the main souce of water used by members of your household for purposes s" 
                                                                       hh_f36_1oth 
                                             "Specify other main source of water." 
                                                                        hh_f36_oth 
                                     "Specify your main source of drinking water." 
                                                                            hh_f39 
                                             "Do you use the main water source..." 
                                                                          hh_f40_1 
"F40_1. Is there a place for household members to wash their hands in the dwellin" 
                                                                          hh_f40_2 
"F40_2. We would like to learn about where members of this household wash their h" 
                                                                          hh_f40_4 
               "F40_4. Is soap or detergent present at the place for handwashing?" 
                                                                            hh_f41 
                           "What kind of toilet facility does your household use?" 
                                                                        hh_f41_oth 
                        "Specify what kind of toilet facility your household uses" 
                                                                            hh_f43 
               "What kind of rubbish disposal facilities does your household use?" 
                                                                        hh_f43_oth 
            "Specify the kind of rubbish disposal facilities your household uses." 
                                                                            hh_f44 
             "Do any members of your HH sleep under a bed net... during the year?" 
                                                                            hh_f50 
           "Does any other member of your household... currently have an account?" 
                                                                            hh_f52 
     "...have you used an account.. of someone else in your HH or your community?" 
                                                                   Air_conditioner 
                                                          "Air_conditioner hh_l01" 
                                                                               Bed 
                                                                      "Bed hh_l01" 
                                                                   Beerbrewing_dru 
                                                          "Beerbrewing_dru hh_l01" 
                                                                           Bicycle 
                                                                  "Bicycle hh_l01" 
                                                                               Car 
                                                                      "Car hh_l01" 
                                                                             Chair 
                                                                    "Chair hh_l01" 
                                                                             Clock 
                                                                    "Clock hh_l01" 
                                                                   Coffee_table_fo 
                                                          "Coffee_table_fo hh_l01" 
                                                                   Computer_equipm 
                                                          "Computer_equipm hh_l01" 
                                                                   Cupboard_drawer 
                                                          "Cupboard_drawer hh_l01" 
                                                                              Desk 
                                                                     "Desk hh_l01" 
                                                                   Electric_Kettle 
                                                          "Electric_Kettle hh_l01" 
                                                                   Electric_or_gas 
                                                          "Electric_or_gas hh_l01" 
                                                                               Fan 
                                                                      "Fan hh_l01" 
                                                                         Generator 
                                                                "Generator hh_l01" 
                                                                   Iron_for_pressi 
                                                          "Iron_for_pressi hh_l01" 
                                                                   Keroseneparaffi 
                                                          "Keroseneparaffi hh_l01" 
                                                                   Lantern_paraffi 
                                                          "Lantern_paraffi hh_l01" 
                                                                             Lorry 
                                                                    "Lorry hh_l01" 
                                                                           Minibus 
                                                                  "Minibus hh_l01" 
                                                                   Mortarpestle_mt 
                                                          "Mortarpestle_mt hh_l01" 
                                                                   Motorcycle__Sco 
                                                          "Motorcycle__Sco hh_l01" 
                                                                    Radio_wireless 
                                                           "Radio_wireless hh_l01" 
                                                                   Radio_with_flas 
                                                          "Radio_with_flas hh_l01" 
                                                                      Refrigerator 
                                                             "Refrigerator hh_l01" 
                                                                    Sattelite_dish 
                                                           "Sattelite_dish hh_l01" 
                                                                    Sewing_machine 
                                                           "Sewing_machine hh_l01" 
                                                                       Solar_panel 
                                                              "Solar_panel hh_l01" 
                                                                             Table 
                                                                    "Table hh_l01" 
                                                                   Tape_or_CDDVD_p 
                                                          "Tape_or_CDDVD_p hh_l01" 
                                                                        Television 
                                                               "Television hh_l01" 
                                                                   Upholstered_cha 
                                                          "Upholstered_cha hh_l01" 
                                                                               VCR 
                                                                      "VCR hh_l01" 
                                                                   Washing_machine 
                                                          "Washing_machine hh_l01" 
                                                                         dist_road 
                                      "HH Distance in (KMs) to Nearest Major Road" 
                                                                       dist_agmrkt 
                             "HH Distance in (KMs) to Nearest Agricultural Market" 
                                                                      dist_auction 
                           "HH Distance in (KMs) to Nearest Tobacco Auction Floor" 
                                                                       dist_admarc 
                                   "HH Distance in (KMs) to Nearest ADMARC Outlet" 
                                                                       dist_border 
                            "HH Distance in (KMs) to Nearest Land Border Crossing" 
                                                                    dist_popcenter 
                  "HH Distance in (KMs) to Nearest Population Center with +20,000" 
                                                                         dist_boma 
               "HH Distance in (KMs) to the Boma of Current District of Residence" 
                                                                         ssa_aez09 
                                                           "Agro-ecological Zones" 
                                                                           twi_mwi 
                                                         "Potential Wetness Index" 
                                                                               sq1 
                                                           "Nutrient availability" 
                                                                               sq2 
                                                     "Nutrient retention capacity" 
                                                                               sq3 
                                                              "Rooting conditions" 
                                                                               sq4 
                                                    "Oxygen availability to roots" 
                                                                               sq5 
                                                                    "Excess salts" 
                                                                               sq6 
                                                                        "Toxicity" 
                                                                               sq7 
                                     "Workability (constraining field management)" 
                                                                        af_bio_1_x 
                                             "Annual Mean Temperature (degC * 10)" 
                                                                        af_bio_8_x 
                                 "Mean Temperature of Wettest Quarter (degC * 10)" 
                                                                       af_bio_12_x 
                                                       "Annual Precipitation (mm)" 
                                                                       af_bio_13_x 
                                             "Precipitation of Wettest Month (mm)" 
                                                                       af_bio_16_x 
                                                "Precipitation of Wettest Quarter" 
                                                                       afmnslp_pct 
                                                                 "Slope (percent)" 
                                                                           srtm_1k 
                                                                   "Elevation (m)" 
                                                                        popdensity 
                                                 "2018 Population density per km2" 
                                                                         cropshare 
                                             "2018 Percent cropland in local area" 
                                                                         h2018_tot 
                                   "12-month total rainfall (mm) ending June 2018" 
                                                                   h2018_wetQstart 
      "Start of wettest quarter in dekads 1-36, where first dekad of July 2017 =1" 
                                                                        h2018_wetQ 
           "Total rainfall in wettest quarter of 12-month period ending June 2018" 
                                                                         h2019_tot 
                                   "12-month total rainfall (mm) ending June 2019" 
                                                                   h2019_wetQstart 
      "Start of wettest quarter in dekads 1-36, where first dekad of July 2018 =1" 
                                                                        h2019_wetQ 
           "Total rainfall in wettest quarter of 12-month period ending June 2019" 
                                                                        anntot_avg 
                                   "Avg 12-month total rainfall(mm) for July-June" 
                                                                     wetQ_avgstart 
        "Avg start of wettest quarter in dekads 1-36, where first week of July =1" 
                                                                          wetQ_avg 
"Avg total rainfall in wettest quarter(mm) within 12-month periods from July-June" 
                                                                    h2018_ndvi_avg 
                     "Average NDVI value in primary growing season ending in 2018" 
                                                                    h2018_ndvi_max 
             "Maximum dekadal NDVI value in primary growing season ending in 2018" 
                                                                    h2019_ndvi_avg 
                     "Average NDVI value in primary growing season ending in 2019" 
                                                                    h2019_ndvi_max 
             "Maximum dekadal NDVI value in primary growing season ending in 2019" 
                                                                          ndvi_avg 
        "Long-term average NDVI value in primary growing season (highest quarter)" 
                                                                          ndvi_max 
"Long-term maximum dekadal NDVI value in primary growing season (highest quarter)" 
                                                                        ea_lat_mod 
                                                               "Latitude Modified" 
                                                                        ea_lon_mod 
                                                              "Longitude Modified" 
                                                                             urban 
                                                                     "Urban/rural" 
                                                                           adulteq 
                                                               "Adult equivalence" 
                                                                            expagg 
                                  "Total nominal annual consumption per household" 
                                                                           rexpagg 
                                     "Total real annual consumption per household" 
                                                                          expaggpc 
                                     "Total nominal annual per capita consumption" 
                                                                         rexpaggpc 
                                        "Total real annual per capita consumption" 
                                                                             pline 
                                               "Poverty line in April 2019 prices" 
                                                                              poor 
                           "Dummy for poor households below national poverty line" 
                                                                             upoor 
                "Dummy for ultra-poor households below national food poverty line" 
                                                                          com_ca01 
                                                                        "DISTRICT" 
                                                                          com_ca02 
                                                     "CA2. TA, STA, or URBAN WARD" 
                                                                          com_ca06 
                                                                 "Enumerator Code" 
                                                                     InterviewDate 
                                                            "Interview Start Date" 
                                                                          com_cc01 
"In the last five years, have there been more people who moved into this communit" 
                                                                          com_cc02 
                                       "What is the population of this community?" 
                                                                          com_cc03 
                                "How many households are found in this community?" 
                                                                        com_cc03_1 
                   "How many child-headed households are found in this community?" 
                                                                         com_cc04a 
           "What are the religions practiced by residents of this community?(1st)" 
                                                                         com_cc04c 
           "What are the religions practiced by residents of this community?(2nd)" 
                                                                         com_cc04d 
                            "Number of Households Practising religion listed in C" 
                                                                         com_cc04e 
           "What are the religions practiced by residents of this community?(3rd)" 
                                                                         com_cc04f 
                            "Number of Households Practising religion listed in E" 
                                                                         com_cc05a 
     "What are the languages spoken at home by residents of this community? (1st)" 
                                                                         com_cc05b 
                                   "Number of households that speak language in A" 
                                                                         com_cc05c 
     "What are the languages spoken at home by residents of this community? (2nd)" 
                                                                         com_cc05d 
                                   "Number of households that speak language in C" 
                                                                         com_cc05e 
     "What are the languages spoken at home by residents of this community? (3rd)" 
                                                                         com_cc05f 
                                   "Number of households that speak language in E" 
                                                                          com_cc06 
 "CC6. Do individuals in this community trace their descent through their father," 
                                                                         com_cc07a 
                      "First common type of marriage witnessed in this community?" 
                                                                         com_cc07b 
                       "Number of Households United through type of marriage in A" 
                                                                         com_cc07c 
                     "Second common type of marriage witnessed in this community?" 
                                                                         com_cc07d 
                       "Number of Households United through type of marriage in C" 
                                                                         com_cc07e 
                      "Third common type of marriage witnessed in this community?" 
                                                                         com_cc07f 
                       "Number of Households United through type of marriage in E" 
                                                                          com_cc08 
                    "How many polygamous house-holds are found in this community?" 
                                                                          com_cc09 
                          "What is the most common use of land in this community?" 
                                                                          com_cc10 
                                                 "Is the land of the community..." 
                                                                          com_cc11 
                            "What share of the land in your community is in bush?" 
                                                                          com_cc12 
            "What share of the agricultural land in your community is in estates?" 
                                                                          com_cc13 
"What share of the land in your community is in forest, and not used for agricult" 
                                                                          com_cc14 
       "What share of the registered voters from this community voted in the 2014" 
                                                                          com_cd01 
            "CD1. WHAT IS THE TYPE OF MAIN ACCESS ROAD SURFACE IN THIS COMMUNITY?" 
                                                                          com_cd03 
   "CD3. Do vehicles pass on the main road in this community throughout the year?" 
                                                                          com_cd04 
     "..past 12 months, how many months was the main road passable by a mini-bus?" 
                                                                          com_cd05 
        "..past 12 months, how many months was the main road passable by a lorry?" 
                                                                          com_cd06 
     "CD6. Do public buses, mini-buses, or regular matola stop in this community?" 
                                                                          com_cd09 
                                       "CD9. IS THE COMMUNITY IN A DISTRICT BOMA?" 
                                                                          com_cd11 
 "..total fare cost to go by regular matola from here or the nearest matola stage" 
                                                                          com_cd12 
                                 "CD12. IS THE COMMUNITY IN A MAJOR URBAN CENTRE?" 
                                                                          com_cd14 
"..total fare to go by regular matola from here or the nearest matola stage to th" 
                                                                          com_cd15 
                                "CD15. Is there a daily market in this community?" 
                                                                          com_cd17 
                        "CD17. Is there a larger weekly market in this community?" 
                                                                          com_cd19 
                     "CD19. Is there a permanent ADMARC market in this community?" 
                                                                          com_cd21 
                                 "CD21. Is there a post office in this community?" 
                                                                          com_cd23 
"CD23. Is there a place to make a telephone call in this community - e.g., a publ" 
                                                                          com_cd25 
            "CD25. How many churches (congregations) are there in this community?" 
                                                                          com_cd26 
                             "CD26. How many mosques are there in this community?" 
                                                                       com_cd_26_1 
"CD26_1. Is there a Community Based Child Care Center/ Nursery School in this com" 
                                                                          com_cd28 
    "CD28. At the nearest government primary school, how many teachers are there?" 
                                                                          com_cd29 
"..nearest gov't primary school, # pupils are there who are regularly in attendan" 
                                                                          com_cd30 
"..nearest gov't primary school, are all of the class-rooms built of brick with i" 
                                                                          com_cd31 
"# classes do not meet in classrooms built of brick with iron sheet roofs/other p" 
                                                                          com_cd32 
"Are there any school feeding programmes at government primary schools in this co" 
                                                                          com_cd33 
"What proportion of the primary school children in this community receive food un" 
                                                                          com_cd34 
"Is the food given already cooked and is eaten at school; or is it given as ratio" 
                                                                          com_cd35 
                     "CD35. Is the nearest government primary school electrified?" 
                                                                          com_cd37 
  "CD37. At the nearest government secondary school, how many teachers are there?" 
                                                                          com_cd38 
"At the nearest gov't sec. school, how many pupils are there who are regularly in" 
                                                                          com_cd39 
                   "CD39. Is the nearest government secondary school electrified?" 
                                                                          com_cd41 
     "At the nearest community day secondary school, how many teachers are there?" 
                                                                          com_cd42 
"At the nearest community day secondary school, how many pupils are there who are" 
                                                                          com_cd43 
                "CD43. Is the nearest community day secondary school electrified?" 
                                                                          com_cd44 
   "# primary schools run by religious organizations are there in this community?" 
                                                                          com_cd45 
 "# secondary schools run by religious organizations are there in this community?" 
                                                                          com_cd46 
             "CD46. How many private primary schools are there in this community?" 
                                                                          com_cd47 
           "CD47. How many private secondary schools are there in this community?" 
                                                                       com_cd_47_1 
                    "CD47_1. Is there an adult literacy center in this community?" 
                                                                          com_cd48 
"Is there a place in this community,to purchase common medicines such as pain kil" 
                                                                        com_cd49_1 
"CD49_1. Is there a nearby place where you can get information and services  abou" 
                                                                        com_cd49_2 
"CD49_2. Is there a nearby place where you can get information and services about" 
                                                                          com_cd50 
                   "CD50. Is there a health clinic (Chipatala) in this community?" 
                                                                          com_cd52 
"Is there a nurse, midwife or medical assistant permanently working at this healt" 
                                                                          com_cd53 
                                                  "CD53. Is this health facility…" 
                                                                          com_cd54 
                                      "CD54. Is this health facility electrified?" 
                                                                          com_cd55 
                       "CD55. Is there a village health clinic in this community?" 
                                                                          com_cd56 
"CD56. Does the village health clinic have a Health Surveillance Assistant (HSA)?" 
                                                                          com_cd57 
                                                               "CD57. Is the HSA…" 
                                                                          com_cd58 
                                      "CD58. Does the HSA live in this community?" 
                                                                          com_cd59 
                                             "CD59. Does the HSA have a drug box?" 
                                                                          com_cd63 
       "CD63. What is the cost of these treated bed nets (SINGLE BED SIZE)?\n\nMK" 
                                                                         com_cd65a 
 "CD65. What sort of support do they provide? Do they provide::Medical care &amp;amp;" 
                                                                         com_cd65b 
        "CD65. What sort of support do they provide? Do they provide::Cash grants" 
                                                                         com_cd65c 
"CD65. What sort of support do they provide? Do they provide::Food or other in-ki" 
                                                                         com_cd65d 
"CD65. What sort of support do they provide? Do they provide::Mental &amp;amp; spirit" 
                                                                         com_cd65e 
 "CD65. What sort of support do they provide? Do they provide::Support &amp;amp; care" 
                                                                         com_cd65f 
    "CD65. What sort of support do they provide? Do they provide::Other (specify)" 
                                                                      com_cd65_oth 
                            "CD65_oth. Please specify the other support provided." 
                                                                          com_cd66 
       "Is there a commercial bank in this community (NBM, Savings Bank, Stanbic?" 
                                                                          com_cd68 
"CD68. Is there a microfinance institution in this community (SACCO, FINCA, etc.)" 
                                                                          com_cd70 
 "Is a resident of this..the MP for the constituency of which this community is a" 
                                                                          com_cd71 
    "Did the MP for this area visit..past 3 months to speak and listen to people?" 
                                                                         com_ce01a 
   "..activities that are important sources of employment for individuals..?(1st)" 
                                                                     com_ce01a_oth 
                                            "Specify other sources of employement" 
                                                                     com_ce01b_oth 
                                            "Specify other sources of employement" 
                                                                     com_ce01c_oth 
                                            "Specify other sources of employement" 
                                                                          com_ce02 
 "Do people..leave temporarily during certain times of the year to look for work?" 
                                                                          com_ce03 
   "What share of house-holds..have members leaving temporarily to look for work?" 
                                                                          com_ce04 
                                                       "Where do most of them go?" 
                                                                         com_ce05a 
                                  "What type of work do they look for? (1st Type)" 
                                                                         com_ce05b 
                                  "What type of work do they look for? (2nd Type)" 
                                                                          com_ce06 
              "Do people come..during certain times of the year to look for work?" 
                                                                          com_ce07 
                                                "Where do most of them come from?" 
                                                                        com_ce08_1 
                        "What is the daily ganyu wage for an adult male labourer?" 
                                                                        com_ce08_2 
                      "What is the daily ganyu wage for an adult female labourer?" 
                                                                         com_ce08a 
                                  "What type of work do they look for? (1st Type)" 
                                                                         com_ce08b 
                                  "What type of work do they look for? (2nd Type)" 
                                                                     com_ce08a_oth 
                                      "Specify other type of work people look for" 
                                                                     com_ce08b_oth 
                                      "Specify other type of work people look for" 
                                                                          com_ce09 
      "Is there a MASAF programme..which hires residents who are in need of work?" 
                                                                          com_ce10 
       "What is the wage rate on the MASAF project for an adult male labourer? MK" 
                                                                          com_ce12 
         "What share of adult males in this community work for the MASAF project?" 
                                                                          com_ce13 
        "What is the wage rate on the MASAF project for an adult female labourer?" 
                                                                          com_ce15 
       "What share of adult females in this community work for the MASAF project?" 
                                                                          com_cf01 
               "Do any households farm crops or keep livestock in this community?" 
                                                                          com_cf02 
      "..in most years, in which half of which month..normally plant their maize?" 
                                                                          com_cf03 
    "..in most years, in which half of which month..normally harvest their maize?" 
                                                                        com_cf03_1 
              "In most years, what proportion of cropland is burned post-harvest?" 
                                                                        com_cf03_2 
                   "Which system best describes the use of cropland post-harvest?" 
                                                                          com_cf07 
    "..Assist. Agricultural Extension Development Officer live in this community?" 
                                                                          com_cf09 
                                "Is there an irrigation scheme in this community?" 
                                                                          com_cf10 
     "How many farmers from the community in total farm in the irrigation scheme?" 
                                                                          com_cf11 
                "How many sellers of fertilizer are there in the community?NUMBER" 
                                                                          com_cf12 
         "How many sellers of hybrid maize seed are there in the community?NUMBER" 
                                                                          com_cf13 
       "..local warehouse that the community could use to store crops prior sale?" 
                                                                         com_cf17a 
 "..community residents expected to pay the vil..headman when they purchase land?" 
                                                                         com_cf17b 
      "..community residents expected to pay the vi..headman when they sell land?" 
                                                                         com_cf17c 
"..community residents..to pay vil..headman when granted access to communal land?" 
                                                                          com_cf22 
               "About how many households in the community practice zero tillage?" 
                                                                          com_cf23 
       "About how many households in the community practice sow seeds in planting" 
                                                                          com_cf24 
  "About how many households in the community practice have earth or stone bunds?" 
                                                                          com_cf25 
                   "About how many households in the community practice terraces?" 
                                                                          com_cf26 
      "About how many households in the community practice practice agro-forestry" 
                                                                          com_cf27 
   "About how many households in the community practice plant legume cover crops?" 
                                                                          com_cf28 
      "CF28. Are there any agriculture-based projects operating in the community?" </code></pre>
</div>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>os.chdir(<span class="st">'/Users/lucas/Documents/UNU-CDO/courses/ml4p/ml4p-website-v2'</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load malawi.dta variable labels</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>iterator <span class="op">=</span> pd.read_stata(<span class="st">'data/malawi.dta'</span>, iterator<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>variable_labels <span class="op">=</span> iterator.variable_labels()</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co"># List all variables and their corresponding labels. For more details, check the questionnaire. Variable names correspond to the question numbers (hh=household module; com=community module)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(variable_labels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{'case_id': 'Unique Household Identifier', 'HHID': 'Survey Solutions Unique HH Identifier', 'ea_id': 'Unique Enumeration Area Code', 'region': 'IHS5 2019 Region location', 'district': 'IHS5 2019 District Location', 'reside': 'IHS5 2019 Rural Residence', 'interviewDate': 'Interview Date', 'hh_wgt': 'Household Sampling Weight', 'hh_a22': 'SUPERVISOR', 'hh_a23': 'ENUMERATOR', 'hh_g09': 'Over the past one week (7 days), did any people that you did nonlist as househol', 'hh_o0a': '..Any children who are 15 years..do not live in this HH?', 'hh_w01': 'Over the past two years, did any member of the household die... ', 'hhsize': 'Household size', 'hh_f01': 'Do you own or are purchasing this property, is it provided to you by an emp', 'hh_f01_2': 'Type of ownership doc.... on which this property is located?', 'hh_f01_3': 'ENUMERATOR: WAS RESPONDENT ABLE TO PROVIDE DOCUMENTATION?', 'hh_f05': 'How many years ago was this dwelling built? How old is it?&lt;br&gt;&lt;br&gt; YEARS', 'hh_f06': 'WHAT GENERAL TYPE OF CONSTRUCTION MATERIALS ARE USED FOR THE DWELLING?', 'hh_f07': 'OUTER WALLS OF THE MAIN DWELLING OF THE HH ARE PREDOMINANTLY MADE OF WHAT MATERI', 'hh_f07_oth': 'SPECIFY MATERIAL THE OUTER WALLS OF THE MAIN DWELLING OF THE HH ARE PREDOMINANTL', 'hh_f08': 'The roof of the main dwelling is predominantly made of what material?', 'hh_f08_oth': 'SPECIFY WHAT MATERIAL THE ROOF OF THE MAIN DWELLING IS PREDOMINANTLY MADE OF', 'hh_f09': 'THE FLOOR OF THE MAIN DWELLING IS PREDOMINANTLY MADE OF WHAT MATERIAL?', 'hh_f09_oth': 'SPECIFY WHAT MATERIAL THE FLOOR OF THE MAIN DWELLING IS PREDOMINANTLY MADE OF', 'hh_f10': 'How many separate rooms do the members of your household upy?', 'hh_f11': 'What is your main source of lighting fuel?', 'hh_f11_oth': 'Specify your main source of lighting fuel', 'hh_f12': 'What is your main source of cooking fuel?', 'hh_f12_oth': 'Specify your main source of cooking fuel.', 'hh_f19': 'Do you have  electricity working in your dwelling?', 'hh_f21': 'Do you get your electricity via ESCOM?', 'hh_f25': 'How much did you last pay for electricity?', 'hh_f26a': 'To what length of time does this cost for electricity refer?', 'hh_f31': 'Is there a MTL telephone in working condition in the dwelling unit?', 'hh_f34': 'How many working cell phones in total does your household own?', 'hh_f36': 'What is your main source of drinking water?', 'hh_f36_1': 'What is the main souce of water used by members of your household for purposes s', 'hh_f36_1oth': 'Specify other main source of water.', 'hh_f36_oth': 'Specify your main source of drinking water.', 'hh_f39': 'Do you use the main water source...', 'hh_f40_1': 'F40_1. Is there a place for household members to wash their hands in the dwellin', 'hh_f40_2': 'F40_2. We would like to learn about where members of this household wash their h', 'hh_f40_4': 'F40_4. Is soap or detergent present at the place for handwashing?', 'hh_f41': 'What kind of toilet facility does your household use?', 'hh_f41_oth': 'Specify what kind of toilet facility your household uses', 'hh_f43': 'What kind of rubbish disposal facilities does your household use?', 'hh_f43_oth': 'Specify the kind of rubbish disposal facilities your household uses.', 'hh_f44': 'Do any members of your HH sleep under a bed net... during the year?', 'hh_f50': 'Does any other member of your household... currently have an account?', 'hh_f52': '...have you used an account.. of someone else in your HH or your community?', 'Air_conditioner': 'Air_conditioner hh_l01', 'Bed': 'Bed hh_l01', 'Beerbrewing_dru': 'Beerbrewing_dru hh_l01', 'Bicycle': 'Bicycle hh_l01', 'Car': 'Car hh_l01', 'Chair': 'Chair hh_l01', 'Clock': 'Clock hh_l01', 'Coffee_table_fo': 'Coffee_table_fo hh_l01', 'Computer_equipm': 'Computer_equipm hh_l01', 'Cupboard_drawer': 'Cupboard_drawer hh_l01', 'Desk': 'Desk hh_l01', 'Electric_Kettle': 'Electric_Kettle hh_l01', 'Electric_or_gas': 'Electric_or_gas hh_l01', 'Fan': 'Fan hh_l01', 'Generator': 'Generator hh_l01', 'Iron_for_pressi': 'Iron_for_pressi hh_l01', 'Keroseneparaffi': 'Keroseneparaffi hh_l01', 'Lantern_paraffi': 'Lantern_paraffi hh_l01', 'Lorry': 'Lorry hh_l01', 'Minibus': 'Minibus hh_l01', 'Mortarpestle_mt': 'Mortarpestle_mt hh_l01', 'Motorcycle__Sco': 'Motorcycle__Sco hh_l01', 'Radio_wireless': 'Radio_wireless hh_l01', 'Radio_with_flas': 'Radio_with_flas hh_l01', 'Refrigerator': 'Refrigerator hh_l01', 'Sattelite_dish': 'Sattelite_dish hh_l01', 'Sewing_machine': 'Sewing_machine hh_l01', 'Solar_panel': 'Solar_panel hh_l01', 'Table': 'Table hh_l01', 'Tape_or_CDDVD_p': 'Tape_or_CDDVD_p hh_l01', 'Television': 'Television hh_l01', 'Upholstered_cha': 'Upholstered_cha hh_l01', 'VCR': 'VCR hh_l01', 'Washing_machine': 'Washing_machine hh_l01', 'dist_road': 'HH Distance in (KMs) to Nearest Major Road', 'dist_agmrkt': 'HH Distance in (KMs) to Nearest Agricultural Market', 'dist_auction': 'HH Distance in (KMs) to Nearest Tobacco Auction Floor', 'dist_admarc': 'HH Distance in (KMs) to Nearest ADMARC Outlet', 'dist_border': 'HH Distance in (KMs) to Nearest Land Border Crossing', 'dist_popcenter': 'HH Distance in (KMs) to Nearest Population Center with +20,000', 'dist_boma': 'HH Distance in (KMs) to the Boma of Current District of Residence', 'ssa_aez09': 'Agro-ecological Zones ', 'twi_mwi': 'Potential Wetness Index', 'sq1': 'Nutrient availability', 'sq2': 'Nutrient retention capacity', 'sq3': 'Rooting conditions', 'sq4': 'Oxygen availability to roots', 'sq5': 'Excess salts', 'sq6': 'Toxicity', 'sq7': 'Workability (constraining field management)', 'af_bio_1_x': 'Annual Mean Temperature (degC * 10)', 'af_bio_8_x': 'Mean Temperature of Wettest Quarter (degC * 10)', 'af_bio_12_x': 'Annual Precipitation (mm)', 'af_bio_13_x': 'Precipitation of Wettest Month (mm)', 'af_bio_16_x': 'Precipitation of Wettest Quarter', 'afmnslp_pct': 'Slope (percent)', 'srtm_1k': 'Elevation (m)', 'popdensity': '2018 Population density per km2', 'cropshare': '2018 Percent cropland in local area', 'h2018_tot': '12-month total rainfall (mm) ending June 2018', 'h2018_wetQstart': 'Start of wettest quarter in dekads 1-36, where first dekad of July 2017 =1', 'h2018_wetQ': 'Total rainfall in wettest quarter of 12-month period ending June 2018', 'h2019_tot': '12-month total rainfall (mm) ending June 2019', 'h2019_wetQstart': 'Start of wettest quarter in dekads 1-36, where first dekad of July 2018 =1', 'h2019_wetQ': 'Total rainfall in wettest quarter of 12-month period ending June 2019', 'anntot_avg': 'Avg 12-month total rainfall(mm) for July-June', 'wetQ_avgstart': 'Avg start of wettest quarter in dekads 1-36, where first week of July =1', 'wetQ_avg': 'Avg total rainfall in wettest quarter(mm) within 12-month periods from July-June', 'h2018_ndvi_avg': 'Average NDVI value in primary growing season ending in 2018', 'h2018_ndvi_max': 'Maximum dekadal NDVI value in primary growing season ending in 2018', 'h2019_ndvi_avg': 'Average NDVI value in primary growing season ending in 2019', 'h2019_ndvi_max': 'Maximum dekadal NDVI value in primary growing season ending in 2019', 'ndvi_avg': 'Long-term average NDVI value in primary growing season (highest quarter)', 'ndvi_max': 'Long-term maximum dekadal NDVI value in primary growing season (highest quarter)', 'ea_lat_mod': 'Latitude Modified', 'ea_lon_mod': 'Longitude Modified', 'urban': 'Urban/rural', 'adulteq': 'Adult equivalence', 'expagg': 'Total nominal annual consumption per household', 'rexpagg': 'Total real annual consumption per household', 'expaggpc': 'Total nominal annual per capita consumption', 'rexpaggpc': 'Total real annual per capita consumption', 'pline': 'Poverty line in April 2019 prices', 'poor': 'Dummy for poor households below national poverty line', 'upoor': 'Dummy for ultra-poor households below national food poverty line', 'com_ca01': 'DISTRICT', 'com_ca02': 'CA2. TA, STA, or URBAN WARD', 'com_ca06': 'Enumerator Code', 'InterviewDate': 'Interview Start Date', 'com_cc01': 'In the last five years, have there been more people who moved into this communit', 'com_cc02': 'What is the population of this community?', 'com_cc03': 'How many households are found in this community?', 'com_cc03_1': 'How many child-headed households are found in this community?', 'com_cc04a': 'What are the religions practiced by residents of this community?(1st)', 'com_cc04c': 'What are the religions practiced by residents of this community?(2nd)', 'com_cc04d': 'Number of Households Practising religion listed in C', 'com_cc04e': 'What are the religions practiced by residents of this community?(3rd)', 'com_cc04f': 'Number of Households Practising religion listed in E', 'com_cc05a': 'What are the languages spoken at home by residents of this community? (1st)', 'com_cc05b': 'Number of households that speak language in A', 'com_cc05c': 'What are the languages spoken at home by residents of this community? (2nd)', 'com_cc05d': 'Number of households that speak language in C', 'com_cc05e': 'What are the languages spoken at home by residents of this community? (3rd)', 'com_cc05f': 'Number of households that speak language in E', 'com_cc06': 'CC6. Do individuals in this community trace their descent through their father, ', 'com_cc07a': 'First common type of marriage witnessed in this community?', 'com_cc07b': 'Number of Households United through type of marriage in A', 'com_cc07c': 'Second common type of marriage witnessed in this community?', 'com_cc07d': 'Number of Households United through type of marriage in C', 'com_cc07e': 'Third common type of marriage witnessed in this community?', 'com_cc07f': 'Number of Households United through type of marriage in E', 'com_cc08': 'How many polygamous house-holds are found in this community?', 'com_cc09': 'What is the most common use of land in this community?', 'com_cc10': 'Is the land of the community...', 'com_cc11': 'What share of the land in your community is in bush?', 'com_cc12': 'What share of the agricultural land in your community is in estates?', 'com_cc13': 'What share of the land in your community is in forest, and not used for agricult', 'com_cc14': 'What share of the registered voters from this community voted in the 2014 ', 'com_cd01': 'CD1. WHAT IS THE TYPE OF MAIN ACCESS ROAD SURFACE IN THIS COMMUNITY?', 'com_cd03': 'CD3. Do vehicles pass on the main road in this community throughout the year?', 'com_cd04': '..past 12 months, how many months was the main road passable by a mini-bus?', 'com_cd05': '..past 12 months, how many months was the main road passable by a lorry?', 'com_cd06': 'CD6. Do public buses, mini-buses, or regular matola stop in this community?', 'com_cd09': 'CD9. IS THE COMMUNITY IN A DISTRICT BOMA?', 'com_cd11': '..total fare cost to go by regular matola from here or the nearest matola stage ', 'com_cd12': 'CD12. IS THE COMMUNITY IN A MAJOR URBAN CENTRE?', 'com_cd14': '..total fare to go by regular matola from here or the nearest matola stage to th', 'com_cd15': 'CD15. Is there a daily market in this community?', 'com_cd17': 'CD17. Is there a larger weekly market in this community?', 'com_cd19': 'CD19. Is there a permanent ADMARC market in this community?', 'com_cd21': 'CD21. Is there a post office in this community?', 'com_cd23': 'CD23. Is there a place to make a telephone call in this community - e.g., a publ', 'com_cd25': 'CD25. How many churches (congregations) are there in this community?', 'com_cd26': 'CD26. How many mosques are there in this community?', 'com_cd_26_1': 'CD26_1. Is there a Community Based Child Care Center/ Nursery School in this com', 'com_cd28': 'CD28. At the nearest government primary school, how many teachers are there?', 'com_cd29': "..nearest gov't primary school, # pupils are there who are regularly in attendan", 'com_cd30': "..nearest gov't primary school, are all of the class-rooms built of brick with i", 'com_cd31': '# classes do not meet in classrooms built of brick with iron sheet roofs/other p', 'com_cd32': 'Are there any school feeding programmes at government primary schools in this co', 'com_cd33': 'What proportion of the primary school children in this community receive food un', 'com_cd34': 'Is the food given already cooked and is eaten at school; or is it given as ratio', 'com_cd35': 'CD35. Is the nearest government primary school electrified?', 'com_cd37': 'CD37. At the nearest government secondary school, how many teachers are there?', 'com_cd38': "At the nearest gov't sec. school, how many pupils are there who are regularly in", 'com_cd39': 'CD39. Is the nearest government secondary school electrified?', 'com_cd41': 'At the nearest community day secondary school, how many teachers are there?', 'com_cd42': 'At the nearest community day secondary school, how many pupils are there who are', 'com_cd43': 'CD43. Is the nearest community day secondary school electrified?', 'com_cd44': '# primary schools run by religious organizations are there in this community?', 'com_cd45': '# secondary schools run by religious organizations are there in this community?', 'com_cd46': 'CD46. How many private primary schools are there in this community?', 'com_cd47': 'CD47. How many private secondary schools are there in this community?', 'com_cd_47_1': 'CD47_1. Is there an adult literacy center in this community?', 'com_cd48': 'Is there a place in this community,to purchase common medicines such as pain kil', 'com_cd49_1': 'CD49_1. Is there a nearby place where you can get information and services  abou', 'com_cd49_2': 'CD49_2. Is there a nearby place where you can get information and services about', 'com_cd50': 'CD50. Is there a health clinic (Chipatala) in this community?', 'com_cd52': 'Is there a nurse, midwife or medical assistant permanently working at this healt', 'com_cd53': 'CD53. Is this health facility…', 'com_cd54': 'CD54. Is this health facility electrified?', 'com_cd55': 'CD55. Is there a village health clinic in this community?', 'com_cd56': 'CD56. Does the village health clinic have a Health Surveillance Assistant (HSA)?', 'com_cd57': 'CD57. Is the HSA…', 'com_cd58': 'CD58. Does the HSA live in this community?', 'com_cd59': 'CD59. Does the HSA have a drug box?', 'com_cd63': 'CD63. What is the cost of these treated bed nets (SINGLE BED SIZE)?\n\nMK', 'com_cd65a': 'CD65. What sort of support do they provide? Do they provide::Medical care &amp;amp; ', 'com_cd65b': 'CD65. What sort of support do they provide? Do they provide::Cash grants', 'com_cd65c': 'CD65. What sort of support do they provide? Do they provide::Food or other in-ki', 'com_cd65d': 'CD65. What sort of support do they provide? Do they provide::Mental &amp;amp; spirit', 'com_cd65e': 'CD65. What sort of support do they provide? Do they provide::Support &amp;amp; care ', 'com_cd65f': 'CD65. What sort of support do they provide? Do they provide::Other (specify)', 'com_cd65_oth': 'CD65_oth. Please specify the other support provided.', 'com_cd66': 'Is there a commercial bank in this community (NBM, Savings Bank, Stanbic?', 'com_cd68': 'CD68. Is there a microfinance institution in this community (SACCO, FINCA, etc.)', 'com_cd70': 'Is a resident of this..the MP for the constituency of which this community is a ', 'com_cd71': 'Did the MP for this area visit..past 3 months to speak and listen to people?', 'com_ce01a': '..activities that are important sources of employment for individuals..?(1st)', 'com_ce01a_oth': 'Specify other sources of employement', 'com_ce01b_oth': 'Specify other sources of employement', 'com_ce01c_oth': 'Specify other sources of employement', 'com_ce02': 'Do people..leave temporarily during certain times of the year to look for work?', 'com_ce03': 'What share of house-holds..have members leaving temporarily to look for work?', 'com_ce04': 'Where do most of them go?', 'com_ce05a': 'What type of work do they look for? (1st Type)', 'com_ce05b': 'What type of work do they look for? (2nd Type)', 'com_ce06': 'Do people come..during certain times of the year to look for work?', 'com_ce07': 'Where do most of them come from?', 'com_ce08_1': 'What is the daily ganyu wage for an adult male labourer?', 'com_ce08_2': 'What is the daily ganyu wage for an adult female labourer?', 'com_ce08a': 'What type of work do they look for? (1st Type)', 'com_ce08b': 'What type of work do they look for? (2nd Type)', 'com_ce08a_oth': 'Specify other type of work people look for', 'com_ce08b_oth': 'Specify other type of work people look for', 'com_ce09': 'Is there a MASAF programme..which hires residents who are in need of work?', 'com_ce10': 'What is the wage rate on the MASAF project for an adult male labourer? MK', 'com_ce12': 'What share of adult males in this community work for the MASAF project?', 'com_ce13': 'What is the wage rate on the MASAF project for an adult female labourer?', 'com_ce15': 'What share of adult females in this community work for the MASAF project?', 'com_cf01': 'Do any households farm crops or keep livestock in this community?', 'com_cf02': '..in most years, in which half of which month..normally plant their maize?', 'com_cf03': '..in most years, in which half of which month..normally harvest their maize?', 'com_cf03_1': 'In most years, what proportion of cropland is burned post-harvest?', 'com_cf03_2': 'Which system best describes the use of cropland post-harvest?', 'com_cf07': '..Assist. Agricultural Extension Development Officer live in this community?', 'com_cf09': 'Is there an irrigation scheme in this community?', 'com_cf10': 'How many farmers from the community in total farm in the irrigation scheme?', 'com_cf11': 'How many sellers of fertilizer are there in the community?NUMBER', 'com_cf12': 'How many sellers of hybrid maize seed are there in the community?NUMBER', 'com_cf13': '..local warehouse that the community could use to store crops prior sale?', 'com_cf17a': '..community residents expected to pay the vil..headman when they purchase land?', 'com_cf17b': '..community residents expected to pay the vi..headman when they sell land?', 'com_cf17c': '..community residents..to pay vil..headman when granted access to communal land?', 'com_cf22': 'About how many households in the community practice zero tillage?', 'com_cf23': 'About how many households in the community practice sow seeds in planting ', 'com_cf24': 'About how many households in the community practice have earth or stone bunds?', 'com_cf25': 'About how many households in the community practice terraces?', 'com_cf26': 'About how many households in the community practice practice agro-forestry', 'com_cf27': 'About how many households in the community practice plant legume cover crops?', 'com_cf28': 'CF28. Are there any agriculture-based projects operating in the community?'}</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the Stata(.dta) file an import is a pandas dataframe</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_stata(<span class="st">'data/malawi.dta'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
<section id="get-to-know-your-data-pre-processing-and-data-familiarization." class="level3">
<h3 class="anchored" data-anchor-id="get-to-know-your-data-pre-processing-and-data-familiarization.">2. Get to know your data: pre-processing and data familiarization.</h3>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's have a look at our data frame 'malawi'</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(malawi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 272
  case_id      HHID  ea_id region  district  reside  interviewDate hh_wgt hh_a22
  &lt;chr&gt;        &lt;chr&gt; &lt;chr&gt; &lt;dbl+l&gt; &lt;dbl+lbl&gt; &lt;dbl+l&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;
1 101011000014 7d78… 1010… 1 [Nor… 101 [Chi… 2 [RUR… 2019-08-29      93.7     14
2 101011000023 7144… 1010… 1 [Nor… 101 [Chi… 2 [RUR… 2019-08-29      93.7     14
3 101011000040 9936… 1010… 1 [Nor… 101 [Chi… 2 [RUR… 2019-08-28      93.7     14
4 101011000071 cc8f… 1010… 1 [Nor… 101 [Chi… 2 [RUR… 2019-08-29      93.7     14
5 101011000095 e50c… 1010… 1 [Nor… 101 [Chi… 2 [RUR… 2019-08-28      93.7     14
6 101011000115 4c60… 1010… 1 [Nor… 101 [Chi… 2 [RUR… 2019-08-29      93.7     14
# ℹ 263 more variables: hh_a23 &lt;dbl&gt;, hh_g09 &lt;dbl+lbl&gt;, hh_o0a &lt;dbl+lbl&gt;,
#   hh_w01 &lt;dbl+lbl&gt;, hhsize &lt;dbl&gt;, hh_f01 &lt;dbl+lbl&gt;, hh_f01_2 &lt;dbl+lbl&gt;,
#   hh_f01_3 &lt;dbl+lbl&gt;, hh_f05 &lt;dbl&gt;, hh_f06 &lt;dbl+lbl&gt;, hh_f07 &lt;dbl+lbl&gt;,
#   hh_f07_oth &lt;chr&gt;, hh_f08 &lt;dbl+lbl&gt;, hh_f08_oth &lt;chr&gt;, hh_f09 &lt;dbl+lbl&gt;,
#   hh_f09_oth &lt;chr&gt;, hh_f10 &lt;dbl&gt;, hh_f11 &lt;dbl+lbl&gt;, hh_f11_oth &lt;chr&gt;,
#   hh_f12 &lt;dbl+lbl&gt;, hh_f12_oth &lt;chr&gt;, hh_f19 &lt;dbl+lbl&gt;, hh_f21 &lt;dbl+lbl&gt;,
#   hh_f25 &lt;dbl&gt;, hh_f26a &lt;dbl&gt;, hh_f31 &lt;dbl+lbl&gt;, hh_f34 &lt;dbl&gt;, …</code></pre>
</div>
</div>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let`s have a look at our data frame 'df'. df.head() returns the first 5 rows of our data set df.</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df.head()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        case_id                              HHID  ... com_cf27 com_cf28
0  101011000014  7d78f2c5da59436d9bde9b09ea8a8aaf  ...    280.0       NO
1  101011000023  7144cc6d29b3485d9e6d6188b255c756  ...    280.0       NO
2  101011000040  9936d103bf974a93afbc63d477b8b3f2  ...    280.0       NO
3  101011000071  cc8f211413cd493e83e01a96aba95bbb  ...    280.0       NO
4  101011000095  e50cfa8d11b44d56891e0fad015b07c7  ...    280.0       NO

[5 rows x 272 columns]</code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>Variable Selection</strong></p>
<p>Finding the best set of predictor variables is a complicated task. In some applications, the number of variables (predictors/columns) can be huge, even exceeding the number of observations (rows). This prompts us to define strategies to select our predictors. Beyond technical considerations, we first need to conceptually define which variables can or cannot be included in the model. This includes programmatic, conceptual, or ethical considerations.</p>
<p>In our case, we have 272 variables (columns). The ideal predictor measures a household characteristic that can be easily observed by social assistance program officers when our model is deployed in practice. Why does it need to be easily observable? If people apply for social assistance programs, they may provide false information in order to obtain benefits. Even if the targeting criteria are not published, households form beliefs about admission criteria, and some may try to appear as poor as possible. For empirical evidence from Indonesia, have a look at this <a href="https://www.sciencedirect.com/science/article/pii/S2666551420300012">paper</a>. House characteristics would be an example of a good predictor, e.g.&nbsp;Is there a bathroom in the house?</p>
<p>For now, we select a few variables from the data to illustrate the code. Later, your task will be to improve the model by improving variable selection and thus the model. When selecting variables, don’t forget to include the target variable (the variable we want to predict). For this exercise, we will use the variables <code>rexpaggpc</code> (consumption per capita) and <code>poor</code> (consumption poverty) as target variables.</p>
<p>To select variables, you can use the questionnaire or the list of variable lables (‘variable_labels’).</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's pick a few variables that are traditionally used for Proxy Means Tests</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'poor'</span>,<span class="st">'rexpaggpc'</span>, <span class="st">'district'</span>, <span class="st">'urban'</span>, <span class="st">'hh_f06'</span>, <span class="st">'hh_f08'</span>, <span class="st">'hh_f09'</span>, <span class="st">'hh_f10'</span>, <span class="st">'hh_f19'</span>, <span class="st">'hh_f41'</span>, <span class="st">'Bed'</span>, <span class="st">'Desk'</span>, <span class="st">'Fan'</span>, <span class="st">'Refrigerator'</span>, <span class="st">'Table'</span>, <span class="st">'dist_road'</span>, <span class="st">'adulteq'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only the subset of columns of df that are in the object vars (contains the columns we selected)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>malawi <span class="ot">&lt;-</span> malawi[vars]</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show variable labels for the selected variables</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> vars) {</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(var, <span class="st">":"</span>, variable_labels[var], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>poor : Dummy for poor households below national poverty line 
rexpaggpc : Total real annual per capita consumption 
district : IHS5 2019 District Location 
urban : Urban/rural 
hh_f06 : WHAT GENERAL TYPE OF CONSTRUCTION MATERIALS ARE USED FOR THE DWELLING? 
hh_f08 : The roof of the main dwelling is predominantly made of what material? 
hh_f09 : THE FLOOR OF THE MAIN DWELLING IS PREDOMINANTLY MADE OF WHAT MATERIAL? 
hh_f10 : How many separate rooms do the members of your household upy? 
hh_f19 : Do you have  electricity working in your dwelling? 
hh_f41 : What kind of toilet facility does your household use? 
Bed : Bed hh_l01 
Desk : Desk hh_l01 
Fan : Fan hh_l01 
Refrigerator : Refrigerator hh_l01 
Table : Table hh_l01 
dist_road : HH Distance in (KMs) to Nearest Major Road 
adulteq : Adult equivalence </code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's pick a few variables that are traditionally used for Proxy Means Tests</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">vars</span> <span class="op">=</span> [<span class="st">'poor'</span>,<span class="st">'rexpaggpc'</span>, <span class="st">'district'</span>, <span class="st">'urban'</span> , <span class="st">'hh_f06'</span>, <span class="st">'hh_f08'</span>, <span class="st">'hh_f09'</span>, <span class="st">'hh_f10'</span>, <span class="st">'hh_f19'</span>,  <span class="st">'hh_f41'</span>, <span class="st">'Bed'</span>, <span class="st">'Desk'</span>, <span class="st">'Fan'</span>, <span class="st">'Refrigerator'</span>, <span class="st">'Table'</span>, <span class="st">'dist_road'</span>, <span class="st">'adulteq'</span>]</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only the subset of columns of df that are in the object vars (contains the columns we selected)</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df[<span class="bu">vars</span>]</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Show variable_labels for the selected variables vars</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> var <span class="kw">in</span> <span class="bu">vars</span>:</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>var<span class="sc">}</span><span class="ss"> : </span><span class="sc">{</span>variable_labels[var]<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>poor : Dummy for poor households below national poverty line
rexpaggpc : Total real annual per capita consumption
district : IHS5 2019 District Location
urban : Urban/rural
hh_f06 : WHAT GENERAL TYPE OF CONSTRUCTION MATERIALS ARE USED FOR THE DWELLING?
hh_f08 : The roof of the main dwelling is predominantly made of what material?
hh_f09 : THE FLOOR OF THE MAIN DWELLING IS PREDOMINANTLY MADE OF WHAT MATERIAL?
hh_f10 : How many separate rooms do the members of your household upy?
hh_f19 : Do you have  electricity working in your dwelling?
hh_f41 : What kind of toilet facility does your household use?
Bed : Bed hh_l01
Desk : Desk hh_l01
Fan : Fan hh_l01
Refrigerator : Refrigerator hh_l01
Table : Table hh_l01
dist_road : HH Distance in (KMs) to Nearest Major Road
adulteq : Adult equivalence</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Now that we have selected our predictors and the target variable(s), we should summarize and describe our data to get a feeling for the variable types, the distribution of variable values, missing values, and variable correlations.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics provides a first glance of the data</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">skim</span>(malawi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td style="text-align: left;">Name</td>
<td style="text-align: left;">malawi</td>
</tr>
<tr class="even">
<td style="text-align: left;">Number of rows</td>
<td style="text-align: left;">11434</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Number of columns</td>
<td style="text-align: left;">17</td>
</tr>
<tr class="even">
<td style="text-align: left;">_______________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Column type frequency:</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">numeric</td>
<td style="text-align: left;">17</td>
</tr>
<tr class="odd">
<td style="text-align: left;">________________________</td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">Group variables</td>
<td style="text-align: left;">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table class="caption-top table table-sm table-striped small">
<colgroup>
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 12%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 5%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">skim_variable</th>
<th style="text-align: right;">n_missing</th>
<th style="text-align: right;">complete_rate</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">p0</th>
<th style="text-align: right;">p25</th>
<th style="text-align: right;">p50</th>
<th style="text-align: right;">p75</th>
<th style="text-align: right;">p100</th>
<th style="text-align: left;">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">poor</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.49</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.0</td>
<td style="text-align: left;">▇▁▁▁▅</td>
</tr>
<tr class="even">
<td style="text-align: left;">rexpaggpc</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">282413.43</td>
<td style="text-align: right;">366770.15</td>
<td style="text-align: right;">22306.64</td>
<td style="text-align: right;">129409.27</td>
<td style="text-align: right;">197877.70</td>
<td style="text-align: right;">317476.45</td>
<td style="text-align: right;">18560576.0</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">district</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">233.72</td>
<td style="text-align: right;">77.83</td>
<td style="text-align: right;">101.00</td>
<td style="text-align: right;">202.00</td>
<td style="text-align: right;">210.00</td>
<td style="text-align: right;">307.00</td>
<td style="text-align: right;">315.0</td>
<td style="text-align: left;">▃▁▆▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">urban</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.82</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">▂▁▁▁▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hh_f06</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.93</td>
<td style="text-align: right;">0.80</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">3.0</td>
<td style="text-align: left;">▇▁▇▁▆</td>
</tr>
<tr class="even">
<td style="text-align: left;">hh_f08</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.56</td>
<td style="text-align: right;">0.52</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: left;">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hh_f09</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.30</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">6.0</td>
<td style="text-align: left;">▇▃▁▁▁</td>
</tr>
<tr class="even">
<td style="text-align: left;">hh_f10</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.79</td>
<td style="text-align: right;">1.15</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">3.00</td>
<td style="text-align: right;">4.00</td>
<td style="text-align: right;">10.0</td>
<td style="text-align: left;">▇▇▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hh_f19</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.87</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">▁▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">hh_f41</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">7.88</td>
<td style="text-align: right;">1.72</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">7.00</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">8.00</td>
<td style="text-align: right;">13.0</td>
<td style="text-align: left;">▁▁▇▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Bed</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.65</td>
<td style="text-align: right;">0.48</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">▅▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">Desk</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">▁▁▁▁▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Fan</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.96</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">▁▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">Refrigerator</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.94</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">▁▁▁▁▇</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Table</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.72</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.00</td>
<td style="text-align: right;">2.0</td>
<td style="text-align: left;">▃▁▁▁▇</td>
</tr>
<tr class="even">
<td style="text-align: left;">dist_road</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">8.59</td>
<td style="text-align: right;">10.27</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.50</td>
<td style="text-align: right;">4.30</td>
<td style="text-align: right;">12.20</td>
<td style="text-align: right;">63.8</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
<tr class="odd">
<td style="text-align: left;">adulteq</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.83</td>
<td style="text-align: right;">1.79</td>
<td style="text-align: right;">0.97</td>
<td style="text-align: right;">2.47</td>
<td style="text-align: right;">3.59</td>
<td style="text-align: right;">4.91</td>
<td style="text-align: right;">20.5</td>
<td style="text-align: left;">▇▂▁▁▁</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics provides a first glance of the data</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>skimpy.skim(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>╭─────────────────────────────── skimpy summary ───────────────────────────────╮
│          Data Summary                Data Types                              │
│ ┏━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┓ ┏━━━━━━━━━━━━━┳━━━━━━━┓                       │
│ ┃ Dataframe         ┃ Values ┃ ┃ Column Type ┃ Count ┃                       │
│ ┡━━━━━━━━━━━━━━━━━━━╇━━━━━━━━┩ ┡━━━━━━━━━━━━━╇━━━━━━━┩                       │
│ │ Number of rows    │ 11434  │ │ category    │ 13    │                       │
│ │ Number of columns │ 17     │ │ float64     │ 3     │                       │
│ └───────────────────┴────────┘ │ int64       │ 1     │                       │
│                                └─────────────┴───────┘                       │
│        Categories                                                            │
│ ┏━━━━━━━━━━━━━━━━━━━━━━━┓                                                    │
│ ┃ Categorical Variables ┃                                                    │
│ ┡━━━━━━━━━━━━━━━━━━━━━━━┩                                                    │
│ │ poor                  │                                                    │
│ │ district              │                                                    │
│ │ urban                 │                                                    │
│ │ hh_f06                │                                                    │
│ │ hh_f08                │                                                    │
│ │ hh_f09                │                                                    │
│ │ hh_f19                │                                                    │
│ │ hh_f41                │                                                    │
│ │ Bed                   │                                                    │
│ │ Desk                  │                                                    │
│ │ Fan                   │                                                    │
│ │ Refrigerator          │                                                    │
│ │ Table                 │                                                    │
│ └───────────────────────┘                                                    │
│                                   number                                     │
│ ┏━━━━━━┳━━━━┳━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━┳━━━━━━┳━━━━━┳━━━━━━┓  │
│ ┃ colu ┃    ┃      ┃      ┃      ┃      ┃      ┃      ┃      ┃ p10 ┃      ┃  │
│ ┃ mn   ┃ NA ┃ NA % ┃ mean ┃ sd   ┃ p0   ┃ p25  ┃ p50  ┃ p75  ┃ 0   ┃ hist ┃  │
│ ┡━━━━━━╇━━━━╇━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━╇━━━━━━╇━━━━━╇━━━━━━┩  │
│ │ rexp │  0 │    0 │ 2824 │ 3668 │ 2231 │ 1294 │ 1979 │ 3175 │ 185 │  █   │  │
│ │ aggp │    │      │   00 │   00 │    0 │   00 │   00 │   00 │ 600 │      │  │
│ │ c    │    │      │      │      │      │      │      │      │  00 │      │  │
│ │ hh_f │  0 │    0 │ 2.79 │ 1.14 │    0 │    2 │    3 │    4 │  10 │ ▂█▂▁ │  │
│ │ 10   │    │      │      │    6 │      │      │      │      │     │      │  │
│ │ dist │  8 │ 0.06 │ 8.59 │ 10.2 │    0 │  1.5 │  4.3 │ 12.2 │ 63. │ █▂▁  │  │
│ │ _roa │    │ 9966 │      │    7 │      │      │      │      │   8 │      │  │
│ │ d    │    │ 7657 │      │      │      │      │      │      │     │      │  │
│ │      │    │ 8625 │      │      │      │      │      │      │     │      │  │
│ │      │    │  154 │      │      │      │      │      │      │     │      │  │
│ │ adul │  0 │    0 │ 3.82 │ 1.79 │ 0.97 │ 2.47 │ 3.58 │ 4.91 │ 20. │  █▄  │  │
│ │ teq  │    │      │    8 │    3 │      │      │    5 │      │   5 │      │  │
│ └──────┴────┴──────┴──────┴──────┴──────┴──────┴──────┴──────┴─────┴──────┘  │
│                                  category                                    │
│ ┏━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━┳━━━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━┓  │
│ ┃ column                 ┃ NA    ┃ NA %     ┃ ordered       ┃ unique      ┃  │
│ ┡━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━╇━━━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━┩  │
│ │ poor                   │     0 │        0 │ True          │           2 │  │
│ │ district               │     0 │        0 │ True          │          32 │  │
│ │ urban                  │     0 │        0 │ True          │           2 │  │
│ │ hh_f06                 │     0 │        0 │ True          │           3 │  │
│ │ hh_f08                 │     0 │        0 │ True          │           6 │  │
│ │ hh_f09                 │     0 │        0 │ True          │           6 │  │
│ │ hh_f19                 │     0 │        0 │ True          │           2 │  │
│ │ hh_f41                 │     0 │        0 │ True          │          13 │  │
│ │ Bed                    │     0 │        0 │ True          │           2 │  │
│ │ Desk                   │     0 │        0 │ True          │           2 │  │
│ │ Fan                    │     0 │        0 │ True          │           2 │  │
│ │ Refrigerator           │     0 │        0 │ True          │           2 │  │
│ │ Table                  │     0 │        0 │ True          │           2 │  │
│ └────────────────────────┴───────┴──────────┴───────────────┴─────────────┘  │
╰──────────────────────────────────── End ─────────────────────────────────────╯</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The output shows that most of the variables are of type categorical, coded with numbers. However, the ‘numbers’ area ssigned arbitrarily and a ranking of numbers might not be meaningful. For instance <code>district</code> = 2 is not ‘more’ than <code>district</code> = 1, they’re simply different districts. What’s more, many ML (machine learning) models require a binary encoding for categorical variables.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># In R, all variables were identified as numeric, despite knowing from the label that they are categorical (e.g. poor coded 0 for no, 1 for yes). This has to do with how the haven package loads labelled STATA data. To correctly assign variable types we'll have to do several things.</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. First, let's examine the structure better</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Examining variable types and patterns:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Examining variable types and patterns:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Function to detect if a variable should be categorical</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>is_categorical_variable <span class="ot">&lt;-</span> <span class="cf">function</span>(x, var_name) {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if it has value labels (common for categorical in Stata)</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  has_value_labels <span class="ot">&lt;-</span> <span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">attr</span>(x, <span class="st">"labels"</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check number of unique values relative to total observations</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  n_unique <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)]))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  n_total <span class="ot">&lt;-</span> <span class="fu">length</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)])</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rule: if fewer than 10 unique values OR less than 5% unique values, likely categorical</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  few_unique <span class="ot">&lt;-</span> (n_unique <span class="sc">&lt;=</span> <span class="dv">10</span>) <span class="sc">|</span> (n_unique <span class="sc">/</span> n_total <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if values look like codes (integers from 0 or 1)</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  is_integer_like <span class="ot">&lt;-</span> <span class="fu">all</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)] <span class="sc">==</span> <span class="fu">floor</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)]))</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  small_range <span class="ot">&lt;-</span> (<span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">&lt;=</span> <span class="dv">20</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Special cases: known categorical variable patterns</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  is_known_categorical <span class="ot">&lt;-</span> <span class="fu">grepl</span>(<span class="st">"district|urban|poor"</span>, var_name, <span class="at">ignore.case =</span> <span class="cn">TRUE</span>)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(has_value_labels <span class="sc">|</span> (few_unique <span class="sc">&amp;</span> is_integer_like <span class="sc">&amp;</span> small_range) <span class="sc">|</span> is_known_categorical)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Apply the function to identify categorical variables</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>categorical_candidates <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">names</span>(malawi), <span class="cf">function</span>(var_name) {</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is_categorical_variable</span>(malawi[[var_name]], var_name)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Identified categorical variables:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Identified categorical variables:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">names</span>(malawi)[categorical_candidates])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "poor"         "district"     "urban"        "hh_f06"       "hh_f08"      
 [6] "hh_f09"       "hh_f10"       "hh_f19"       "hh_f41"       "Bed"         
[11] "Desk"         "Fan"          "Refrigerator" "Table"       </code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 14 out of 17 variables should be categorical</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Convert identified variables to factors</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var_name <span class="cf">in</span> <span class="fu">names</span>(malawi)[categorical_candidates]) {</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to factor, preserving value labels if they exist</span></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(<span class="fu">attr</span>(malawi[[var_name]], <span class="st">"labels"</span>))) {</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use value labels for factor levels</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    labels_attr <span class="ot">&lt;-</span> <span class="fu">attr</span>(malawi[[var_name]], <span class="st">"labels"</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>    malawi[[var_name]] <span class="ot">&lt;-</span> <span class="fu">factor</span>(malawi[[var_name]], </span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">levels =</span> labels_attr, </span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">labels =</span> <span class="fu">names</span>(labels_attr))</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Simple conversion to factor</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    malawi[[var_name]] <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(malawi[[var_name]])</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># When converting data types in R, labels may be lost</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Restore labels after conversion</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> <span class="fu">names</span>(malawi)) {</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(variable_labels[[var]])) {</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">attr</span>(malawi[[var]], <span class="st">"label"</span>) <span class="ot">&lt;-</span> variable_labels[[var]]</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Sanity check</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> <span class="fu">names</span>(malawi)) {</span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"%-20s %s</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>              <span class="fu">paste0</span>(var, <span class="st">" ("</span>, <span class="fu">class</span>(malawi[[var]]), <span class="st">"):"</span>), </span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>              <span class="fu">attr</span>(malawi[[var]], <span class="st">"label"</span>) <span class="sc">%||%</span> <span class="st">"No label"</span>))</span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>poor (factor):       Dummy for poor households below national poverty line
rexpaggpc (numeric): Total real annual per capita consumption
district (factor):   IHS5 2019 District Location
urban (factor):      Urban/rural
hh_f06 (factor):     WHAT GENERAL TYPE OF CONSTRUCTION MATERIALS ARE USED FOR THE DWELLING?
hh_f08 (factor):     The roof of the main dwelling is predominantly made of what material?
hh_f09 (factor):     THE FLOOR OF THE MAIN DWELLING IS PREDOMINANTLY MADE OF WHAT MATERIAL?
hh_f10 (factor):     How many separate rooms do the members of your household upy?
hh_f19 (factor):     Do you have  electricity working in your dwelling?
hh_f41 (factor):     What kind of toilet facility does your household use?
Bed (factor):        Bed hh_l01
Desk (factor):       Desk hh_l01
Fan (factor):        Fan hh_l01
Refrigerator (factor): Refrigerator hh_l01
Table (factor):      Table hh_l01
dist_road (numeric): HH Distance in (KMs) to Nearest Major Road
adulteq (numeric):   Adult equivalence</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Create dummy variables for factors with more than 2 levels (keep labels)</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>factors_multi_level <span class="ot">&lt;-</span> <span class="fu">names</span>(malawi)[<span class="fu">sapply</span>(malawi, <span class="cf">function</span>(x) {</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">is.factor</span>(x) <span class="sc">&amp;&amp;</span> <span class="fu">nlevels</span>(x) <span class="sc">&gt;</span> <span class="dv">2</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>})]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Multiple-level factors to convert:"</span>, <span class="fu">paste</span>(factors_multi_level, <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Multiple-level factors to convert: district, hh_f06, hh_f08, hh_f09, hh_f10, hh_f41 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># FINALLY</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. Create dummy variables using caret</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>dummy_vars <span class="ot">&lt;-</span> <span class="fu">dummyVars</span>(<span class="sc">~</span> ., <span class="at">data =</span> malawi, <span class="at">fullRank =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>malawi <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">predict</span>(dummy_vars, <span class="at">newdata =</span> malawi))</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dataset now has"</span>, <span class="fu">ncol</span>(malawi), <span class="st">"columns after dummy variable creation</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dataset now has 76 columns after dummy variable creation</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Another Sanity Check</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(var <span class="cf">in</span> <span class="fu">names</span>(malawi)) {</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"%-20s %s</span><span class="sc">\n</span><span class="st">"</span>, </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>              <span class="fu">paste0</span>(var, <span class="st">" ("</span>, <span class="fu">class</span>(malawi[[var]]), <span class="st">"):"</span>), </span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">attr</span>(malawi[[var]], <span class="st">"label"</span>) <span class="sc">%||%</span> <span class="st">"No label"</span>))</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>poor.Poor (numeric): No label
rexpaggpc (numeric): No label
district.Karonga (numeric): No label
district.Nkhatabay (numeric): No label
district.Rumphi (numeric): No label
district.Mzimba (numeric): No label
district.Likoma (numeric): No label
district.Mzuzu.City (numeric): No label
district.Kasungu (numeric): No label
district.Nkhotakota (numeric): No label
district.Ntchisi (numeric): No label
district.Dowa (numeric): No label
district.Salima (numeric): No label
district.Lilongwe (numeric): No label
district.Mchinji (numeric): No label
district.Dedza (numeric): No label
district.Ntcheu (numeric): No label
district.Lilongwe.City (numeric): No label
district.Mangochi (numeric): No label
district.Machinga (numeric): No label
district.Zomba.Non.City (numeric): No label
district.Chiradzulu (numeric): No label
district.Blantyre (numeric): No label
district.Mwanza (numeric): No label
district.Thyolo (numeric): No label
district.Mulanje (numeric): No label
district.Phalombe (numeric): No label
district.Chikwawa (numeric): No label
district.Nsanje (numeric): No label
district.Balaka (numeric): No label
district.Neno (numeric): No label
district.Zomba.City (numeric): No label
district.Blantyre.City (numeric): No label
urban.RURAL (numeric): No label
hh_f06.SEMI.PERMANENT (numeric): No label
hh_f06.TRADITIONAL (numeric): No label
hh_f08.IRON.SHEETS (numeric): No label
hh_f08.CLAY.TILES (numeric): No label
hh_f08.CONCRETE (numeric): No label
hh_f08.PLASTIC.SHEETING (numeric): No label
hh_f08.OTHER..SPECIFY. (numeric): No label
hh_f09.SMOOTHED.MUD (numeric): No label
hh_f09.SMOOTH.CEMENT (numeric): No label
hh_f09.WOOD (numeric): No label
hh_f09.TILE (numeric): No label
hh_f09.OTHER.SPECIFY. (numeric): No label
hh_f10.1 (numeric):  No label
hh_f10.2 (numeric):  No label
hh_f10.3 (numeric):  No label
hh_f10.4 (numeric):  No label
hh_f10.5 (numeric):  No label
hh_f10.6 (numeric):  No label
hh_f10.7 (numeric):  No label
hh_f10.8 (numeric):  No label
hh_f10.9 (numeric):  No label
hh_f10.10 (numeric): No label
hh_f19.NO (numeric): No label
hh_f41.Flush.to.septic.tank (numeric): No label
hh_f41.Flush.to.pit.latrine (numeric): No label
hh_f41.Flush.to.open.drain (numeric): No label
hh_f41.Flush.to.DK.where (numeric): No label
hh_f41.Ventilated.Improved.Pit.latrine (numeric): No label
hh_f41.Pit.latrine.with.slab (numeric): No label
hh_f41.Pit.latrine.without.slab..Open.pit (numeric): No label
hh_f41.Composting.toilet (numeric): No label
hh_f41.Bucket (numeric): No label
hh_f41.Hanging.toilet...Hanging.latrine (numeric): No label
hh_f41.No.facility...Bush...Field (numeric): No label
hh_f41.Other..specify. (numeric): No label
Bed.No (numeric):    No label
Desk.No (numeric):   No label
Fan.No (numeric):    No label
Refrigerator.No (numeric): No label
Table.No (numeric):  No label
dist_road (numeric): No label
adulteq (numeric):   No label</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert binary variables to factors using sapply (after dummyVars we lost the correct object type again, oops)</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>binary_vars <span class="ot">&lt;-</span> <span class="fu">sapply</span>(malawi, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)])) <span class="sc">==</span> <span class="dv">2</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>malawi[binary_vars] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(malawi[binary_vars], as.factor)</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="st">How R stores dummy variables:</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="st">    E.g. For poor.Poor:</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="st">1 = the household IS poor</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="st">0 = the household is NOT poor</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="st">R's dummyVars() with fullRank = TRUE creates binary (0/1) dummy variables where:</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="st">The variable name format is: original_variable.category_name</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="st">1 means that observation belongs to that category</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="st">0 means it doesn't belong to that category</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="st">The first category is dropped to avoid multicollinearity (that's why we don't see poor.NotPoor or similar)</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
How R stores dummy variables:
    E.g. For poor.Poor:

1 = the household IS poor
0 = the household is NOT poor

R's dummyVars() with fullRank = TRUE creates binary (0/1) dummy variables where:

The variable name format is: original_variable.category_name
1 means that observation belongs to that category
0 means it doesn't belong to that category
The first category is dropped to avoid multicollinearity (that's why we don't see poor.NotPoor or similar)</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's encode all object variables that have more than 2 unique values as categorical variables</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> df.select_dtypes(include<span class="op">=</span>[<span class="st">'object'</span>]).columns:</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df[col].nunique() <span class="op">&gt;</span> <span class="dv">2</span>:</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>        df[col] <span class="op">=</span> df[col].astype(<span class="st">'category'</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert these categorical variables to binary variables</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.get_dummies(df, drop_first<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Note that we get one binary variable for each category of the categorical variable. The first category is dropped to avoid multi-collinearity.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>The summary output also indicated that we have missing values. In our case, the variable <code>dist_roaod</code> has 8 missing values (‘NA’ values -&gt; Not Available). Many machine learning models cannot be trained when missing values are present (several exceptions exist).</p>
<p>Dealing with missingness is a non-trivial task: First and foremost, we should assess whether there is a pattern to missingness and if so, what that means to what we can learn from our (sub)population. If there is no discernible pattern, we can proceed to delete the missing values or impute them. A more detailed explanation and course of action can be found <a href="https://stefvanbuuren.name/fimd/ch-introduction.html">here</a>.</p>
<p>In our application, we’ll remove the NA values from the data.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-7-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-1" role="tab" aria-controls="tabset-7-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-7-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-7-2" role="tab" aria-controls="tabset-7-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-7-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-7-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>malawi <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(malawi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-7-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-7-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>To finalise our exploration of the dataset, we should:</p>
<ul>
<li><p>visualize the target variable (a.k.a. outcome of interest)</p></li>
<li><p>have a look at correlations</p></li>
</ul>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-8-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-1" role="tab" aria-controls="tabset-8-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-8-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-8-2" role="tab" aria-controls="tabset-8-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-8-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-8-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of the target variable</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(malawi, <span class="fu">aes</span>(<span class="at">x =</span> rexpaggpc)) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">600</span>) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">'Distribution of Consumption p.c.'</span>,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">'Consumption p.c.'</span>,</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">'Frequency'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session_1_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Summary statistics for rexpaggpc using tidy syntax (notice our fun pipe operator, we'll talk about this syntax in the future)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>malawi<span class="sc">$</span>rexpaggpc <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
   22307   129364   197842   282339   317476 18560576 </code></pre>
</div>
</div>
<p>Our target variable has a long right tail, i.e.&nbsp;there are few households with very large consumption levels. At the same time, we have many observations close to zero pointing at a high level of poverty. The data was already cleaned by the LSMS team, and not further data cleaning is required in this case.</p>
<p>In the last step, we visualize a correlation matrix. The correlation coefficients are interpreted as 0 = no correlation, 1 =perfect positive correlation, and -1 =perfect negative correlation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearson correlation matrix</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cor() only takes fully numeric attributes (i.e. variables), for the sake of the correlation matrix, we will create a numeric copy of our malawi df</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert binary factor variables to numeric (0 = 0, 1 = 1)</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>malawi_cor <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(malawi, <span class="cf">function</span>(x) <span class="cf">if</span> (<span class="fu">is.factor</span>(x)) <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(x)) <span class="cf">else</span> x))</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>pearson_corr_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(malawi_cor, <span class="at">method =</span> <span class="st">"pearson"</span>, <span class="at">use =</span> <span class="st">"complete.obs"</span>)</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(pearson_corr_matrix, <span class="at">method =</span> <span class="st">"circle"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.cex =</span> <span class="fl">0.5</span>, <span class="co"># labels' text size</span></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">tl.srt =</span> <span class="dv">45</span>,   <span class="co"># rotate text labels</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">diag =</span> <span class="cn">FALSE</span>)  <span class="co"># hide the diagonal (optional, try both!)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session_1_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The first column visualizes the correlation coefficients with <code>rexpaggpc</code> (consumption per capita), the target variable. The results shows strong correlations of the target variable with the household size, assets (tables etc.), some sanitary and housing categories, as well as region indicators. Not surprisingly, consumption per capita is highly correlated with the household poverty status, a binary indicator that is based on consumption levels and that will be used as the target variable in our next session.</p>
<p>We can also spot some correlation coefficients that equal zero. In some situations, the data generating mechanism can create predictors that only have a single unique value (i.e.&nbsp;a ‘zero-variance predictor’). For many ML models (excluding tree-based models), this may cause the model to crash or the fit to be unstable. Here, the only one we’ve spotted is not in relation to our target variable. But we do observe some near-zero-variance predictors. Besides uninformative, these can also create unstable model fits. There’s a few strategies to deal with these; the quickest solution is to remove them. A second option, which is especially interesting in scenarios with a large number of variables, is to work with penalized models (Ridge and Lasso regressions). We’ll discuss this option at a later stage.</p>
</div>
<div id="tabset-8-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-8-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Histogram of the target variable</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(df[<span class="st">'rexpaggpc'</span>], kde<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Distribution of Consumption p.c.'</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Consumption p.c.'</span>)</span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Frequency'</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session_1_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df.rexpaggpc.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>count    1.142600e+04
mean     2.823392e+05
std      3.666861e+05
min      2.230664e+04
25%      1.293637e+05
50%      1.978420e+05
75%      3.174764e+05
max      1.856058e+07
Name: rexpaggpc, dtype: float64</code></pre>
</div>
</div>
<p>Our target variable has a long right tail, i.e.&nbsp;there are few households with very large consumption levels. At the same time, we have many observations close to zero pointing at a high level of poverty. The data was already cleaned by the LSMS team, and not further data cleaning is required in this case.</p>
<p>In the last step, we visualize a correlation matrix. The correlation coefficients are interpreted as 0 = no correlation, 1 =perfect positive correlation, and -1 =perfect negative correlation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Spearman correlation matrix </span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>pearson_corr_matrix <span class="op">=</span> df.corr(method<span class="op">=</span><span class="st">'pearson'</span>)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">8</span>))</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(pearson_corr_matrix, annot<span class="op">=</span><span class="va">False</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>, linewidths<span class="op">=</span><span class="fl">0.5</span>, annot_kws<span class="op">=</span>{<span class="st">'size'</span>: <span class="dv">6</span>})</span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Pearson's r Correlation Matrix"</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session_1_files/figure-html/unnamed-chunk-21-3.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
</div>
<p>The first column visualizes the correlation coefficients with <code>rexpaggpc</code> (consumption per capita), the target variable. The results shows strong correlations of the target variable with the household size, assets (tables etc.), some sanitary and housing categories, as well as region indicators. Not surprisingly, consumption per capita is highly correlated with the household poverty status, a binary indicator that is based on consumption levels and that will be used as the target variable in our next session.</p>
<p>We can also spot some correlation coefficients that equal zero. In some situations, the data generating mechanism can create predictors that only have a single unique value (i.e.&nbsp;a ‘zero-variance predictor’). For many ML models (excluding tree-based models), this may cause the model to crash or the fit to be unstable. Here, the only one we’ve spotted is not in relation to our target variable. But we do observe some near-zero-variance predictors. Besides uninformative, these can also create unstable model fits. There’s a few strategies to deal with these; the quickest solution is to remove them. A second option, which is especially interesting in scenarios with a large number of variables, is to work with penalized models (Ridge and Lasso regressions). We’ll discuss this option at a later stage.</p>
</div>
</div>
</div>
</section>
<section id="a-primer-on-ml-prediction" class="level3">
<h3 class="anchored" data-anchor-id="a-primer-on-ml-prediction">3. A primer on ML prediction</h3>
<section id="partition-into-training-and-test-data" class="level4">
<h4 class="anchored" data-anchor-id="partition-into-training-and-test-data">Partition into Training and Test Data</h4>
<p>We now have a general idea of the structure of the data we are working with, and what we’re trying to predict: per capita consumption, which we believe is a proxy for poverty prevalence. The next step is create a simple linear model (OLS) to predict the target variable using the variables in our dataset, and introduce the elements with which we will evaluate our model.</p>
<section id="data-partinioning" class="level5">
<h5 class="anchored" data-anchor-id="data-partinioning">Data Partinioning</h5>
<p>When we want to build predictive models for machine learning purposes, it is important to have (at least) two data sets. A training data set from which our model will learn, and a test data set containing the same features as our training data set; we use the second dataset to see how well our predictive model extrapolates to other samples (i.e.&nbsp;is it generalizable?). To split our main data set into two, we will work with a 80/20 split.</p>
<p>The 80/20 split has its origins in the Pareto Principle, which states that ‘in most cases, 80% of effects from from 20% of causes’. Though there are other test/train splitting options, this partitioning method is a good place to start, and indeed standard in the machine learning field.</p>
<p><strong>Feature organization</strong></p>
<p>Our data contains the variables we want to predict, i.e.&nbsp;the target variables (consumption per capita: <code>rexpaggpc</code>; poverty status: Py <code>poor_Poor</code>/ R <code>poor.Poor</code>) and the predictors (all other variables). let’s put the target variables in a separate dataframe.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-9-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-1" role="tab" aria-controls="tabset-9-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-9-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-9-2" role="tab" aria-controls="tabset-9-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-9-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-9-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>target <span class="ot">&lt;-</span> malawi[<span class="fu">c</span>(<span class="st">'rexpaggpc'</span>, <span class="st">'poor.Poor'</span>)]</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove target from malawi</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>malawi <span class="ot">&lt;-</span> malawi[<span class="sc">!</span><span class="fu">names</span>(malawi) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">'rexpaggpc'</span>, <span class="st">'poor.Poor'</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we split the data into 80% training and test data using createDataPartition() from caret. We will use 80% of the data for training and 20% for testing. We will also set a random seed via <code>set.seed()</code> to ensure that the results are reproducible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set seed for reproducibility</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create train/test split based on target variable</span></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>train_idx <span class="ot">&lt;-</span> <span class="fu">createDataPartition</span>(target<span class="sc">$</span>rexpaggpc, <span class="at">p =</span> .<span class="dv">8</span>, <span class="at">list =</span> <span class="cn">FALSE</span>, <span class="at">times =</span> <span class="dv">1</span>) </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># creates indices based on target distribution and 80/20 rule</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a><span class="co"># using stratification based on rexpaggpc (continuous) when we later want to model poor.Poor (binary) could potentially be suboptimal, but it's generally not a major problem</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># a stratified approach (which we use here) is generally better for model evaluation.</span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Split both features and targets</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>Train_df <span class="ot">&lt;-</span> malawi[train_idx, ]</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>Test_df <span class="ot">&lt;-</span> malawi[<span class="sc">-</span>train_idx, ]</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>Train_target <span class="ot">&lt;-</span> target[train_idx, ]</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>Test_target <span class="ot">&lt;-</span> target[<span class="sc">-</span>train_idx, ]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s check the shape of the dataframes. The test and training data must have the same predictors and the target and predictors data must have the same length.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the dimensions of the dataframes</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Train_df dimensions:"</span>, <span class="fu">dim</span>(Train_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train_df dimensions: 9142 74 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Test_df dimensions:"</span>, <span class="fu">dim</span>(Test_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test_df dimensions: 2284 74 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Train_target dimensions:"</span>, <span class="fu">dim</span>(Train_target), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train_target dimensions: 9142 2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Test_target dimensions:"</span>, <span class="fu">dim</span>(Test_target), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test_target dimensions: 2284 2 </code></pre>
</div>
</div>
<p>Before fitting models, we must standardize our variables. We use caret’s <code>preProcess</code> with <code>center</code> and <code>scale</code> options that subtract each variable’s mean from all values and divide by the variable’s standard deviation. This transforms variables to have zero mean and unit variance, measuring values as standard deviations from the mean.</p>
<p>Standardization ensures that coefficients or weights assigned to each variable are comparable across different scales. Without it, comparing the effect of a one-unit increase in distance to the nearest road (measured in kilometers) versus a one-unit increase in household size (measured in people) would be meaningless. For many machine learning algorithms, this comparability is essential—standardization prevents variables with larger scales from dominating the model simply due to their magnitude rather than their predictive importance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize variables</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>preproc <span class="ot">&lt;-</span> <span class="fu">preProcess</span>(Train_df, <span class="at">method =</span> <span class="fu">c</span>(<span class="st">"center"</span>, <span class="st">"scale"</span>))</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>Train_df <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, Train_df)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>Test_df <span class="ot">&lt;-</span> <span class="fu">predict</span>(preproc, Test_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-9-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-9-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> df[[<span class="st">'rexpaggpc'</span>, <span class="st">'poor_Poor'</span>]]</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove target from df</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.drop([<span class="st">'rexpaggpc'</span>, <span class="st">'poor_Poor'</span>], axis<span class="op">=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we split the data into 80% training and test data using train_test_split() from sklearn. We will use 80% of the data for training and 20% for testing. We will also set a random seed via <code>random_state</code> to ensure that the results are reproducible.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>X_train, X_test, y_train, y_test<span class="op">=</span>train_test_split(df,target[<span class="st">'rexpaggpc'</span>], test_size<span class="op">=</span><span class="fl">0.2</span>, random_state<span class="op">=</span><span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s check the shape of the dataframes. The test and training data must have the same predictors and the target and predictors data must have the same length.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the dimensions of the dataframes</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"X_train dimensions: </span><span class="sc">{</span>X_train<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>X_train dimensions: (9140, 65)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"X_test dimensions: </span><span class="sc">{</span>X_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>X_test dimensions: (2286, 65)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y_train dimensions: </span><span class="sc">{</span>y_train<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>y_train dimensions: (9140,)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"y_test dimensions: </span><span class="sc">{</span>y_test<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>y_test dimensions: (2286,)</code></pre>
</div>
</div>
<p>Before fitting models, we must standardize our variables. We use <code>sklearn</code>’s <code>Standard Scaler</code> that subtracts each variable’s mean from all values and divides by the variable’s standard deviation. This transforms variables to have zero mean and unit variance, measuring values as standard deviations from the mean.</p>
<p>Standardization ensures that coefficients or weights assigned to each variable are comparable across different scales. Without it, comparing the effect of a one-unit increase in distance to the nearest road (measured in kilometers) versus a one-unit increase in household size (measured in people) would be meaningless. For many machine learning algorithms, this comparability is essential—standardization prevents variables with larger scales from dominating the model simply due to their magnitude rather than their predictive importance.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Standardize variables</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>X_train <span class="op">=</span> scaler.fit_transform(X_train)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>X_test <span class="op">=</span> scaler.transform(X_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="orinary-least-squares-ols-a-simple-linear-regression" class="level4">
<h4 class="anchored" data-anchor-id="orinary-least-squares-ols-a-simple-linear-regression">Orinary Least Squares [OLS] (a simple linear regression)</h4>
<p>We can now run our first prediction model!</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-10-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-1" role="tab" aria-controls="tabset-10-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-10-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-10-2" role="tab" aria-controls="tabset-10-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-10-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-10-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit simple linear regression model</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co">#linear &lt;- lm(Train_target$rexpaggpc ~ ., data = Train_df) # only run this line if you want to see an error! :)</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Oh oh, an error?</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>single_value_cols <span class="ot">&lt;-</span> <span class="fu">sapply</span>(Train_df, <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">&lt;=</span> <span class="dv">1</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(single_value_cols[single_value_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hh_f10.9"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Seems like we have one factor variable with only one level! = hh_f10.9</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># What to do with it? </span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's inspect it first:</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(single_value_cols[single_value_cols])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "hh_f10.9"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(Train_df<span class="sc">$</span>hh_f10<span class="fl">.9</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Factor w/ 2 levels "0","1": 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># two-factors?! This happens often when we split the data and "accidentally" end up with a train or test data with only one category for a two category var.</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># See the actual values</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Train_df<span class="sc">$</span>hh_f10<span class="fl">.9</span>) <span class="co"># ... Ah, our hypothesis was right! All values are bunched in the 0 category!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   0    1 
9142    0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the problematic variable</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>Train_df <span class="ot">&lt;-</span> Train_df[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(Train_df) <span class="sc">==</span> <span class="st">"hh_f10.9"</span>)]</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>Test_df <span class="ot">&lt;-</span> Test_df[, <span class="sc">-</span><span class="fu">which</span>(<span class="fu">names</span>(Test_df) <span class="sc">==</span> <span class="st">"hh_f10.9"</span>)] <span class="co"># same here, both datasets should be the same! </span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Check our dfs</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Train_df dimensions:"</span>, <span class="fu">dim</span>(Train_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Train_df dimensions: 9142 73 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Test_df dimensions:"</span>, <span class="fu">dim</span>(Test_df), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test_df dimensions: 2284 73 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># One variable less than before, we're good to go.</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now fit your model</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(Train_target<span class="sc">$</span>rexpaggpc <span class="sc">~</span> ., <span class="at">data =</span> Train_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In R, we can retrieve the model’s fit metrics (and more) in one go, inclduing: - Coefficients - Standard errors - t-statistics - p-values - Model fit statistics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the linear model's metrics using modelsummary (notice our beautiful pipe operators are at it again here)</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">modelsummary</span>(</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">"linear (Test_df)"</span> <span class="ot">=</span> linear),</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">output =</span> <span class="st">"gt"</span>,</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">fmt =</span> <span class="dv">2</span>,  <span class="co"># controls decimal places</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">statistic =</span> <span class="st">"({std.error})"</span>,  <span class="co"># show standard errors in parentheses!</span></span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">stars =</span> <span class="cn">TRUE</span>, <span class="co"># indicate statistical significance with stars *</span></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">column_labels =</span> <span class="st">"linear (test df)"</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_header</span>(</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="fu">md</span>(<span class="st">"**Regression Results**"</span>)</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tab_options</span>(</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">table.font.size =</span> <span class="st">"small"</span>,</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data_row.padding =</span> <span class="fu">px</span>(<span class="dv">2</span>),</span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">heading.title.font.size =</span> <span class="dv">16</span>,</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_group.as_column =</span> <span class="cn">TRUE</span></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="ajpisoxxmr" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ajpisoxxmr table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ajpisoxxmr thead, #ajpisoxxmr tbody, #ajpisoxxmr tfoot, #ajpisoxxmr tr, #ajpisoxxmr td, #ajpisoxxmr th {
  border-style: none;
}

#ajpisoxxmr p {
  margin: 0;
  padding: 0;
}

#ajpisoxxmr .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: small;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ajpisoxxmr .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ajpisoxxmr .gt_title {
  color: #333333;
  font-size: 16px;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ajpisoxxmr .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ajpisoxxmr .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ajpisoxxmr .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ajpisoxxmr .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ajpisoxxmr .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ajpisoxxmr .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ajpisoxxmr .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ajpisoxxmr .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ajpisoxxmr .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ajpisoxxmr .gt_spanner_row {
  border-bottom-style: hidden;
}

#ajpisoxxmr .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ajpisoxxmr .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ajpisoxxmr .gt_from_md > :first-child {
  margin-top: 0;
}

#ajpisoxxmr .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ajpisoxxmr .gt_row {
  padding-top: 2px;
  padding-bottom: 2px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ajpisoxxmr .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ajpisoxxmr .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ajpisoxxmr .gt_row_group_first td {
  border-top-width: 2px;
}

#ajpisoxxmr .gt_row_group_first th {
  border-top-width: 2px;
}

#ajpisoxxmr .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ajpisoxxmr .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ajpisoxxmr .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ajpisoxxmr .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ajpisoxxmr .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ajpisoxxmr .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ajpisoxxmr .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ajpisoxxmr .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ajpisoxxmr .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ajpisoxxmr .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ajpisoxxmr .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ajpisoxxmr .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ajpisoxxmr .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ajpisoxxmr .gt_left {
  text-align: left;
}

#ajpisoxxmr .gt_center {
  text-align: center;
}

#ajpisoxxmr .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ajpisoxxmr .gt_font_normal {
  font-weight: normal;
}

#ajpisoxxmr .gt_font_bold {
  font-weight: bold;
}

#ajpisoxxmr .gt_font_italic {
  font-style: italic;
}

#ajpisoxxmr .gt_super {
  font-size: 65%;
}

#ajpisoxxmr .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ajpisoxxmr .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ajpisoxxmr .gt_indent_1 {
  text-indent: 5px;
}

#ajpisoxxmr .gt_indent_2 {
  text-indent: 10px;
}

#ajpisoxxmr .gt_indent_3 {
  text-indent: 15px;
}

#ajpisoxxmr .gt_indent_4 {
  text-indent: 20px;
}

#ajpisoxxmr .gt_indent_5 {
  text-indent: 25px;
}

#ajpisoxxmr .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ajpisoxxmr div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_heading header">
<th colspan="2" class="gt_heading gt_title gt_font_normal gt_bottom_border"><strong>Regression Results</strong></th>
</tr>
<tr class="gt_col_headings even">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="linear-(Test_df)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">linear (Test_df)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">(Intercept)</td>
<td class="gt_row gt_center" headers="linear (Test_df)">1081787.87***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(174989.36)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Karonga1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">51925.88**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19342.61)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Nkhatabay1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">127818.18***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19604.99)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Rumphi1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">119235.12***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19897.04)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Mzimba1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">26404.73</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19984.16)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Likoma1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">55193.99</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(50000.75)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Mzuzu.City1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">140541.07***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(22614.73)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Kasungu1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">12809.91</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19222.97)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Nkhotakota1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">70716.27***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19623.02)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Ntchisi1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">39991.17*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19895.30)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Dowa1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">19009.00</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(20192.96)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Salima1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">23070.71</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19312.92)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Lilongwe1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">9833.43</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(17691.68)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Mchinji1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">39081.29*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19832.64)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Dedza1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">19904.40</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19888.68)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Ntcheu1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-867.92</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19918.16)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Lilongwe.City1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">109926.18***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(21490.42)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Mangochi1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">9583.89</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19312.11)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Machinga1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">2733.71</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(20791.42)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Zomba.Non.City1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">53755.55**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19583.18)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Chiradzulu1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">48136.59*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(20150.24)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Blantyre1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">19599.17</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19522.02)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Mwanza1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">29553.99</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(20368.64)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Thyolo1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">8086.53</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19390.36)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Mulanje1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">21696.69</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19601.84)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Phalombe1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">41950.49*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(21328.83)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Chikwawa1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">3907.53</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19880.44)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Nsanje1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">13129.88</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19951.59)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Balaka1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-2292.96</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(19639.48)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Neno1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">59699.85**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(20343.12)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Zomba.City1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">101774.05***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(23269.64)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">district.Blantyre.City1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">73195.95**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(22728.49)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">urban.RURAL1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">25787.39+</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(13275.42)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f06.SEMI.PERMANENT1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-12987.49</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(8481.67)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f06.TRADITIONAL1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-22652.46*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(11211.55)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f08.IRON.SHEETS1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">24042.72**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(8180.79)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f08.CLAY.TILES1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">3458.02</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(63144.84)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f08.CONCRETE1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">39450.84</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(234211.71)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f08.PLASTIC.SHEETING1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">75388.84</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(116847.22)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f08.OTHER..SPECIFY.1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">392061.27***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(83355.74)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f09.SMOOTHED.MUD1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-19598.72</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(17166.61)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f09.SMOOTH.CEMENT1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">21182.92</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(18641.49)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f09.WOOD1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">248900.04</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(234057.58)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f09.TILE1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">407874.43***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(43871.63)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f09.OTHER.SPECIFY.1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-168867.83</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(136229.12)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f10.11</td>
<td class="gt_row gt_center" headers="linear (Test_df)">411273.44*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(165403.26)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f10.21</td>
<td class="gt_row gt_center" headers="linear (Test_df)">395277.17*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(165335.38)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f10.31</td>
<td class="gt_row gt_center" headers="linear (Test_df)">409056.22*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(165341.88)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f10.41</td>
<td class="gt_row gt_center" headers="linear (Test_df)">405868.71*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(165403.53)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f10.51</td>
<td class="gt_row gt_center" headers="linear (Test_df)">439660.09**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(165679.89)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f10.61</td>
<td class="gt_row gt_center" headers="linear (Test_df)">466813.75**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(166552.28)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f10.71</td>
<td class="gt_row gt_center" headers="linear (Test_df)">368540.21*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(187588.95)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f10.81</td>
<td class="gt_row gt_center" headers="linear (Test_df)">763708.07**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(286091.07)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f10.101</td>
<td class="gt_row gt_center" headers="linear (Test_df)">2602037.24***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(290319.44)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f19.NO1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-100525.07***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(10533.74)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Flush.to.septic.tank1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">171036.85***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(34264.99)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Flush.to.pit.latrine1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-56814.68</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(65995.27)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Flush.to.open.drain1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-399912.68**</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(138314.05)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Flush.to.DK.where1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-415810.02+</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(235525.51)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Ventilated.Improved.Pit.latrine1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-235594.21***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(36698.14)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Pit.latrine.with.slab1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-270739.07***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(31425.38)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Pit.latrine.without.slab..Open.pit1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-297951.41***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(31639.93)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Composting.toilet1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-303265.38***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(38821.28)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Bucket1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-336061.97***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(100369.00)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Hanging.toilet...Hanging.latrine1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-383691.72***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(64849.78)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.No.facility...Bush...Field1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-306492.86***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(32732.53)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">hh_f41.Other..specify.1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-285095.53***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(58943.63)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Bed.No1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-57347.06***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(6738.50)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Desk.No1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-644991.33***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(41069.27)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Fan.No1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-77347.37***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(15741.75)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Refrigerator.No1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-140356.80***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(14628.99)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Table.No1</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-25723.39***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(6300.86)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">dist_road</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-762.32</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="linear (Test_df)">(3611.49)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">adulteq</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-109167.24***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" " style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="linear (Test_df)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(2632.72)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Num.Obs.</td>
<td class="gt_row gt_center" headers="linear (Test_df)">9142</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">R2</td>
<td class="gt_row gt_center" headers="linear (Test_df)">0.473</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">R2 Adj.</td>
<td class="gt_row gt_center" headers="linear (Test_df)">0.469</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">AIC</td>
<td class="gt_row gt_center" headers="linear (Test_df)">251980.8</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">BIC</td>
<td class="gt_row gt_center" headers="linear (Test_df)">252514.8</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">Log.Lik.</td>
<td class="gt_row gt_center" headers="linear (Test_df)">-125915.396</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">RMSE</td>
<td class="gt_row gt_center" headers="linear (Test_df)">231966.71</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="2" class="gt_sourcenote">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
<p>Or alternatively, just the coefficients (for those following both R and Python that would like to keep things as similar as possible)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just coefficients</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(linear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                               (Intercept) 
                              1081787.8708 
                         district.Karonga1 
                                51925.8781 
                       district.Nkhatabay1 
                               127818.1764 
                          district.Rumphi1 
                               119235.1215 
                          district.Mzimba1 
                                26404.7293 
                          district.Likoma1 
                                55193.9867 
                      district.Mzuzu.City1 
                               140541.0719 
                         district.Kasungu1 
                                12809.9111 
                      district.Nkhotakota1 
                                70716.2660 
                         district.Ntchisi1 
                                39991.1727 
                            district.Dowa1 
                                19008.9994 
                          district.Salima1 
                                23070.7108 
                        district.Lilongwe1 
                                 9833.4350 
                         district.Mchinji1 
                                39081.2891 
                           district.Dedza1 
                                19904.3977 
                          district.Ntcheu1 
                                 -867.9189 
                   district.Lilongwe.City1 
                               109926.1788 
                        district.Mangochi1 
                                 9583.8907 
                        district.Machinga1 
                                 2733.7125 
                  district.Zomba.Non.City1 
                                53755.5457 
                      district.Chiradzulu1 
                                48136.5860 
                        district.Blantyre1 
                                19599.1670 
                          district.Mwanza1 
                                29553.9885 
                          district.Thyolo1 
                                 8086.5291 
                         district.Mulanje1 
                                21696.6863 
                        district.Phalombe1 
                                41950.4896 
                        district.Chikwawa1 
                                 3907.5277 
                          district.Nsanje1 
                                13129.8830 
                          district.Balaka1 
                                -2292.9592 
                            district.Neno1 
                                59699.8470 
                      district.Zomba.City1 
                               101774.0533 
                   district.Blantyre.City1 
                                73195.9460 
                              urban.RURAL1 
                                25787.3920 
                    hh_f06.SEMI.PERMANENT1 
                               -12987.4936 
                       hh_f06.TRADITIONAL1 
                               -22652.4591 
                       hh_f08.IRON.SHEETS1 
                                24042.7162 
                        hh_f08.CLAY.TILES1 
                                 3458.0223 
                          hh_f08.CONCRETE1 
                                39450.8360 
                  hh_f08.PLASTIC.SHEETING1 
                                75388.8363 
                   hh_f08.OTHER..SPECIFY.1 
                               392061.2659 
                      hh_f09.SMOOTHED.MUD1 
                               -19598.7193 
                     hh_f09.SMOOTH.CEMENT1 
                                21182.9162 
                              hh_f09.WOOD1 
                               248900.0385 
                              hh_f09.TILE1 
                               407874.4321 
                    hh_f09.OTHER.SPECIFY.1 
                              -168867.8335 
                                 hh_f10.11 
                               411273.4393 
                                 hh_f10.21 
                               395277.1683 
                                 hh_f10.31 
                               409056.2189 
                                 hh_f10.41 
                               405868.7053 
                                 hh_f10.51 
                               439660.0933 
                                 hh_f10.61 
                               466813.7506 
                                 hh_f10.71 
                               368540.2112 
                                 hh_f10.81 
                               763708.0749 
                                hh_f10.101 
                              2602037.2433 
                                hh_f19.NO1 
                              -100525.0654 
              hh_f41.Flush.to.septic.tank1 
                               171036.8525 
              hh_f41.Flush.to.pit.latrine1 
                               -56814.6790 
               hh_f41.Flush.to.open.drain1 
                              -399912.6838 
                 hh_f41.Flush.to.DK.where1 
                              -415810.0227 
   hh_f41.Ventilated.Improved.Pit.latrine1 
                              -235594.2110 
             hh_f41.Pit.latrine.with.slab1 
                              -270739.0703 
hh_f41.Pit.latrine.without.slab..Open.pit1 
                              -297951.4105 
                 hh_f41.Composting.toilet1 
                              -303265.3822 
                            hh_f41.Bucket1 
                              -336061.9714 
  hh_f41.Hanging.toilet...Hanging.latrine1 
                              -383691.7188 
        hh_f41.No.facility...Bush...Field1 
                              -306492.8610 
                   hh_f41.Other..specify.1 
                              -285095.5345 
                                   Bed.No1 
                               -57347.0562 
                                  Desk.No1 
                              -644991.3295 
                                   Fan.No1 
                               -77347.3723 
                          Refrigerator.No1 
                              -140356.8000 
                                 Table.No1 
                               -25723.3870 
                                 dist_road 
                                 -762.3171 
                                   adulteq 
                              -109167.2409 </code></pre>
</div>
</div>
<p><strong>Feature importance</strong></p>
<p>How relevant are my predictors?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot coefficients (feature importance)</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>coef_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a> <span class="at">Feature =</span> <span class="fu">names</span>(<span class="fu">coef</span>(linear))[<span class="sc">-</span><span class="dv">1</span>],  <span class="co"># exclude intercept</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a> <span class="at">Coefficient =</span> <span class="fu">coef</span>(linear)[<span class="sc">-</span><span class="dv">1</span>]     <span class="co"># exclude intercept</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(coef_data, <span class="fu">aes</span>(<span class="at">x =</span> Coefficient, <span class="at">y =</span> <span class="fu">reorder</span>(Feature, Coefficient))) <span class="sc">+</span></span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a> <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a> <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Feature Importance"</span>,</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Coefficient"</span>, </span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"Feature"</span>) <span class="sc">+</span></span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session_1_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Which variable coefficients exhibit the highest and lowest values?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">coef</span>(linear)[<span class="sc">-</span><span class="dv">1</span>])  <span class="co"># Exclude intercept</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(coefs, <span class="dv">5</span>)  <span class="co"># Lowest</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                Desk.No1 
                               -644991.3 
               hh_f41.Flush.to.DK.where1 
                               -415810.0 
             hh_f41.Flush.to.open.drain1 
                               -399912.7 
hh_f41.Hanging.toilet...Hanging.latrine1 
                               -383691.7 
                          hh_f41.Bucket1 
                               -336062.0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(coefs, <span class="dv">5</span>)  <span class="co"># Highest</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> hh_f10.11  hh_f10.51  hh_f10.61  hh_f10.81 hh_f10.101 
  411273.4   439660.1   466813.8   763708.1  2602037.2 </code></pre>
</div>
</div>
</div>
<div id="tabset-10-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-10-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit simple linear regression model</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>linear <span class="op">=</span> LinearRegression()</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>linear.fit(X_train, y_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<style>#sk-container-id-1 {
  /* Definition of color scheme common for light and dark mode */
  --sklearn-color-text: #000;
  --sklearn-color-text-muted: #666;
  --sklearn-color-line: gray;
  /* Definition of color scheme for unfitted estimators */
  --sklearn-color-unfitted-level-0: #fff5e6;
  --sklearn-color-unfitted-level-1: #f6e4d2;
  --sklearn-color-unfitted-level-2: #ffe0b3;
  --sklearn-color-unfitted-level-3: chocolate;
  /* Definition of color scheme for fitted estimators */
  --sklearn-color-fitted-level-0: #f0f8ff;
  --sklearn-color-fitted-level-1: #d4ebff;
  --sklearn-color-fitted-level-2: #b3dbfd;
  --sklearn-color-fitted-level-3: cornflowerblue;

  /* Specific color for light theme */
  --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, white)));
  --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, black)));
  --sklearn-color-icon: #696969;

  @media (prefers-color-scheme: dark) {
    /* Redefinition of color scheme for dark theme */
    --sklearn-color-text-on-default-background: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-background: var(--sg-background-color, var(--theme-background, var(--jp-layout-color0, #111)));
    --sklearn-color-border-box: var(--sg-text-color, var(--theme-code-foreground, var(--jp-content-font-color1, white)));
    --sklearn-color-icon: #878787;
  }
}

#sk-container-id-1 {
  color: var(--sklearn-color-text);
}

#sk-container-id-1 pre {
  padding: 0;
}

#sk-container-id-1 input.sk-hidden--visually {
  border: 0;
  clip: rect(1px 1px 1px 1px);
  clip: rect(1px, 1px, 1px, 1px);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

#sk-container-id-1 div.sk-dashed-wrapped {
  border: 1px dashed var(--sklearn-color-line);
  margin: 0 0.4em 0.5em 0.4em;
  box-sizing: border-box;
  padding-bottom: 0.4em;
  background-color: var(--sklearn-color-background);
}

#sk-container-id-1 div.sk-container {
  /* jupyter's `normalize.less` sets `[hidden] { display: none; }`
     but bootstrap.min.css set `[hidden] { display: none !important; }`
     so we also need the `!important` here to be able to override the
     default hidden behavior on the sphinx rendered scikit-learn.org.
     See: https://github.com/scikit-learn/scikit-learn/issues/21755 */
  display: inline-block !important;
  position: relative;
}

#sk-container-id-1 div.sk-text-repr-fallback {
  display: none;
}

div.sk-parallel-item,
div.sk-serial,
div.sk-item {
  /* draw centered vertical line to link estimators */
  background-image: linear-gradient(var(--sklearn-color-text-on-default-background), var(--sklearn-color-text-on-default-background));
  background-size: 2px 100%;
  background-repeat: no-repeat;
  background-position: center center;
}

/* Parallel-specific style estimator block */

#sk-container-id-1 div.sk-parallel-item::after {
  content: "";
  width: 100%;
  border-bottom: 2px solid var(--sklearn-color-text-on-default-background);
  flex-grow: 1;
}

#sk-container-id-1 div.sk-parallel {
  display: flex;
  align-items: stretch;
  justify-content: center;
  background-color: var(--sklearn-color-background);
  position: relative;
}

#sk-container-id-1 div.sk-parallel-item {
  display: flex;
  flex-direction: column;
}

#sk-container-id-1 div.sk-parallel-item:first-child::after {
  align-self: flex-end;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:last-child::after {
  align-self: flex-start;
  width: 50%;
}

#sk-container-id-1 div.sk-parallel-item:only-child::after {
  width: 0;
}

/* Serial-specific style estimator block */

#sk-container-id-1 div.sk-serial {
  display: flex;
  flex-direction: column;
  align-items: center;
  background-color: var(--sklearn-color-background);
  padding-right: 1em;
  padding-left: 1em;
}


/* Toggleable style: style used for estimator/Pipeline/ColumnTransformer box that is
clickable and can be expanded/collapsed.
- Pipeline and ColumnTransformer use this feature and define the default style
- Estimators will overwrite some part of the style using the `sk-estimator` class
*/

/* Pipeline and ColumnTransformer style (default) */

#sk-container-id-1 div.sk-toggleable {
  /* Default theme specific background. It is overwritten whether we have a
  specific estimator or a Pipeline/ColumnTransformer */
  background-color: var(--sklearn-color-background);
}

/* Toggleable label */
#sk-container-id-1 label.sk-toggleable__label {
  cursor: pointer;
  display: flex;
  width: 100%;
  margin-bottom: 0;
  padding: 0.5em;
  box-sizing: border-box;
  text-align: center;
  align-items: start;
  justify-content: space-between;
  gap: 0.5em;
}

#sk-container-id-1 label.sk-toggleable__label .caption {
  font-size: 0.6rem;
  font-weight: lighter;
  color: var(--sklearn-color-text-muted);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:before {
  /* Arrow on the left of the label */
  content: "▸";
  float: left;
  margin-right: 0.25em;
  color: var(--sklearn-color-icon);
}

#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {
  color: var(--sklearn-color-text);
}

/* Toggleable content - dropdown */

#sk-container-id-1 div.sk-toggleable__content {
  max-height: 0;
  max-width: 0;
  overflow: hidden;
  text-align: left;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content pre {
  margin: 0.2em;
  border-radius: 0.25em;
  color: var(--sklearn-color-text);
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-toggleable__content.fitted pre {
  /* unfitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {
  /* Expand drop-down */
  max-height: 200px;
  max-width: 100%;
  overflow: auto;
}

#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {
  content: "▾";
}

/* Pipeline/ColumnTransformer-specific style */

#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-label.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator-specific style */

/* Colorize estimator box */
#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted input.sk-toggleable__control:checked~label.sk-toggleable__label {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

#sk-container-id-1 div.sk-label label.sk-toggleable__label,
#sk-container-id-1 div.sk-label label {
  /* The background is the default theme color */
  color: var(--sklearn-color-text-on-default-background);
}

/* On hover, darken the color of the background */
#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-unfitted-level-2);
}

/* Label box, darken color on hover, fitted */
#sk-container-id-1 div.sk-label.fitted:hover label.sk-toggleable__label.fitted {
  color: var(--sklearn-color-text);
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Estimator label */

#sk-container-id-1 div.sk-label label {
  font-family: monospace;
  font-weight: bold;
  display: inline-block;
  line-height: 1.2em;
}

#sk-container-id-1 div.sk-label-container {
  text-align: center;
}

/* Estimator-specific */
#sk-container-id-1 div.sk-estimator {
  font-family: monospace;
  border: 1px dotted var(--sklearn-color-border-box);
  border-radius: 0.25em;
  box-sizing: border-box;
  margin-bottom: 0.5em;
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-0);
}

#sk-container-id-1 div.sk-estimator.fitted {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-0);
}

/* on hover */
#sk-container-id-1 div.sk-estimator:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-2);
}

#sk-container-id-1 div.sk-estimator.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-2);
}

/* Specification for estimator info (e.g. "i" and "?") */

/* Common style for "i" and "?" */

.sk-estimator-doc-link,
a:link.sk-estimator-doc-link,
a:visited.sk-estimator-doc-link {
  float: right;
  font-size: smaller;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1em;
  height: 1em;
  width: 1em;
  text-decoration: none !important;
  margin-left: 0.5em;
  text-align: center;
  /* unfitted */
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
  color: var(--sklearn-color-unfitted-level-1);
}

.sk-estimator-doc-link.fitted,
a:link.sk-estimator-doc-link.fitted,
a:visited.sk-estimator-doc-link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
div.sk-estimator:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover,
div.sk-label-container:hover .sk-estimator-doc-link:hover,
.sk-estimator-doc-link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

div.sk-estimator.fitted:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover,
div.sk-label-container:hover .sk-estimator-doc-link.fitted:hover,
.sk-estimator-doc-link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

/* Span, style for the box shown on hovering the info icon */
.sk-estimator-doc-link span {
  display: none;
  z-index: 9999;
  position: relative;
  font-weight: normal;
  right: .2ex;
  padding: .5ex;
  margin: .5ex;
  width: min-content;
  min-width: 20ex;
  max-width: 50ex;
  color: var(--sklearn-color-text);
  box-shadow: 2pt 2pt 4pt #999;
  /* unfitted */
  background: var(--sklearn-color-unfitted-level-0);
  border: .5pt solid var(--sklearn-color-unfitted-level-3);
}

.sk-estimator-doc-link.fitted span {
  /* fitted */
  background: var(--sklearn-color-fitted-level-0);
  border: var(--sklearn-color-fitted-level-3);
}

.sk-estimator-doc-link:hover span {
  display: block;
}

/* "?"-specific style due to the `<a>` HTML tag */

#sk-container-id-1 a.estimator_doc_link {
  float: right;
  font-size: 1rem;
  line-height: 1em;
  font-family: monospace;
  background-color: var(--sklearn-color-background);
  border-radius: 1rem;
  height: 1rem;
  width: 1rem;
  text-decoration: none;
  /* unfitted */
  color: var(--sklearn-color-unfitted-level-1);
  border: var(--sklearn-color-unfitted-level-1) 1pt solid;
}

#sk-container-id-1 a.estimator_doc_link.fitted {
  /* fitted */
  border: var(--sklearn-color-fitted-level-1) 1pt solid;
  color: var(--sklearn-color-fitted-level-1);
}

/* On hover */
#sk-container-id-1 a.estimator_doc_link:hover {
  /* unfitted */
  background-color: var(--sklearn-color-unfitted-level-3);
  color: var(--sklearn-color-background);
  text-decoration: none;
}

#sk-container-id-1 a.estimator_doc_link.fitted:hover {
  /* fitted */
  background-color: var(--sklearn-color-fitted-level-3);
}
</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LinearRegression()</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator fitted sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label fitted sk-toggleable__label-arrow"><div><div>LinearRegression</div></div><div><a class="sk-estimator-doc-link fitted" rel="noreferrer" target="_blank" href="https://scikit-learn.org/1.6/modules/generated/sklearn.linear_model.LinearRegression.html">?<span>Documentation for LinearRegression</span></a><span class="sk-estimator-doc-link fitted">i<span>Fitted</span></span></div></label><div class="sk-toggleable__content fitted"><pre>LinearRegression()</pre></div> </div></div></div></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the linear model's coefficients</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(linear.coef_)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[ 2.70437864e+04 -2.70017409e+03 -1.16702749e+05  6.33755814e+03
  2.03352274e+04  1.67624321e+04  7.86875059e+03  5.56515866e+03
  2.70022194e+04  4.04812690e+02  9.33791397e+03  5.90121006e+03
  1.77229064e+03  2.65218034e+03  1.31785800e+03  5.67154457e+03
  3.55789228e+03 -7.08027948e+02  3.04940236e+04  1.16824408e+03
  1.20952780e+02  7.01653924e+03  8.37413365e+03  5.03991620e+03
  3.13378344e+03 -5.27574915e+02  6.54518660e+02  2.90482939e+03
 -1.68335793e+03  4.20844105e+01 -1.50850036e+03  8.60146137e+03
  1.79452913e+04  1.21096585e+04  1.08724490e+04 -5.23369640e+03
 -4.83920070e+03  9.10393981e+03  1.23903315e+03  6.03896726e+02
  1.70384005e+03  1.05484586e+04 -1.45921399e+04  3.16235939e+03
  2.87513015e+03  1.38313979e+04 -1.85499555e+03 -2.91527967e+04
  3.36433471e+04 -1.65890324e+03 -8.22983678e+03 -5.66522210e+03
 -3.57160696e+04 -1.45811399e+05 -1.69031476e+05 -4.00077425e+04
 -1.04058520e+04 -1.87711361e+04 -9.78099781e+04 -1.65501074e+04
 -2.47282589e+04 -2.27983640e+04 -2.64115618e+04 -3.26522137e+04
 -9.64238135e+03]</code></pre>
</div>
</div>
<p><strong>Feature importance</strong></p>
<p>How relevant are my predictors?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot coefficients (feature importance)</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_feature_importances(model):</span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>    n_features<span class="op">=</span>df.shape[<span class="dv">1</span>]</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>    plt.barh(np.arange(n_features),model.coef_ , align<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    plt.yticks(np.arange(n_features),df.columns.values)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">#reduce y-axis font size</span></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    plt.yticks(fontsize<span class="op">=</span><span class="dv">6</span>)</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"coefficient"</span>)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Feature"</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>    plt.ylim(<span class="op">-</span><span class="dv">1</span>, n_features)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"Feature importance"</span>)</span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">#increase figure size</span></span>
<span id="cb92-13"><a href="#cb92-13" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">10</span>))</span>
<span id="cb92-14"><a href="#cb92-14" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb92-15"><a href="#cb92-15" aria-hidden="true" tabindex="-1"></a>plot_feature_importances(linear)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session_1_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="1440"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="session_1_files/figure-html/unnamed-chunk-37-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Which variable coefficients exhibit the highest and lowest values?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> pd.Series(linear.coef_, index<span class="op">=</span>df.columns)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>coefs <span class="op">=</span> coefs.sort_values()</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coefs.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>hh_f41_Pit latrine without slab /Open pit   -169031.475530
hh_f41_Pit latrine with slab                -145811.399195
adulteq                                     -116702.748828
hh_f41_No facility / Bush / Field            -97809.978131
hh_f41_Composting toilet                     -40007.742489
dtype: float64</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(coefs.tail())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>district_Nkhatabay             20335.227364
district_Mzuzu City            27002.219368
hh_f10                         27043.786380
district_Lilongwe City         30494.023609
hh_f41_Flush to septic tank    33643.347059
dtype: float64</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="performance-indicators" class="level4">
<h4 class="anchored" data-anchor-id="performance-indicators">Performance Indicators</h4>
<p>In predictive modeling, there are various performance metrics for different use cases and policy preferences. In the following, we’ll consider two of the most popular metrics for regression:</p>
<ol type="1">
<li><p><strong>Model residuals:</strong> Recall that residuals are the observed value minus the predicted value. We can estimate a model’s Root Mean Squared Error (RMSE) or the Mean Absolute Error (MAE). Residuals allow us to quantify how close the predicted response value is to the true response value for a given observation. Small RMSE or MAE values indicate that predictions are close to the true observed values.</p></li>
<li><p><strong>The R-squared:</strong> Arguably the go-to indicator for performance assessment. Low <span class="math inline">\(R^2\)</span> values are not uncommon, especially in the social sciences. However, when hoping to use a model for predictive purposes, a low <span class="math inline">\(R^2\)</span> is a bad sign, regardless of having a large number of statistically significant features. The drawback of relying solely on this measure is that it does not consider the problem of model overfitting; i.e., you can inflate the R-squared by adding as many variables as you want, even if those variables have little predictive power. This approach will yield great results on the training data but will underperform when extrapolating the model to the test (or any other) dataset.</p></li>
</ol>
<p><strong>Residuals:</strong></p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-11-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-1" role="tab" aria-controls="tabset-11-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-11-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-11-2" role="tab" aria-controls="tabset-11-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-11-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-11-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's use the model to predict the target variable</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>y_pred_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(linear, Train_df)</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, calculate residuals. Recall: observed - predicted</span></span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>residuals <span class="ot">&lt;-</span> Train_target<span class="sc">$</span>rexpaggpc <span class="sc">-</span> y_pred_train</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Describe the distribution of residuals</span></span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(residuals)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
-1151323   -93547   -22898        0    60181  6736551 </code></pre>
</div>
</div>
<p>Recall that the residual is estimated as the true (observed) value minus the predicted value. Thus: the max(imum) error of 6.7365515^{6} suggests that the model under-predicted expenditure by this amount for at least one observation. From the estimation of the predicted residuals we obtain the popular measure of performance evaluation known as the Root Mean Squared Error (RMSE, for short).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Manually</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the RMSE for the training dataset, or the in-sample RMSE</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>rmse_insample_manual <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>(residuals<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Using the caret() library</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the RMSE for the training dataset, or the in-sample RMSE</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>rmse_insample_caret <span class="ot">&lt;-</span> <span class="fu">RMSE</span>(y_pred_train, Train_target<span class="sc">$</span>rexpaggpc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The RMSE (2.31967^{5}) gives us an absolute number that indicates how much our predicted values deviate from the true (observed) number. This is all in reference to the target variable. Think of the question: How far, on average, are the residuals away from zero? Generally speaking, the lower the value, the better the model fit. Besides being a good measure of goodness of fit, the RMSE is also useful for comparing the ability of our model to make predictions on different (e.g.&nbsp;test) data sets. The in-sample RMSE should be close or equal to the out-of-sample RMSE. In this case, our RMSE is ~2.31967^{5} units away from zero.</p>
</div>
<div id="tabset-11-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-11-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's use the model to predict the target variable</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>y_pred_train <span class="op">=</span> linear.predict(X_train)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Now, calculate residuals. Recall: observed - predicted</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>residuals <span class="op">=</span> y_train <span class="op">-</span> y_pred_train</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Describe the distribution of residuals</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>residuals.describe()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>count    9.140000e+03
mean    -3.464438e-11
std      2.835014e+05
min     -1.002914e+06
25%     -9.559010e+04
50%     -2.309335e+04
75%      6.055365e+04
max      1.689965e+07
Name: rexpaggpc, dtype: float64</code></pre>
</div>
</div>
<p>Recall that the residual is estimated as the true (observed) value minus the predicted value. Thus: the max(imum) error of <code>{python} max_residual_py</code> suggests that the model under-predicted expenditure by <em>this</em> amount for at least one observation. From the estimation of the predicted residuals we obtain the popular measure of performance evaluation known as the Root Mean Squared Error (RMSE, for short).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the RMSE for the training dataset, or the in-sample RMSE</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>rmse_insample_py <span class="op">=</span> root_mean_squared_error(y_train, y_pred_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The RMSE (<code>{python} round(rmse_insample_py, 0)</code>) gives us an absolute number that indicates how much our predicted values deviate from the true (observed) number. This is all in reference to the target variable. Think of the question: How far, on average, are the residuals away from zero? Generally speaking, the lower the value, the better the model fit. Besides being a good measure of goodness of fit, the RMSE is also useful for comparing the ability of our model to make predictions on different (e.g.&nbsp;test) data sets. The in-sample RMSE should be close or equal to the out-of-sample RMSE. In this case, our RMSE is ~<code>{python} round(rmse_insample_py, 0)</code> units away from zero.</p>
</div>
</div>
</div>
<p><strong>R-squared</strong></p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-12-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-1" role="tab" aria-controls="tabset-12-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-12-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-12-2" role="tab" aria-controls="tabset-12-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-12-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-12-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>r2_train <span class="ot">&lt;-</span> <span class="fu">summary</span>(linear)<span class="sc">$</span>r.squared</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(r2_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4730982</code></pre>
</div>
</div>
<p>The estimated (Multiple) R-squared of 0.473 tells us that our model predicts around 47.3 percent of the variation in the target variable (consumption per capita). Also note that when we have a large number of predictors, it’s best to look at the Adjusted R-squared, which corrects or adjusts for this by only increasing when a new feature improves the model more so than what would be expected by chance.</p>
</div>
<div id="tabset-12-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-12-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>r2_train <span class="op">=</span> r2_score(y_train, linear.predict(X_train))</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(r2_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>0.38494808260419633</code></pre>
</div>
</div>
<p>The estimated (Multiple) R-squared of <code>{python round(r2_train, 3)}</code> tells us that our model predicts around <code>{python round(r2_train * 100, 1)}</code> percent of the variation in the target variable (consumption per capita). Also note that when we have a large number of predictors, it’s best to look at the Adjusted R-squared, which corrects or adjusts for this by only increasing when a new feature improves the model more so than what would be expected by chance.</p>
</div>
</div>
</div>
</section>
<section id="out-of-sample-predictions" class="level4">
<h4 class="anchored" data-anchor-id="out-of-sample-predictions">Out-of-sample predictions</h4>
<p>Now that we have built and evaluated our model in the training dataset, we can proceed to make out-of-sample predictions. That is, see how our model performs in the test dataset.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-13-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-1" role="tab" aria-controls="tabset-13-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-13-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-13-2" role="tab" aria-controls="tabset-13-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-13-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-13-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict y(target) values based on the test data model, with model trained on training data</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(linear, Test_df)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a><span class="co"># In summary, train and test prediction quality of the model</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Root mean squared error on training set:"</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, <span class="fu">RMSE</span>(y_pred_train, Train_target<span class="sc">$</span>rexpaggpc)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root mean squared error on training set: 231966.71 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R2 on training set:"</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, <span class="fu">summary</span>(linear)<span class="sc">$</span>r.squared), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R2 on training set: 0.47 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Root mean squared error on test set:"</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, <span class="fu">RMSE</span>(y_pred, Test_target<span class="sc">$</span>rexpaggpc)), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root mean squared error on test set: 427627.25 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"R2 on test set:"</span>, <span class="fu">sprintf</span>(<span class="st">"%.2f"</span>, <span class="fu">cor</span>(Test_target<span class="sc">$</span>rexpaggpc, y_pred)<span class="sc">^</span><span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R2 on test set: 0.33 </code></pre>
</div>
</div>
</div>
<div id="tabset-13-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-13-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict y(target) values based on the test data model, with model trained on</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>y_pred <span class="op">=</span> linear.predict(X_test)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># In summary, train and test prediction quality of the model</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Root mean squared error on training set: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> root_mean_squared_error(y_train, y_pred_train))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root mean squared error on training set: 283485.89</code></pre>
</div>
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 on training set: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> r2_score(y_train, y_pred_train))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R2 on training set: 0.38</code></pre>
</div>
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Root mean squared error on test set: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> root_mean_squared_error(y_test, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Root mean squared error on test set: 292933.38</code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"R2 on test set: </span><span class="sc">%.2f</span><span class="st">"</span> <span class="op">%</span> r2_score(y_test, y_pred))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>R2 on test set: 0.43</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The summary statistics for the predictions with the train and test datasets are not so close to one another. This is an indication that our model doesn’t necessarily extrapolate well to other datasets. Compared to the observed summary statistics of the target variable, they’re relatively close, with the largest deviations observed at the minimum and maximum values.</p>
<p><strong>What do we mean by bias in a model?</strong></p>
<p>The bias is the difference between the average prediction of our model and the true (observed) value. Minimizing the bias is analogous to minimizing the RMSE.</p>
<p><strong>What do we mean by variance in a model?</strong></p>
<p>It is the observed variability of our model prediction for a given data point (how much the model can adjust given the data set). A model with high variance would yield low error values in the training data but high errors in the test data.</p>
<p>Hence, consistent in and out-of-sample RMSE scores = bias/variance balance. This describes the <strong>bias-variance trade-off</strong>. We can reduce the bias by overfitting the model to the training data, but that comes at the expense of increased variance. Finding the optimal balance between bias and variance is the key challenge of any prediction model.</p>
</section>
<section id="a-final-task" class="level4">
<h4 class="anchored" data-anchor-id="a-final-task">A final task</h4>
<p>We are almost done with <strong>Session 1</strong>. Before we close the session, we need to store our data and our prediction model for the next session. Fitting our OLS model is fast and could be easily reproduced in the next session. However, for large models and more complicated settings, it can take very long to find and fit the best model. After building a complicated model, we want to make sure to save it securely for future deployment.</p>
<div class="tabset-margin-container"></div><div class="panel-tabset" data-group="language">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-14-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-1" role="tab" aria-controls="tabset-14-1" aria-selected="true">R</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-14-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-14-2" role="tab" aria-controls="tabset-14-2" aria-selected="false">Python</a></li></ul>
<div class="tab-content" data-group="language">
<div id="tabset-14-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-14-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the data frames</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Train_df, <span class="st">"Train_df.rds"</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Test_df, <span class="st">"Test_df.rds"</span>)</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Train_target, <span class="st">"Train_target.rds"</span>)</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Test_target, <span class="st">"Test_target.rds"</span>)</span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(malawi, <span class="st">"malawi.rds"</span>)</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(target, <span class="st">"target.rds"</span>)</span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the fitted model</span></span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(linear, <span class="st">"linear_model.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-14-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-14-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the data frames</span></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'X_train.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>    pickle.dump(X_train, f)</span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'X_test.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    pickle.dump(X_test, f)</span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'y_train.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    pickle.dump(y_train, f)</span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'y_test.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>    pickle.dump(y_test, f)</span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'df.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>    pickle.dump(df, f)</span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'target.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>    pickle.dump(target, f)</span>
<span id="cb124-15"><a href="#cb124-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the fitted model</span></span>
<span id="cb124-16"><a href="#cb124-16" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'linear_model.pkl'</span>, <span class="st">'wb'</span>) <span class="im">as</span> f:</span>
<span id="cb124-17"><a href="#cb124-17" aria-hidden="true" tabindex="-1"></a>    pickle.dump(linear, f)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="readings" class="level2">
<h2 class="anchored" data-anchor-id="readings">Readings</h2>
<ul>
<li><p>An introduction to Statistical learning; Chapters 2, 3 (Regression)</p></li>
<li><p>Athey, S. (2017). Beyond prediction: Using big data for policy problems. Science, 355(6324), 483-485.</p></li>
<li><p>Kleinberg, J., Ludwig, J., Mullainathan, S. and Obermeyer, Z., 2015. Prediction policy problems. American Economic Review, 105(5), pp.491-95.</p></li>
</ul>
</section>
<section id="assignment" class="level2">
<h2 class="anchored" data-anchor-id="assignment">Assignment:</h2>
<ul>
<li><p>Why is this a prediction policy problem? What would be a causal inference problem in this setting?</p></li>
<li><p>Which variables would you include in the model? How would you select the predictors?</p></li>
<li><p>Give an example of a variable that should not be included.</p></li>
<li><p>Try to improve the baseline model. You can select other predictors or/and transform them (e.g., use quadratic transformations of predictors or interact predictors). Report and share your model specification and performance indicators with your cohort. Are there any noteworthy patterns?</p></li>
</ul>
<p>Note: Your assignment will be shared with another course participant, and you will receive someone else’s assignment. Responses can be concise, and it usually helps if you can share your code. Try to make it as easy as possible for your reviewer to read your code and responses! If you don’t know a response and you are lost, formulate questions so that your reviewer can try to help you. Please also use the Forum to post your questions. The cohort wants to help and learn from your discussions. For instance, if you and your reviewer can resolve questions, post them. Or if you have received a helpful explanation from your reviewer, please also share it with the group.</p>
<!--DISQUS COMMENTS SCRIPT-->
<div id="disqus_thread">

</div>
<script>
    var disqus_config = function () {
    this.page.identifier = "predictionpolicy.html"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };

    
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://unu-merit.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>
Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
</noscript>


</section>


<div class="footer">
Copyright © 2025 Michelle González Amador &amp; Stephan Dietrich. All rights reserved.<br> <a href="https://github.com/lucasboh/ml4p-website-v2"><img src="https://img.shields.io/badge/GitHub-Repository-blue?logo=github.png" class="img-fluid" alt="GitHub"></a>
</div><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Table consisting of rows and columns.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>